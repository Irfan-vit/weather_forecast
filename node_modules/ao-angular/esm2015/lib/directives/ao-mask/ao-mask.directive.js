/**
 * @fileoverview added by tsickle
 * Generated from: lib/directives/ao-mask/ao-mask.directive.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Directive, Input } from '@angular/core';
import { IonInput } from '@ionic/angular';
import { Subject } from 'rxjs';
import { takeUntil } from 'rxjs/operators';
import IMask from 'imask';
export class AOMaskDirective {
    /**
     * @param {?} ionInput
     */
    constructor(ionInput) {
        this.ionInput = ionInput;
        this._masks = {
            zipCode: {
                mask: '00.000-000'
            },
            cnpj: {
                mask: '00.000.000/0000-00'
            },
            cpf: {
                mask: '000.000.000-00'
            },
            cpfCnpj: {
                mask: [
                    { mask: '000.000.000-00' },
                    { mask: '00.000.000/0000-00' }
                ]
            },
            phone: {
                mask: [
                    { mask: '(00) 0000-0000' },
                    { mask: '(00) 0-0000-0000' }
                ]
            },
            date: {
                mask: Date,
                pattern: 'DD/MM/YYYY',
                blocks: {
                    DD: { mask: IMask.MaskedRange, from: 1, to: 31, maxLength: 2 },
                    MM: { mask: IMask.MaskedRange, from: 1, to: 12, maxLength: 2 },
                    YYYY: { mask: IMask.MaskedRange, from: 1900, to: 9999, maxLength: 4 }
                },
                format: (/**
                 * @param {?} date
                 * @return {?}
                 */
                function (date) {
                    /** @type {?} */
                    let day = date.getDate().toString().padStart(2, 0);
                    /** @type {?} */
                    let month = (date.getMonth() + 1).toString().padStart(2, 0);
                    /** @type {?} */
                    let year = date.getFullYear();
                    return [day, month, year].join('/');
                }),
                parse: (/**
                 * @param {?} str
                 * @return {?}
                 */
                function (str) {
                    /** @type {?} */
                    const parts = str.split('/');
                    return new Date(parts[2], parts[1] - 1, parts[0]);
                }),
            },
            decimal: {
                mask: Number,
                thousandsSeparator: '.',
                scale: 2,
                signed: false,
                padFractionalZeros: false,
                normalizeZeros: true,
                radix: ',',
                mapToRadix: ['.'],
            },
            int: {
                mask: Number,
                thousandsSeparator: '.',
                scale: 0,
                signed: false,
            }
        };
        this._destroyed = new Subject();
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            /** @type {?} */
            const element = yield this.ionInput.getInputElement();
            /** @type {?} */
            const formatter = IMask(element, this.options());
            // formatter.value
            // formatter.unmaskedValue
            // formatter.typedValue = '+55 (61) 1234-5678'
            this.ionInput.value = element.value;
            formatter.updateValue();
            /** @type {?} */
            let count = 0;
            this.ionInput.ionChange
                .pipe(takeUntil(this._destroyed))
                .subscribe((/**
             * @param {?} event
             * @return {?}
             */
            (event) => {
                // event.detail.value
                this.ionInput.value = element.value;
                if (count == 0) {
                    formatter.updateValue();
                    count++;
                }
            }));
        });
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        this._destroyed.next();
    }
    /**
     * @private
     * @return {?}
     */
    options() {
        if (typeof this.mask == 'string') {
            /** @type {?} */
            let options = { mask: this.mask };
            if (this._masks[this.mask]) {
                options = this._masks[this.mask];
            }
            if (this.min !== undefined) {
                options.min = this.min;
            }
            if (this.max !== undefined) {
                options.max = this.max;
            }
            if (this.min < 0 || this.max < 0) {
                options.signed = true;
            }
            return options;
        }
        return this.mask;
    }
}
AOMaskDirective.decorators = [
    { type: Directive, args: [{
                selector: '[ao-mask]',
                providers: [IonInput],
            },] }
];
/** @nocollapse */
AOMaskDirective.ctorParameters = () => [
    { type: IonInput }
];
AOMaskDirective.propDecorators = {
    mask: [{ type: Input, args: ['ao-mask',] }],
    min: [{ type: Input, args: ['ao-min',] }],
    max: [{ type: Input, args: ['ao-max',] }]
};
if (false) {
    /**
     * @type {?}
     * @private
     */
    AOMaskDirective.prototype._masks;
    /**
     * @type {?}
     * @private
     */
    AOMaskDirective.prototype.mask;
    /**
     * @type {?}
     * @private
     */
    AOMaskDirective.prototype.min;
    /**
     * @type {?}
     * @private
     */
    AOMaskDirective.prototype.max;
    /**
     * @type {?}
     * @private
     */
    AOMaskDirective.prototype._destroyed;
    /** @type {?} */
    AOMaskDirective.prototype.ionInput;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYW8tbWFzay5kaXJlY3RpdmUuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9hby1hbmd1bGFyLyIsInNvdXJjZXMiOlsibGliL2RpcmVjdGl2ZXMvYW8tbWFzay9hby1tYXNrLmRpcmVjdGl2ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBcUIsTUFBTSxlQUFlLENBQUM7QUFDcEUsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQzFDLE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDL0IsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQzNDLE9BQU8sS0FBSyxNQUFNLE9BQU8sQ0FBQztBQU0xQixNQUFNLE9BQU8sZUFBZTs7OztJQXFFMUIsWUFDUyxRQUFrQjtRQUFsQixhQUFRLEdBQVIsUUFBUSxDQUFVO1FBcEVuQixXQUFNLEdBQVE7WUFDcEIsT0FBTyxFQUFFO2dCQUNQLElBQUksRUFBRSxZQUFZO2FBQ25CO1lBQ0QsSUFBSSxFQUFFO2dCQUNKLElBQUksRUFBRSxvQkFBb0I7YUFDM0I7WUFDRCxHQUFHLEVBQUU7Z0JBQ0gsSUFBSSxFQUFFLGdCQUFnQjthQUN2QjtZQUNELE9BQU8sRUFBRTtnQkFDUCxJQUFJLEVBQUU7b0JBQ0osRUFBQyxJQUFJLEVBQUUsZ0JBQWdCLEVBQUM7b0JBQ3hCLEVBQUMsSUFBSSxFQUFFLG9CQUFvQixFQUFDO2lCQUM3QjthQUNGO1lBQ0QsS0FBSyxFQUFFO2dCQUNMLElBQUksRUFBRTtvQkFDSixFQUFDLElBQUksRUFBRSxnQkFBZ0IsRUFBQztvQkFDeEIsRUFBQyxJQUFJLEVBQUUsa0JBQWtCLEVBQUM7aUJBQzNCO2FBQ0Y7WUFDRCxJQUFJLEVBQUU7Z0JBQ0osSUFBSSxFQUFFLElBQUk7Z0JBQ1YsT0FBTyxFQUFFLFlBQVk7Z0JBQ3JCLE1BQU0sRUFBRTtvQkFDTixFQUFFLEVBQUUsRUFB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Q0F5REU7Ozs7O0lBRUYsK0JBQW9DOzs7OztJQUVwQyw4QkFBNkI7Ozs7O0lBRTdCLDhCQUE2Qjs7Ozs7SUFFN0IscUNBQXlDOztJQUd2QyxtQ0FBeUIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBEaXJlY3RpdmUsIElucHV0LCBPbkRlc3Ryb3ksIE9uSW5pdCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBJb25JbnB1dCB9IGZyb20gJ0Bpb25pYy9hbmd1bGFyJztcclxuaW1wb3J0IHsgU3ViamVjdCB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyB0YWtlVW50aWwgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XHJcbmltcG9ydCBJTWFzayBmcm9tICdpbWFzayc7XHJcblxyXG5ARGlyZWN0aXZlKHtcclxuICBzZWxlY3RvcjogJ1thby1tYXNrXScsXHJcbiAgcHJvdmlkZXJzOiBbSW9uSW5wdXRdLFxyXG59KVxyXG5leHBvcnQgY2xhc3MgQU9NYXNrRGlyZWN0aXZlIGltcGxlbWVudHMgT25Jbml0LCBPbkRlc3Ryb3kge1xyXG5cclxuICBwcml2YXRlIF9tYXNrczogYW55ID0ge1xyXG4gICAgemlwQ29kZToge1xyXG4gICAgICBtYXNrOiAnMDAuMDAwLTAwMCdcclxuICAgIH0sXHJcbiAgICBjbnBqOiB7XHJcbiAgICAgIG1hc2s6ICcwMC4wMDAuMDAwLzAwMDAtMDAnXHJcbiAgICB9LFxyXG4gICAgY3BmOiB7XHJcbiAgICAgIG1hc2s6ICcwMDAuMDAwLjAwMC0wMCdcclxuICAgIH0sXHJcbiAgICBjcGZDbnBqOiB7XHJcbiAgICAgIG1hc2s6IFtcclxuICAgICAgICB7bWFzazogJzAwMC4wMDAuMDAwLTAwJ30sXHJcbiAgICAgICAge21hc2s6ICcwMC4wMDAuMDAwLzAwMDAtMDAnfVxyXG4gICAgICBdXHJcbiAgICB9LFxyXG4gICAgcGhvbmU6IHtcclxuICAgICAgbWFzazogW1xyXG4gICAgICAgIHttYXNrOiAnKDAwKSAwMDAwLTAwMDAnfSxcclxuICAgICAgICB7bWFzazogJygwMCkgMC0wMDAwLTAwMDAnfVxyXG4gICAgICBdXHJcbiAgICB9LFxyXG4gICAgZGF0ZToge1xyXG4gICAgICBtYXNrOiBEYXRlLFxyXG4gICAgICBwYXR0ZXJuOiAnREQvTU0vWVlZWScsXHJcbiAgICAgIGJsb2Nrczoge1xyXG4gICAgICAgIEREOiB7bWFzazogSU1hc2suTWFza2VkUmFuZ2UsIGZyb206IDEsIHRvOiAzMSwgbWF4TGVuZ3RoOiAyfSxcclxuICAgICAgICBNTToge21hc2s6IElNYXNrLk1hc2tlZFJhbmdlLCBmcm9tOiAxLCB0bzogMTIsIG1heExlbmd0aDogMn0sXHJcbiAgICAgICAgWVlZWToge21hc2s6IElNYXNrLk1hc2tlZFJhbmdlLCBmcm9tOiAxOTAwLCB0bzogOTk5OSwgbWF4TGVuZ3RoOiA0fVxyXG4gICAgICB9LFxyXG4gICAgICBmb3JtYXQ6IGZ1bmN0aW9uIChkYXRlKSB7XHJcbiAgICAgICAgbGV0IGRheSA9IGRhdGUuZ2V0RGF0ZSgpLnRvU3RyaW5nKCkucGFkU3RhcnQoMiwgMCk7XHJcbiAgICAgICAgbGV0IG1vbnRoID0gKGRhdGUuZ2V0TW9udGgoKSArIDEpLnRvU3RyaW5nKCkucGFkU3RhcnQoMiwgMCk7XHJcbiAgICAgICAgbGV0IHllYXIgPSBkYXRlLmdldEZ1bGxZZWFyKCk7XHJcbiAgICAgICAgcmV0dXJuIFtkYXksIG1vbnRoLCB5ZWFyXS5qb2luKCcvJyk7XHJcbiAgICAgIH0sXHJcbiAgICAgIHBhcnNlOiBmdW5jdGlvbiAoc3RyKSB7XHJcbiAgICAgICAgY29uc3QgcGFydHMgPSBzdHIuc3BsaXQoJy8nKTtcclxuICAgICAgICByZXR1cm4gbmV3IERhdGUocGFydHNbMl0sIHBhcnRzWzFdIC0gMSwgcGFydHNbMF0pO1xyXG4gICAgICB9LFxyXG4gICAgfSxcclxuICAgIGRlY2ltYWw6IHtcclxuICAgICAgbWFzazogTnVtYmVyLFxyXG4gICAgICB0aG91c2FuZHNTZXBhcmF0b3I6ICcuJyxcclxuICAgICAgc2NhbGU6IDIsXHJcbiAgICAgIHNpZ25lZDogZmFsc2UsXHJcbiAgICAgIHBhZEZyYWN0aW9uYWxaZXJvczogZmFsc2UsXHJcbiAgICAgIG5vcm1hbGl6ZVplcm9zOiB0cnVlLFxyXG4gICAgICByYWRpeDogJywnLFxyXG4gICAgICBtYXBUb1JhZGl4OiBbJy4nXSxcclxuICAgIH0sXHJcbiAgICBpbnQ6IHtcclxuICAgICAgbWFzazogTnVtYmVyLFxyXG4gICAgICB0aG91c2FuZHNTZXBhcmF0b3I6ICcuJyxcclxuICAgICAgc2NhbGU6IDAsXHJcbiAgICAgIHNpZ25lZDogZmFsc2UsXHJcbiAgICB9XHJcbiAgfTtcclxuXHJcbiAgQElucHV0KCdhby1tYXNrJykgcHJpdmF0ZSBtYXNrOiBhbnk7XHJcblxyXG4gIEBJbnB1dCgnYW8tbWluJykgcHJpdmF0ZSBtaW47XHJcblxyXG4gIEBJbnB1dCgnYW8tbWF4JykgcHJpdmF0ZSBtYXg7XHJcblxyXG4gIHByaXZhdGUgX2Rlc3Ryb3llZCA9IG5ldyBTdWJqZWN0PHZvaWQ+KCk7XHJcblxyXG4gIGNvbnN0cnVjdG9yKFxyXG4gICAgcHVibGljIGlvbklucHV0OiBJb25JbnB1dFxyXG4gICkge1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGFzeW5jIG5nT25Jbml0KCkge1xyXG4gICAgY29uc3QgZWxlbWVudCA9IGF3YWl0IHRoaXMuaW9uSW5wdXQuZ2V0SW5wdXRFbGVtZW50KCk7XHJcblxyXG4gICAgY29uc3QgZm9ybWF0dGVyID0gSU1hc2soZWxlbWVudCwgdGhpcy5vcHRpb25zKCkpO1xyXG5cclxuICAgIC8vIGZvcm1hdHRlci52YWx1ZVxyXG4gICAgLy8gZm9ybWF0dGVyLnVubWFza2VkVmFsdWVcclxuICAgIC8vIGZvcm1hdHRlci50eXBlZFZhbHVlID0gJys1NSAoNjEpIDEyMzQtNTY3OCdcclxuXHJcbiAgICB0aGlzLmlvbklucHV0LnZhbHVlID0gZWxlbWVudC52YWx1ZTtcclxuICAgIGZvcm1hdHRlci51cGRhdGVWYWx1ZSgpO1xyXG5cclxuICAgIGxldCBjb3VudCA9IDA7XHJcblxyXG4gICAgdGhpcy5pb25JbnB1dC5pb25DaGFuZ2VcclxuICAgICAgLnBpcGUodGFrZVVudGlsKHRoaXMuX2Rlc3Ryb3llZCkpXHJcbiAgICAgIC5zdWJzY3JpYmUoKGV2ZW50OiBDdXN0b21FdmVudCkgPT4ge1xyXG5cclxuICAgICAgICAvLyBldmVudC5kZXRhaWwudmFsdWVcclxuICAgICAgICB0aGlzLmlvbklucHV0LnZhbHVlID0gZWxlbWVudC52YWx1ZTtcclxuXHJcbiAgICAgICAgaWYgKGNvdW50ID09IDApIHtcclxuICAgICAgICAgIGZvcm1hdHRlci51cGRhdGVWYWx1ZSgpO1xyXG4gICAgICAgICAgY291bnQrKztcclxuICAgICAgICB9XHJcblxyXG4gICAgICB9KTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBuZ09uRGVzdHJveSgpIHtcclxuICAgIHRoaXMuX2Rlc3Ryb3llZC5uZXh0KCk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIG9wdGlvbnMoKSB7XHJcbiAgICBpZiAodHlwZW9mIHRoaXMubWFzayA9PSAnc3RyaW5nJykge1xyXG4gICAgICBsZXQgb3B0aW9uczogYW55ID0ge21hc2s6IHRoaXMubWFza307XHJcblxyXG4gICAgICBpZiAodGhpcy5fbWFza3NbdGhpcy5tYXNrXSkge1xyXG4gICAgICAgIG9wdGlvbnMgPSB0aGlzLl9tYXNrc1t0aGlzLm1hc2tdO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBpZiAodGhpcy5taW4gIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgIG9wdGlvbnMubWluID0gdGhpcy5taW47XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGlmICh0aGlzLm1heCAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgb3B0aW9ucy5tYXggPSB0aGlzLm1heDtcclxuICAgICAgfVxyXG5cclxuICAgICAgaWYgKHRoaXMubWluIDwgMCB8fCB0aGlzLm1heCA8IDApIHtcclxuICAgICAgICBvcHRpb25zLnNpZ25lZCA9IHRydWU7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHJldHVybiBvcHRpb25zO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB0aGlzLm1hc2s7XHJcbiAgfVxyXG5cclxufSJdfQ==