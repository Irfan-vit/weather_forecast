/**
 * @fileoverview added by tsickle
 * Generated from: lib/services/ao-firebase.service.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable } from '@angular/core';
import * as firebase from 'firebase/app';
import { AOFirebaseFactoryService } from './ao-firebase-factory.service';
import * as i0 from "@angular/core";
import * as i1 from "./ao-firebase-factory.service";
export class AOFirebaseService {
    /**
     * @param {?} _firebase
     */
    constructor(_firebase) {
        this._firebase = _firebase;
        this._name = 'master';
    }
    /**
     * @return {?}
     */
    firebase() {
        return this._firebase;
    }
    /**
     * @param {?} configs
     * @return {?}
     */
    factory(configs) {
        return this._firebase.factory(this.name(), configs);
    }
    /**
     * @return {?}
     */
    conn() {
        return this._firebase.conn(this.name());
    }
    /**
     * @return {?}
     */
    name() {
        return this._name;
    }
    /**
     * @return {?}
     */
    hash() {
        return this.conn().hash();
    }
    /**
     * @return {?}
     */
    app() {
        return this.conn().app();
    }
    // -------------------------------------------------------------------------------------------------------------------
    /**
     * @return {?}
     */
    auth() {
        return this.conn().auth();
    }
    /**
     * @return {?}
     */
    authState() {
        return this.auth().authState;
    }
    // -------------------------------------------------------------------------------------------------------------------
    /**
     * @return {?}
     */
    db() {
        return this.conn().database();
    }
    /**
     * @return {?}
     */
    dbNow() {
        return firebase.database.ServerValue.TIMESTAMP;
    }
    // -------------------------------------------------------------------------------------------------------------------
    /**
     * @return {?}
     */
    fs() {
        return this.conn().firestore();
    }
    /**
     * @return {?}
     */
    fsId() {
        return this.fs().createId();
    }
    /**
     * @template T
     * @param {?} path
     * @return {?}
     */
    fsDoc(path) {
        return this.fs().doc(path);
    }
    /**
     * @param {?} path
     * @return {?}
     */
    fsDocValue(path) {
        return this.fsDoc(path).valueChanges();
    }
    /**
     * @param {?} path
     * @return {?}
     */
    fsDocSnapshot(path) {
        return this.fs().doc(path).snapshotChanges();
    }
    /**
     * @param {?} path
     * @param {?} data
     * @param {?=} options
     * @return {?}
     */
    fsDocSet(path, data, options = { merge: true }) {
        return this.fs().doc(path).set(data, options);
    }
    /**
     * @template T
     * @param {?} path
     * @param {?=} queryFn
     * @return {?}
     */
    fsCol(path, queryFn) {
        return this.fs().collection(path, queryFn);
    }
    /**
     * @param {?} path
     * @param {?=} queryFn
     * @return {?}
     */
    fsColValues(path, queryFn) {
        return this.fsCol(path, queryFn).valueChanges();
    }
    /**
     * @param {?} path
     * @param {?=} queryFn
     * @return {?}
     */
    fsColSnapshot(path, queryFn) {
        return this.fsCol(path, queryFn).snapshotChanges();
    }
    /**
     * @param {?} path
     * @param {?=} queryFn
     * @return {?}
     */
    fsColState(path, queryFn) {
        return this.fsCol(path, queryFn).stateChanges();
    }
    /**
     * @return {?}
     */
    fsBatch() {
        return this.fs().firestore.batch();
    }
    /**
     * @return {?}
     */
    fsNow() {
        return firebase.firestore.FieldValue.serverTimestamp();
    }
    /**
     * @return {?}
     */
    fsTimestamp() {
        return firebase.firestore.Timestamp;
    }
    // fsToMilliseconds(item, field) {
    //   if (item[field] instanceof Timestamp) {
    //     item[field] = (new Date(item[field].seconds * 1000 + item[field].nanoseconds / 1000000)).getTime();
    //   }
    // }
    // fsAddMilliseconds(date) {
    //   date.milliseconds = (new Date(date.seconds * 1000 + date.nanoseconds / 1000000)).getTime();
    //   return date;
    // }
    // fsTransaction<T>(updateFunction: (transaction: firebase.firestore.Timestamp) => Promise<T>): Promise<T> {
    //   return this.fs().firestore.runTransaction(updateFunction);
    // }
    // fsCounter(path, field = 'count', qt = 1) {
    //   return this.fsTransaction(transaction => {
    //     const ref = this.fsDoc(path).ref;
    //     return transaction.get(ref).then((doc) => {
    //
    //       const update = {};
    //
    //       if (doc.exists) {
    //         const value = parseInt(doc.get(field), 10);
    //         qt = value >= 0 || value <= 0 ? qt + value : qt;
    //       }
    //
    //       update[field] = qt;
    //
    //       transaction.set(ref, update, {merge: true});
    //
    //     });
    //   });
    // }
    // fsUp(path, field = 'count') {
    //   return this.fsCounter(path, field, 1);
    // }
    // fsDown(path, field = 'count') {
    //   return this.fsCounter(path, field, -1);
    // }
    // -------------------------------------------------------------------------------------------------------------------
    /**
     * @return {?}
     */
    msn() {
        return this.conn().messaging();
    }
    // -------------------------------------------------------------------------------------------------------------------
    /**
     * @return {?}
     */
    disk() {
        return this.conn().storage();
    }
}
AOFirebaseService.decorators = [
    { type: Injectable, args: [{
                providedIn: 'root'
            },] }
];
/** @nocollapse */
AOFirebaseService.ctorParameters = () => [
    { type: AOFirebaseFactoryService }
];
/** @nocollapse */ AOFirebaseService.ngInjectableDef = i0.ɵɵdefineInjectable({ factory: function AOFirebaseService_Factory() { return new AOFirebaseService(i0.ɵɵinject(i1.AOFirebaseFactoryService)); }, token: AOFirebaseService, providedIn: "root" });
if (false) {
    /**
     * @type {?}
     * @protected
     */
    AOFirebaseService.prototype._name;
    /**
     * @type {?}
     * @private
     */
    AOFirebaseService.prototype._firebase;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYW8tZmlyZWJhc2Uuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL2FvLWFuZ3VsYXIvIiwic291cmNlcyI6WyJsaWIvc2VydmljZXMvYW8tZmlyZWJhc2Uuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFXM0MsT0FBTyxLQUFLLFFBQVEsTUFBTSxjQUFjLENBQUM7QUFHekMsT0FBTyxFQUFFLHdCQUF3QixFQUFFLE1BQU0sK0JBQStCLENBQUM7OztBQU16RSxNQUFNLE9BQU8saUJBQWlCOzs7O0lBSTVCLFlBQ1UsU0FBbUM7UUFBbkMsY0FBUyxHQUFULFNBQVMsQ0FBMEI7UUFIbkMsVUFBSyxHQUFHLFFBQVEsQ0FBQztJQUszQixDQUFDOzs7O0lBRUQsUUFBUTtRQUNOLE9BQU8sSUFBSSxDQUFDLFNBQVMsQ0FBQztJQUN4QixDQUFDOzs7OztJQUVELE9BQU8sQ0FBQyxPQUEwQjtRQUNoQyxPQUFPLElBQUksQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsRUFBRSxPQUFPLENBQUMsQ0FBQztJQUN0RCxDQUFDOzs7O0lBRUQsSUFBSTtRQUNGLE9BQU8sSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxDQUFDLENBQUM7SUFDMUMsQ0FBQzs7OztJQUVELElBQUk7UUFDRixPQUFPLElBQUksQ0FBQyxLQUFLLENBQUM7SUFDcEIsQ0FBQzs7OztJQUVELElBQUk7UUFDRixPQUFPLElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQyxJQUFJLEVBQUUsQ0FBQztJQUM1QixDQUFDOzs7O0lBRUQsR0FBRztRQUNELE9BQU8sSUFBSSxDQUFDLElBQUksRUFBRSxDQUFDLEdBQUcsRUFBRSxDQUFDO0lBQzNCLENBQUM7Ozs7O0lBSUQsSUFBSTtRQUNGLE9BQU8sSUFBSSxDQUFDLElBQUksRUFBRSxDQUFD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QUUsTUFBTTthQUNuQjs7OztZQUxRLHdCQUF3Qjs7Ozs7Ozs7SUFRL0Isa0NBQTJCOzs7OztJQUd6QixzQ0FBMkMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IEFuZ3VsYXJGaXJlQXV0aCB9IGZyb20gJ0Bhbmd1bGFyL2ZpcmUvYXV0aCc7XHJcbmltcG9ydCB7IEFuZ3VsYXJGaXJlRGF0YWJhc2UgfSBmcm9tICdAYW5ndWxhci9maXJlL2RhdGFiYXNlJztcclxuaW1wb3J0IHsgQW5ndWxhckZpcmVTdG9yYWdlIH0gZnJvbSAnQGFuZ3VsYXIvZmlyZS9zdG9yYWdlJztcclxuaW1wb3J0IHsgQW5ndWxhckZpcmVzdG9yZSwgRG9jdW1lbnREYXRhIH0gZnJvbSAnQGFuZ3VsYXIvZmlyZS9maXJlc3RvcmUnO1xyXG5pbXBvcnQgeyBBbmd1bGFyRmlyZU1lc3NhZ2luZyB9IGZyb20gJ0Bhbmd1bGFyL2ZpcmUvbWVzc2FnaW5nJztcclxuaW1wb3J0IHsgRmlyZWJhc2VBcHBDb25maWcgfSBmcm9tICdAYW5ndWxhci9maXJlJztcclxuaW1wb3J0IHsgQW5ndWxhckZpcmVzdG9yZUNvbGxlY3Rpb24gfSBmcm9tICdAYW5ndWxhci9maXJlL2ZpcmVzdG9yZS9jb2xsZWN0aW9uL2NvbGxlY3Rpb24nO1xyXG5pbXBvcnQgeyBBbmd1bGFyRmlyZXN0b3JlRG9jdW1lbnQgfSBmcm9tICdAYW5ndWxhci9maXJlL2ZpcmVzdG9yZS9kb2N1bWVudC9kb2N1bWVudCc7XHJcbmltcG9ydCB7IEFjdGlvbiwgRG9jdW1lbnRDaGFuZ2VBY3Rpb24sIERvY3VtZW50U25hcHNob3QsIFF1ZXJ5Rm4gfSBmcm9tICdAYW5ndWxhci9maXJlL2ZpcmVzdG9yZS9pbnRlcmZhY2VzJztcclxuaW1wb3J0IHsgT2JzZXJ2YWJsZSB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgKiBhcyBmaXJlYmFzZSBmcm9tICdmaXJlYmFzZS9hcHAnO1xyXG5pbXBvcnQgeyBVc2VyIH0gZnJvbSAnZmlyZWJhc2UvYXBwJztcclxuXHJcbmltcG9ydCB7IEFPRmlyZWJhc2VGYWN0b3J5U2VydmljZSB9IGZyb20gJy4vYW8tZmlyZWJhc2UtZmFjdG9yeS5zZXJ2aWNlJztcclxuaW1wb3J0IHsgQU9GaXJlYmFzZUNvbm5lY3Rpb25TZXJ2aWNlIH0gZnJvbSAnLi9hby1maXJlYmFzZS1jb25uZWN0aW9uLnNlcnZpY2UnO1xyXG5cclxuQEluamVjdGFibGUoe1xyXG4gIHByb3ZpZGVkSW46ICdyb290J1xyXG59KVxyXG5leHBvcnQgY2xhc3MgQU9GaXJlYmFzZVNlcnZpY2Uge1xyXG5cclxuICBwcm90ZWN0ZWQgX25hbWUgPSAnbWFzdGVyJztcclxuXHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICBwcml2YXRlIF9maXJlYmFzZTogQU9GaXJlYmFzZUZhY3RvcnlTZXJ2aWNlLFxyXG4gICkge1xyXG4gIH1cclxuXHJcbiAgZmlyZWJhc2UoKTogQU9GaXJlYmFzZUZhY3RvcnlTZXJ2aWNlIHtcclxuICAgIHJldHVybiB0aGlzLl9maXJlYmFzZTtcclxuICB9XHJcblxyXG4gIGZhY3RvcnkoY29uZmlnczogRmlyZWJhc2VBcHBDb25maWcpOiBQcm9taXNlPGJvb2xlYW4+IHtcclxuICAgIHJldHVybiB0aGlzLl9maXJlYmFzZS5mYWN0b3J5KHRoaXMubmFtZSgpLCBjb25maWdzKTtcclxuICB9XHJcblxyXG4gIGNvbm4oKTogQU9GaXJlYmFzZUNvbm5lY3Rpb25TZXJ2aWNlIHtcclxuICAgIHJldHVybiB0aGlzLl9maXJlYmFzZS5jb25uKHRoaXMubmFtZSgpKTtcclxuICB9XHJcblxyXG4gIG5hbWUoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5fbmFtZTtcclxuICB9XHJcblxyXG4gIGhhc2goKSB7XHJcbiAgICByZXR1cm4gdGhpcy5jb25uKCkuaGFzaCgpO1xyXG4gIH1cclxuXHJcbiAgYXBwKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuY29ubigpLmFwcCgpO1xyXG4gIH1cclxuXHJcbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG5cclxuICBhdXRoKCk6IEFuZ3VsYXJGaXJlQXV0aCB7XHJcbiAgICByZXR1cm4gdGhpcy5jb25uKCkuYXV0aCgpO1xyXG4gIH1cclxuXHJcbiAgYXV0aFN0YXRlKCk6IE9ic2VydmFibGU8VXNlciB8IG51bGw+IHtcclxuICAgIHJldHVybiB0aGlzLmF1dGgoKS5hdXRoU3RhdGU7XHJcbiAgfVxyXG5cclxuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcblxyXG4gIGRiKCk6IEFuZ3VsYXJGaXJlRGF0YWJhc2Uge1xyXG4gICAgcmV0dXJuIHRoaXMuY29ubigpLmRhdGFiYXNlKCk7XHJcbiAgfVxyXG5cclxuICBkYk5vdygpIHtcclxuICAgIHJldHVybiBmaXJlYmFzZS5kYXRhYmFzZS5TZXJ2ZXJWYWx1ZS5USU1FU1RBTVA7XHJcbiAgfVxyXG5cclxuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcblxyXG4gIGZzKCk6IEFuZ3VsYXJGaXJlc3RvcmUge1xyXG4gICAgcmV0dXJuIHRoaXMuY29ubigpLmZpcmVzdG9yZSgpO1xyXG4gIH1cclxuXHJcbiAgZnNJZCgpOiBzdHJpbmcge1xyXG4gICAgcmV0dXJuIHRoaXMuZnMoKS5jcmVhdGVJZCgpO1xyXG4gIH1cclxuXHJcbiAgZnNEb2M8VD4ocGF0aDogc3RyaW5nKTogQW5ndWxhckZpcmVzdG9yZURvY3VtZW50PFQ+IHtcclxuICAgIHJldHVybiB0aGlzLmZzKCkuZG9jKHBhdGgpO1xyXG4gIH1cclxuXHJcbiAgZnNEb2NWYWx1ZShwYXRoOiBzdHJpbmcpOiBPYnNlcnZhYmxlPERvY3VtZW50RGF0YSB8IHVuZGVmaW5lZD4ge1xyXG4gICAgcmV0dXJuIHRoaXMuZnNEb2MocGF0aCkudmFsdWVDaGFuZ2VzKCk7XHJcbiAgfVxyXG5cclxuICBmc0RvY1NuYXBzaG90KHBhdGg6IHN0cmluZyk6IE9ic2VydmFibGU8QWN0aW9uPERvY3VtZW50U25hcHNob3Q8RG9jdW1lbnREYXRhPj4+IHtcclxuICAgIHJldHVybiB0aGlzLmZzKCkuZG9jKHBhdGgpLnNuYXBzaG90Q2hhbmdlcygpO1xyXG4gIH1cclxuXHJcbiAgZnNEb2NTZXQocGF0aDogc3RyaW5nLCBkYXRhOiBhbnksIG9wdGlvbnMgPSB7bWVyZ2U6IHRydWV9KTogUHJvbWlzZTx2b2lkPiB7XHJcbiAgICByZXR1cm4gdGhpcy5mcygpLmRvYyhwYXRoKS5zZXQoZGF0YSwgb3B0aW9ucyk7XHJcbiAgfVxyXG5cclxuICBmc0NvbDxUPihwYXRoOiBzdHJpbmcsIHF1ZXJ5Rm4/OiBRdWVyeUZuKTogQW5ndWxhckZpcmVzdG9yZUNvbGxlY3Rpb248VD4ge1xyXG4gICAgcmV0dXJuIHRoaXMuZnMoKS5jb2xsZWN0aW9uKHBhdGgsIHF1ZXJ5Rm4pO1xyXG4gIH1cclxuXHJcbiAgZnNDb2xWYWx1ZXMocGF0aDogc3RyaW5nLCBxdWVyeUZuPzogUXVlcnlGbik6IE9ic2VydmFibGU8RG9jdW1lbnREYXRhW10+IHtcclxuICAgIHJldHVybiB0aGlzLmZzQ29sKHBhdGgsIHF1ZXJ5Rm4pLnZhbHVlQ2hhbmdlcygpO1xyXG4gIH1cclxuXHJcbiAgZnNDb2xTbmFwc2hvdChwYXRoOiBzdHJpbmcsIHF1ZXJ5Rm4/OiBRdWVyeUZuKTogT2JzZXJ2YWJsZTxEb2N1bWVudENoYW5nZUFjdGlvbjxEb2N1bWVudERhdGE+W10+IHtcclxuICAgIHJldHVybiB0aGlzLmZzQ29sKHBhdGgsIHF1ZXJ5Rm4pLnNuYXBzaG90Q2hhbmdlcygpO1xyXG4gIH1cclxuXHJcbiAgZnNDb2xTdGF0ZShwYXRoOiBzdHJpbmcsIHF1ZXJ5Rm4/OiBRdWVyeUZuKTogT2JzZXJ2YWJsZTxEb2N1bWVudENoYW5nZUFjdGlvbjxEb2N1bWVudERhdGE+W10+IHtcclxuICAgIHJldHVybiB0aGlzLmZzQ29sKHBhdGgsIHF1ZXJ5Rm4pLnN0YXRlQ2hhbmdlcygpO1xyXG4gIH1cclxuXHJcbiAgZnNCYXRjaCgpIHtcclxuICAgIHJldHVybiB0aGlzLmZzKCkuZmlyZXN0b3JlLmJhdGNoKCk7XHJcbiAgfVxyXG5cclxuICBmc05vdygpIHtcclxuICAgIHJldHVybiBmaXJlYmFzZS5maXJlc3RvcmUuRmllbGRWYWx1ZS5zZXJ2ZXJUaW1lc3RhbXAoKTtcclxuICB9XHJcblxyXG4gIGZzVGltZXN0YW1wKCkge1xyXG4gICAgcmV0dXJuIGZpcmViYXNlLmZpcmVzdG9yZS5UaW1lc3RhbXA7XHJcbiAgfVxyXG5cclxuICAvLyBmc1RvTWlsbGlzZWNvbmRzKGl0ZW0sIGZpZWxkKSB7XHJcbiAgLy8gICBpZiAoaXRlbVtmaWVsZF0gaW5zdGFuY2VvZiBUaW1lc3RhbXApIHtcclxuICAvLyAgICAgaXRlbVtmaWVsZF0gPSAobmV3IERhdGUoaXRlbVtmaWVsZF0uc2Vjb25kcyAqIDEwMDAgKyBpdGVtW2ZpZWxkXS5uYW5vc2Vjb25kcyAvIDEwMDAwMDApKS5nZXRUaW1lKCk7XHJcbiAgLy8gICB9XHJcbiAgLy8gfVxyXG5cclxuICAvLyBmc0FkZE1pbGxpc2Vjb25kcyhkYXRlKSB7XHJcbiAgLy8gICBkYXRlLm1pbGxpc2Vjb25kcyA9IChuZXcgRGF0ZShkYXRlLnNlY29uZHMgKiAxMDAwICsgZGF0ZS5uYW5vc2Vjb25kcyAvIDEwMDAwMDApKS5nZXRUaW1lKCk7XHJcbiAgLy8gICByZXR1cm4gZGF0ZTtcclxuICAvLyB9XHJcblxyXG4gIC8vIGZzVHJhbnNhY3Rpb248VD4odXBkYXRlRnVuY3Rpb246ICh0cmFuc2FjdGlvbjogZmlyZWJhc2UuZmlyZXN0b3JlLlRpbWVzdGFtcCkgPT4gUHJvbWlzZTxUPik6IFByb21pc2U8VD4ge1xyXG4gIC8vICAgcmV0dXJuIHRoaXMuZnMoKS5maXJlc3RvcmUucnVuVHJhbnNhY3Rpb24odXBkYXRlRnVuY3Rpb24pO1xyXG4gIC8vIH1cclxuXHJcbiAgLy8gZnNDb3VudGVyKHBhdGgsIGZpZWxkID0gJ2NvdW50JywgcXQgPSAxKSB7XHJcbiAgLy8gICByZXR1cm4gdGhpcy5mc1RyYW5zYWN0aW9uKHRyYW5zYWN0aW9uID0+IHtcclxuICAvLyAgICAgY29uc3QgcmVmID0gdGhpcy5mc0RvYyhwYXRoKS5yZWY7XHJcbiAgLy8gICAgIHJldHVybiB0cmFuc2FjdGlvbi5nZXQocmVmKS50aGVuKChkb2MpID0+IHtcclxuICAvL1xyXG4gIC8vICAgICAgIGNvbnN0IHVwZGF0ZSA9IHt9O1xyXG4gIC8vXHJcbiAgLy8gICAgICAgaWYgKGRvYy5leGlzdHMpIHtcclxuICAvLyAgICAgICAgIGNvbnN0IHZhbHVlID0gcGFyc2VJbnQoZG9jLmdldChmaWVsZCksIDEwKTtcclxuICAvLyAgICAgICAgIHF0ID0gdmFsdWUgPj0gMCB8fCB2YWx1ZSA8PSAwID8gcXQgKyB2YWx1ZSA6IHF0O1xyXG4gIC8vICAgICAgIH1cclxuICAvL1xyXG4gIC8vICAgICAgIHVwZGF0ZVtmaWVsZF0gPSBxdDtcclxuICAvL1xyXG4gIC8vICAgICAgIHRyYW5zYWN0aW9uLnNldChyZWYsIHVwZGF0ZSwge21lcmdlOiB0cnVlfSk7XHJcbiAgLy9cclxuICAvLyAgICAgfSk7XHJcbiAgLy8gICB9KTtcclxuICAvLyB9XHJcblxyXG4gIC8vIGZzVXAocGF0aCwgZmllbGQgPSAnY291bnQnKSB7XHJcbiAgLy8gICByZXR1cm4gdGhpcy5mc0NvdW50ZXIocGF0aCwgZmllbGQsIDEpO1xyXG4gIC8vIH1cclxuXHJcbiAgLy8gZnNEb3duKHBhdGgsIGZpZWxkID0gJ2NvdW50Jykge1xyXG4gIC8vICAgcmV0dXJuIHRoaXMuZnNDb3VudGVyKHBhdGgsIGZpZWxkLCAtMSk7XHJcbiAgLy8gfVxyXG5cclxuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcblxyXG4gIG1zbigpOiBBbmd1bGFyRmlyZU1lc3NhZ2luZyB7XHJcbiAgICByZXR1cm4gdGhpcy5jb25uKCkubWVzc2FnaW5nKCk7XHJcbiAgfVxyXG5cclxuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcblxyXG4gIGRpc2soKTogQW5ndWxhckZpcmVTdG9yYWdlIHtcclxuICAgIHJldHVybiB0aGlzLmNvbm4oKS5zdG9yYWdlKCk7XHJcbiAgfVxyXG5cclxuICAvLyBmc0xpbmtGcmVlKGJ1Y2tldCwgcGF0aCkge1xyXG4gIC8vICAgcmV0dXJuICdodHRwczovL2ZpcmViYXNlc3RvcmFnZS5nb29nbGVhcGlzLmNvbS92MC9iLycgKyBidWNrZXQgKyAnL28vJyArIHBhdGguc3BsaXQoJy8nKS5qb2luKCclMkYnKSArICc/YWx0PW1lZGlhJztcclxuICAvLyB9XHJcblxyXG4gIC8vIGFzeW5jIGZzVXBsb2FkKGZpbGUsIGNvbmZpZ3MpOiBQcm9taXNlPGFueT4ge1xyXG4gIC8vICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKTtcclxuICAvLyAgIGNvbnN0IGV4dGVuc2lvbiA9IC8oPzpcXC4oW14uXSspKT8kLztcclxuICAvLyAgIGNvbnN0IGRhdGE6IGFueSA9IHt9O1xyXG4gIC8vXHJcbiAgLy8gICBkYXRhLmlkID0gdGhpcy5mc0lkKCk7XHJcbiAgLy8gICBkYXRhLm1kNSA9IChhd2FpdCBBT1V0aWwubWQ1RmlsZShmaWxlKSkgYXMgc3RyaW5nO1xyXG4gIC8vICAgZGF0YS5leHRlbnNpb24gPSAoZXh0ZW5zaW9uLmV4ZWMoZmlsZS5uYW1lKVsxXSkudG9Mb3dlckNhc2UoKTtcclxuICAvLyAgIGRhdGEubmFtZSA9IGZpbGUubmFtZS5zdWJzdHIoMCwgZmlsZS5uYW1lLmxlbmd0aCAtIGRhdGEuZXh0ZW5zaW9uLmxlbmd0aCAtIDEpO1xyXG4gIC8vICAgZGF0YS5zaXplID0gZmlsZS5zaXplO1xyXG4gIC8vICAgZGF0YS5taW1ldHlwZSA9IGZpbGUudHlwZTtcclxuICAvLyAgIGRhdGEubW9kaWZpZWRfYXQgPSBmaWxlLmxhc3RNb2RpZmllZDtcclxuICAvLyAgIGRhdGEuZm9sZGVyID0gJy8nICsgWydmaWxlcycsIG5vdy5nZXRVVENGdWxsWWVhcigpLCBub3cuZ2V0VVRDTW9udGgoKSArIDEsIG5vdy5nZXRVVENEYXRlKCldLmpvaW4oJy8nKTtcclxuICAvLyAgIGRhdGEucGF0aCA9IGRhdGEuZm9sZGVyICsgJy8nICsgZGF0YS5pZCArICcuJyArIGRhdGEuZXh0ZW5zaW9uO1xyXG4gIC8vICAgZGF0YS5hY3RpdmUgPSB0cnVlO1xyXG4gIC8vICAgZGF0YS5jcmVhdGVkX2F0ID0gdGhpcy5mc05vdygpO1xyXG4gIC8vICAgZGF0YS51cGRhdGVkX2F0ID0gbnVsbDtcclxuICAvLyAgIGRhdGEuZGVsZXRlZF9hdCA9IG51bGw7XHJcbiAgLy9cclxuICAvLyAgIGlmIChjb25maWdzLnR5cGVzICYmIGNvbmZpZ3MudHlwZXMuaW5kZXhPZihkYXRhLm1pbWV0eXBlKSA9PSAtMSkge1xyXG4gIC8vICAgICB0aHJvdyBuZXcgRXJyb3IoJ1RpcG8gSW52w6FsaWRvOiAnICsgZmlsZS5uYW1lKTtcclxuICAvLyAgIH1cclxuICAvLyAgIGlmIChjb25maWdzLmV4dGVuc2lvbnMgJiYgY29uZmlncy5leHRlbnNpb25zLmluZGV4T2YoZGF0YS5leHRlbnNpb24pID09IC0xKSB7XHJcbiAgLy8gICAgIHRocm93IG5ldyBFcnJvcignRXh0ZW5zw6NvIGludsOhbGlkYTogJyArIGZpbGUubmFtZSk7XHJcbiAgLy8gICB9XHJcbiAgLy8gICBpZiAoY29uZmlncy5zaXplICYmIGNvbmZpZ3Muc2l6ZSA8IGRhdGEuc2l6ZSkge1xyXG4gIC8vICAgICB0aHJvdyBuZXcgRXJyb3IoJ011aXRvIGdyYW5kZTogJyArIGZpbGUubmFtZSk7XHJcbiAgLy8gICB9XHJcbiAgLy9cclxuICAvLyAgIGNvbnN0IHNuYXBzaG90ID0gPGFueT5hd2FpdCB0aGlzLmZzQ29sKCcvZmlsZXMnLCBxID0+IHEud2hlcmUoJ21kNScsICc9PScsIGRhdGEubWQ1KS5saW1pdCgxKSkuZ2V0KCkudG9Qcm9taXNlKCk7XHJcbiAgLy8gICBpZiAoY29uZmlncy5kdXBsaWNhdGUgPT09IGZhbHNlICYmIHNuYXBzaG90LmRvY3MubGVuZ3RoID4gMCkge1xyXG4gIC8vICAgICB0aHJvdyBuZXcgRXJyb3IoJ0rDoSBleGlzdGU6ICcgKyBmaWxlLm5hbWUpO1xyXG4gIC8vICAgfVxyXG4gIC8vXHJcbiAgLy8gICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG4gIC8vXHJcbiAgLy8gICAgIGlmIChzbmFwc2hvdC5kb2NzLmxlbmd0aCA+IDApIHtcclxuICAvLyAgICAgICByZXR1cm4gcmVzb2x2ZShzbmFwc2hvdC5kb2NzWzBdLmRhdGEoKSk7XHJcbiAgLy8gICAgIH1cclxuICAvL1xyXG4gIC8vICAgICBjb25zdCB0YXNrID0gdGhpcy5zdG9yYWdlKCkudXBsb2FkKGRhdGEucGF0aCwgZmlsZSk7XHJcbiAgLy9cclxuICAvLyAgICAgdGFzay50aGVuKHNuYXBzaG90ID0+IHtcclxuICAvLyAgICAgICBkYXRhLm1ldGFkYXRhID0gQU9VdGlsLnVuZGVmaW5lZFRvTnVsbChPYmplY3QuYXNzaWduKHt9LCBzbmFwc2hvdC5tZXRhZGF0YSkpO1xyXG4gIC8vICAgICAgIHRoaXMuZnNEb2MoJy9maWxlcy8nICsgZGF0YS5pZCkuc2V0KGRhdGEpLnRoZW4oKCkgPT4ge1xyXG4gIC8vICAgICAgICAgcmV0dXJuIHJlc29sdmUoZGF0YSk7XHJcbiAgLy8gICAgICAgfSk7XHJcbiAgLy8gICAgIH0pO1xyXG4gIC8vXHJcbiAgLy8gICB9KTtcclxuICAvLyB9XHJcblxyXG4gIC8vIHVwbG9hZGVyKCk6IEFPRmlyZWJhc2VVcGxvYWRlclNlcnZpY2Uge1xyXG4gIC8vICAgcmV0dXJuIG5ldyBBT0ZpcmViYXNlVXBsb2FkZXJTZXJ2aWNlKHRoaXMpO1xyXG4gIC8vIH1cclxuXHJcbn1cclxuIl19