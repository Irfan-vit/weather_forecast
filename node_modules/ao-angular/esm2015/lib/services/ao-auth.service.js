/**
 * @fileoverview added by tsickle
 * Generated from: lib/services/ao-auth.service.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { EventEmitter, Injectable } from '@angular/core';
import { NavController } from '@ionic/angular';
import { LocalStorage } from 'ngx-webstorage';
import { BehaviorSubject } from 'rxjs';
import { AOService } from './ao.service';
import * as i0 from "@angular/core";
import * as i1 from "@ionic/angular";
import * as i2 from "./ao.service";
// @dynamic
export class AOAuthService {
    // -------------------------------------------------------------------------------------------------------------------
    /**
     * @param {?} _nav
     * @param {?} _ao
     */
    constructor(_nav, _ao) {
        this._nav = _nav;
        this._ao = _ao;
        this._redirect_default = '/';
        this.redirect = (/**
         * @return {?}
         */
        () => this._redirect);
        this.user = (/**
         * @return {?}
         */
        () => this._user);
        // -------------------------------------------------------------------------------------------------------------------
        this.isUser = (/**
         * @return {?}
         */
        () => !!this._user);
        this.isGuest = (/**
         * @return {?}
         */
        () => !this._user);
        this.id = (/**
         * @return {?}
         */
        () => this.isUser() ? this.user().id : null);
        this.name = (/**
         * @return {?}
         */
        () => this.isUser() ? this.user().name : null);
        this.email = (/**
         * @return {?}
         */
        () => this.isUser() ? this.user().email : null);
        this.image = (/**
         * @return {?}
         */
        () => this.isUser() ? this.user().image : null);
        this.verified = (/**
         * @return {?}
         */
        () => this.isUser() ? this.user().verified : null);
        this.permitions = (/**
         * @return {?}
         */
        () => this.isUser() ? this.user().permitions : null);
        // -------------------------------------------------------------------------------------------------------------------
        this.onLogin = (/**
         * @return {?}
         */
        () => AOAuthService._onLogin);
        this.onLogout = (/**
         * @return {?}
         */
        () => AOAuthService._onLogout);
        this.onChange = (/**
         * @return {?}
         */
        () => AOAuthService._onChange);
        AOAuthService._onChange = new BehaviorSubject(this.user());
    }
    // -------------------------------------------------------------------------------------------------------------------
    /**
     * @param {?=} provider
     * @return {?}
     */
    provider(provider = null) {
        if (provider == null) {
            return this._provider;
        }
        this._provider = provider;
        return this;
    }
    // -------------------------------------------------------------------------------------------------------------------
    /**
     * @template THIS
     * @this {THIS}
     * @param {?} redirect
     * @return {THIS}
     */
    setRedirect(redirect) {
        (/** @type {?} */ (this))._redirect = redirect;
        return (/** @type {?} */ (this));
    }
    // -------------------------------------------------------------------------------------------------------------------
    /**
     * @template THIS
     * @this {THIS}
     * @param {?} user
     * @return {THIS}
     */
    setUser(user) {
        (/** @type {?} */ (this))._user = user;
        (/** @type {?} */ (this)).onChange().next((/** @type {?} */ (this))._user);
        return (/** @type {?} */ (this));
    }
    // -------------------------------------------------------------------------------------------------------------------
    /**
     * @param {?} data
     * @return {?}
     */
    login(data) {
        return this._ao.wait(this.provider().login(data)).then((/**
         * @param {?} user
         * @return {?}
         */
        (user) => {
            this.setUser(user);
            this.onLogin().emit();
            /** @type {?} */
            const redirect = this._redirect && this._redirect !== '/login'
                ? this._redirect
                : this._redirect_default;
            this._redirect = null;
            return this._nav.navigateRoot(redirect);
        }));
    }
    /**
     * @return {?}
     */
    logout() {
        return this._ao.wait(this.provider().logout()).then((/**
         * @return {?}
         */
        () => {
            this.setUser(null);
            this.onLogout();
            return this._nav.navigateRoot('/login');
        }));
    }
    /**
     * @param {?} data
     * @return {?}
     */
    update(data) {
        return this._ao.wait(this.provider().update(data));
    }
    /**
     * @param {?} data
     * @return {?}
     */
    updatePassword(data) {
        return this._ao.wait(this.provider().updatePassword(data));
    }
    /**
     * @param {?} data
     * @return {?}
     */
    forgetPassword(data) {
        return this._ao.wait(this.provider().forgetPassword(data));
    }
    /**
     * @param {?} data
     * @return {?}
     */
    resetPassword(data) {
        return this._ao.wait(this.provider().resetPassword(data));
    }
}
AOAuthService._onLogin = new EventEmitter();
AOAuthService._onLogout = new EventEmitter();
AOAuthService.decorators = [
    { type: Injectable, args: [{
                providedIn: 'root'
            },] }
];
/** @nocollapse */
AOAuthService.ctorParameters = () => [
    { type: NavController },
    { type: AOService }
];
/** @nocollapse */ AOAuthService.ngInjectableDef = i0.ɵɵdefineInjectable({ factory: function AOAuthService_Factory() { return new AOAuthService(i0.ɵɵinject(i1.NavController), i0.ɵɵinject(i2.AOService)); }, token: AOAuthService, providedIn: "root" });
tslib_1.__decorate([
    LocalStorage('user'),
    tslib_1.__metadata("design:type", Object)
], AOAuthService.prototype, "_user", void 0);
tslib_1.__decorate([
    LocalStorage('redirect'),
    tslib_1.__metadata("design:type", String)
], AOAuthService.prototype, "_redirect", void 0);
if (false) {
    /** @type {?} */
    AOAuthService._onLogin;
    /** @type {?} */
    AOAuthService._onLogout;
    /** @type {?} */
    AOAuthService._onChange;
    /**
     * @type {?}
     * @private
     */
    AOAuthService.prototype._user;
    /**
     * @type {?}
     * @private
     */
    AOAuthService.prototype._redirect;
    /**
     * @type {?}
     * @private
     */
    AOAuthService.prototype._redirect_default;
    /**
     * @type {?}
     * @private
     */
    AOAuthService.prototype._provider;
    /** @type {?} */
    AOAuthService.prototype.redirect;
    /** @type {?} */
    AOAuthService.prototype.user;
    /** @type {?} */
    AOAuthService.prototype.isUser;
    /** @type {?} */
    AOAuthService.prototype.isGuest;
    /** @type {?} */
    AOAuthService.prototype.id;
    /** @type {?} */
    AOAuthService.prototype.name;
    /** @type {?} */
    AOAuthService.prototype.email;
    /** @type {?} */
    AOAuthService.prototype.image;
    /** @type {?} */
    AOAuthService.prototype.verified;
    /** @type {?} */
    AOAuthService.prototype.permitions;
    /** @type {?} */
    AOAuthService.prototype.onLogin;
    /** @type {?} */
    AOAuthService.prototype.onLogout;
    /** @type {?} */
    AOAuthService.prototype.onChange;
    /**
     * @type {?}
     * @private
     */
    AOAuthService.prototype._nav;
    /**
     * @type {?}
     * @private
     */
    AOAuthService.prototype._ao;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYW8tYXV0aC5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vYW8tYW5ndWxhci8iLCJzb3VyY2VzIjpbImxpYi9zZXJ2aWNlcy9hby1hdXRoLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsT0FBTyxFQUFFLFlBQVksRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDekQsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQy9DLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUM5QyxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBRXZDLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxjQUFjLENBQUM7Ozs7O0FBUXpDLE1BQU0sT0FBTyxhQUFhOzs7Ozs7SUFrQnhCLFlBQ1UsSUFBbUIsRUFDbkIsR0FBYztRQURkLFNBQUksR0FBSixJQUFJLENBQWU7UUFDbkIsUUFBRyxHQUFILEdBQUcsQ0FBVztRQWRoQixzQkFBaUIsR0FBRyxHQUFHLENBQUM7UUFzQ2hDLGFBQVE7OztRQUFHLEdBQUcsRUFBRSxDQUFDLElBQUksQ0FBQyxTQUFTLEVBQUM7UUFZaEMsU0FBSTs7O1FBQUcsR0FBRyxFQUFFLENBQUMsSUFBSSxDQUFDLEtBQUssRUFBQzs7UUFJeEIsV0FBTTs7O1FBQUcsR0FBRyxFQUFFLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLEVBQUM7UUFFNUIsWUFBTzs7O1FBQUcsR0FBRyxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxFQUFDO1FBRTVCLE9BQUU7OztRQUFHLEdBQUcsRUFBRSxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsSUFBSSxFQUFDO1FBRWpELFNBQUk7OztRQUFHLEdBQUcsRUFBRSxDQUFDLElBQUksQ0FBQyxN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QUUsTUFBTTthQUNuQjs7OztZQVhRLGFBQWE7WUFJYixTQUFTOzs7QUFVTTtJQUFyQixZQUFZLENBQUMsTUFBTSxDQUFDOzs0Q0FBb0I7QUFFZjtJQUF6QixZQUFZLENBQUMsVUFBVSxDQUFDOztnREFBMkI7OztJQU1wRCx1QkFBcUU7O0lBRXJFLHdCQUF1RTs7SUFFdkUsd0JBQThDOzs7OztJQVo5Qyw4QkFBeUM7Ozs7O0lBRXpDLGtDQUFvRDs7Ozs7SUFFcEQsMENBQWdDOzs7OztJQUVoQyxrQ0FBMkM7O0lBb0MzQyxpQ0FBZ0M7O0lBWWhDLDZCQUF3Qjs7SUFJeEIsK0JBQTRCOztJQUU1QixnQ0FBNEI7O0lBRTVCLDJCQUFpRDs7SUFFakQsNkJBQXFEOztJQUVyRCw4QkFBdUQ7O0lBRXZELDhCQUF1RDs7SUFFdkQsaUNBQTZEOztJQUU3RCxtQ0FBaUU7O0lBSWpFLGdDQUF1Qzs7SUFFdkMsaUNBQXlDOztJQUV6QyxpQ0FBeUM7Ozs7O0lBL0R2Qyw2QkFBMkI7Ozs7O0lBQzNCLDRCQUFzQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEV2ZW50RW1pdHRlciwgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBOYXZDb250cm9sbGVyIH0gZnJvbSAnQGlvbmljL2FuZ3VsYXInO1xyXG5pbXBvcnQgeyBMb2NhbFN0b3JhZ2UgfSBmcm9tICduZ3gtd2Vic3RvcmFnZSc7XHJcbmltcG9ydCB7IEJlaGF2aW9yU3ViamVjdCB9IGZyb20gJ3J4anMnO1xyXG5cclxuaW1wb3J0IHsgQU9TZXJ2aWNlIH0gZnJvbSAnLi9hby5zZXJ2aWNlJztcclxuaW1wb3J0IHsgQU9BdXRoUHJvdmlkZXJJbnRlcmZhY2UgfSBmcm9tICcuL2FvLWF1dGgtcHJvdmlkZXIuaW50ZXJmYWNlJztcclxuXHJcbi8vIEBkeW5hbWljXHJcblxyXG5ASW5qZWN0YWJsZSh7XHJcbiAgcHJvdmlkZWRJbjogJ3Jvb3QnXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBBT0F1dGhTZXJ2aWNlIHtcclxuXHJcbiAgQExvY2FsU3RvcmFnZSgndXNlcicpIHByaXZhdGUgX3VzZXI6IGFueTtcclxuXHJcbiAgQExvY2FsU3RvcmFnZSgncmVkaXJlY3QnKSBwcml2YXRlIF9yZWRpcmVjdDogc3RyaW5nO1xyXG5cclxuICBwcml2YXRlIF9yZWRpcmVjdF9kZWZhdWx0ID0gJy8nO1xyXG5cclxuICBwcml2YXRlIF9wcm92aWRlcjogQU9BdXRoUHJvdmlkZXJJbnRlcmZhY2U7XHJcblxyXG4gIHB1YmxpYyBzdGF0aWMgX29uTG9naW46IEV2ZW50RW1pdHRlcjx2b2lkPiA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xyXG5cclxuICBwdWJsaWMgc3RhdGljIF9vbkxvZ291dDogRXZlbnRFbWl0dGVyPHZvaWQ+ID0gbmV3IEV2ZW50RW1pdHRlcjx2b2lkPigpO1xyXG5cclxuICBwdWJsaWMgc3RhdGljIF9vbkNoYW5nZTogQmVoYXZpb3JTdWJqZWN0PGFueT47XHJcblxyXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cclxuXHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICBwcml2YXRlIF9uYXY6IE5hdkNvbnRyb2xsZXIsXHJcbiAgICBwcml2YXRlIF9hbzogQU9TZXJ2aWNlLFxyXG4gICkge1xyXG4gICAgQU9BdXRoU2VydmljZS5fb25DaGFuZ2UgPSBuZXcgQmVoYXZpb3JTdWJqZWN0PGFueT4odGhpcy51c2VyKCkpO1xyXG4gIH1cclxuXHJcbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG5cclxuICBwcm92aWRlcihwcm92aWRlcjogQU9BdXRoUHJvdmlkZXJJbnRlcmZhY2UgPSBudWxsKTogQU9BdXRoUHJvdmlkZXJJbnRlcmZhY2UgfCB0aGlzIHtcclxuICAgIGlmIChwcm92aWRlciA9PSBudWxsKSB7XHJcbiAgICAgIHJldHVybiB0aGlzLl9wcm92aWRlcjtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLl9wcm92aWRlciA9IHByb3ZpZGVyO1xyXG5cclxuICAgIHJldHVybiB0aGlzO1xyXG4gIH1cclxuXHJcbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG5cclxuICBzZXRSZWRpcmVjdChyZWRpcmVjdCkge1xyXG4gICAgdGhpcy5fcmVkaXJlY3QgPSByZWRpcmVjdDtcclxuICAgIHJldHVybiB0aGlzO1xyXG4gIH1cclxuXHJcbiAgcmVkaXJlY3QgPSAoKSA9PiB0aGlzLl9yZWRpcmVjdDtcclxuXHJcbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG5cclxuICBzZXRVc2VyKHVzZXIpIHtcclxuICAgIHRoaXMuX3VzZXIgPSB1c2VyO1xyXG5cclxuICAgIHRoaXMub25DaGFuZ2UoKS5uZXh0KHRoaXMuX3VzZXIpO1xyXG5cclxuICAgIHJldHVybiB0aGlzO1xyXG4gIH1cclxuXHJcbiAgdXNlciA9ICgpID0+IHRoaXMuX3VzZXI7XHJcblxyXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cclxuXHJcbiAgaXNVc2VyID0gKCkgPT4gISF0aGlzLl91c2VyO1xyXG5cclxuICBpc0d1ZXN0ID0gKCkgPT4gIXRoaXMuX3VzZXI7XHJcblxyXG4gIGlkID0gKCkgPT4gdGhpcy5pc1VzZXIoKSA/IHRoaXMudXNlcigpLmlkIDogbnVsbDtcclxuXHJcbiAgbmFtZSA9ICgpID0+IHRoaXMuaXNVc2VyKCkgPyB0aGlzLnVzZXIoKS5uYW1lIDogbnVsbDtcclxuXHJcbiAgZW1haWwgPSAoKSA9PiB0aGlzLmlzVXNlcigpID8gdGhpcy51c2VyKCkuZW1haWwgOiBudWxsO1xyXG5cclxuICBpbWFnZSA9ICgpID0+IHRoaXMuaXNVc2VyKCkgPyB0aGlzLnVzZXIoKS5pbWFnZSA6IG51bGw7XHJcblxyXG4gIHZlcmlmaWVkID0gKCkgPT4gdGhpcy5pc1VzZXIoKSA/IHRoaXMudXNlcigpLnZlcmlmaWVkIDogbnVsbDtcclxuXHJcbiAgcGVybWl0aW9ucyA9ICgpID0+IHRoaXMuaXNVc2VyKCkgPyB0aGlzLnVzZXIoKS5wZXJtaXRpb25zIDogbnVsbDtcclxuXHJcbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG5cclxuICBvbkxvZ2luID0gKCkgPT4gQU9BdXRoU2VydmljZS5fb25Mb2dpbjtcclxuXHJcbiAgb25Mb2dvdXQgPSAoKSA9PiBBT0F1dGhTZXJ2aWNlLl9vbkxvZ291dDtcclxuXHJcbiAgb25DaGFuZ2UgPSAoKSA9PiBBT0F1dGhTZXJ2aWNlLl9vbkNoYW5nZTtcclxuXHJcbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG5cclxuICBsb2dpbihkYXRhOiBhbnkpOiBQcm9taXNlPGFueT4ge1xyXG4gICAgcmV0dXJuIHRoaXMuX2FvLndhaXQodGhpcy5wcm92aWRlcigpLmxvZ2luKGRhdGEpKS50aGVuKCh1c2VyKSA9PiB7XHJcblxyXG4gICAgICB0aGlzLnNldFVzZXIodXNlcik7XHJcbiAgICAgIHRoaXMub25Mb2dpbigpLmVtaXQoKTtcclxuXHJcbiAgICAgIGNvbnN0IHJlZGlyZWN0ID0gdGhpcy5fcmVkaXJlY3QgJiYgdGhpcy5fcmVkaXJlY3QgIT09ICcvbG9naW4nXHJcbiAgICAgICAgPyB0aGlzLl9yZWRpcmVjdFxyXG4gICAgICAgIDogdGhpcy5fcmVkaXJlY3RfZGVmYXVsdDtcclxuXHJcbiAgICAgIHRoaXMuX3JlZGlyZWN0ID0gbnVsbDtcclxuXHJcbiAgICAgIHJldHVybiB0aGlzLl9uYXYubmF2aWdhdGVSb290KHJlZGlyZWN0KTtcclxuXHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGxvZ291dCgpOiBQcm9taXNlPGFueT4ge1xyXG4gICAgcmV0dXJuIHRoaXMuX2FvLndhaXQodGhpcy5wcm92aWRlcigpLmxvZ291dCgpKS50aGVuKCgpID0+IHtcclxuXHJcbiAgICAgIHRoaXMuc2V0VXNlcihudWxsKTtcclxuICAgICAgdGhpcy5vbkxvZ291dCgpO1xyXG5cclxuICAgICAgcmV0dXJuIHRoaXMuX25hdi5uYXZpZ2F0ZVJvb3QoJy9sb2dpbicpO1xyXG5cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgdXBkYXRlKGRhdGE6IGFueSk6IFByb21pc2U8YW55PiB7XHJcbiAgICByZXR1cm4gdGhpcy5fYW8ud2FpdCh0aGlzLnByb3ZpZGVyKCkudXBkYXRlKGRhdGEpKTtcclxuICB9XHJcblxyXG4gIHVwZGF0ZVBhc3N3b3JkKGRhdGE6IGFueSk6IFByb21pc2U8YW55PiB7XHJcbiAgICByZXR1cm4gdGhpcy5fYW8ud2FpdCh0aGlzLnByb3ZpZGVyKCkudXBkYXRlUGFzc3dvcmQoZGF0YSkpO1xyXG4gIH1cclxuXHJcbiAgZm9yZ2V0UGFzc3dvcmQoZGF0YTogYW55KTogUHJvbWlzZTxhbnk+IHtcclxuICAgIHJldHVybiB0aGlzLl9hby53YWl0KHRoaXMucHJvdmlkZXIoKS5mb3JnZXRQYXNzd29yZChkYXRhKSk7XHJcbiAgfVxyXG5cclxuICByZXNldFBhc3N3b3JkKGRhdGE6IGFueSk6IFByb21pc2U8YW55PiB7XHJcbiAgICByZXR1cm4gdGhpcy5fYW8ud2FpdCh0aGlzLnByb3ZpZGVyKCkucmVzZXRQYXNzd29yZChkYXRhKSk7XHJcbiAgfVxyXG5cclxufVxyXG4iXX0=