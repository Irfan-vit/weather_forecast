/**
 * @fileoverview added by tsickle
 * Generated from: lib/helpers/ao-tree.helpers.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
export class AONodeItem {
    constructor() {
        this.level = 0;
        this.expanded = false;
    }
    /**
     * @return {?}
     */
    isExpanded() {
        return this.expanded;
    }
    /**
     * @return {?}
     */
    isExpandable() {
        return this.children.length > 0;
    }
}
if (false) {
    /** @type {?} */
    AONodeItem.prototype.data;
    /** @type {?} */
    AONodeItem.prototype.level;
    /** @type {?} */
    AONodeItem.prototype.children;
    /** @type {?} */
    AONodeItem.prototype.expanded;
}
export class AOTreeHelper {
    /**
     * @param {?} _zone
     */
    constructor(_zone) {
        this._zone = _zone;
        this.map = new Map();
        this.tree = [];
    }
    //--------------------------------------------------------------------------------------------------------------------
    // STATIC METHODS
    //--------------------------------------------------------------------------------------------------------------------
    /**
     * @param {?} items
     * @param {?=} map
     * @param {?=} fk_name
     * @param {?=} pk_name
     * @return {?}
     */
    static listToTree(items, map, fk_name = 'parent_id', pk_name = 'id') {
        //
        // inicializa o map, se ainda nao tiver sido inicializado
        //
        if (map == undefined) {
            map = new Map();
        }
        //
        // funcao para criar todos os nodes necessarios
        //
        /** @type {?} */
        const create = (/**
         * @param {?} data
         * @return {?}
         */
        (data) => {
            /** @type {?} */
            let node = map.get(data[pk_name]);
            if (node == undefined) {
                node = new AONodeItem();
            }
            node.data = data;
            node.children = [];
            map.set(data[pk_name], node);
            return node;
        });
        //
        // aninha todos os nodes do map
        //
        /** @type {?} */
        const nest = (/**
         * @param {?} root
         * @param {?} node
         * @return {?}
         */
        (root, node) => {
            /** @type {?} */
            const parent = node.data[fk_name] ? map.get(node.data[fk_name]) : undefined;
            if (parent) {
                node.level = parent.level + 1;
                parent.children.push(node);
            }
            else {
                root.push(node);
            }
            return root;
        });
        return {
            map, tree: items.map(create).reduce(nest, [])
        };
    }
    /**
     * @param {?} tree
     * @return {?}
     */
    static flatTree(tree) {
        /** @type {?} */
        const flat = (/**
         * @param {?} nodes
         * @param {?} node
         * @return {?}
         */
        (nodes, node) => {
            nodes.push(node);
            return node.children.length > 0
                ? node.children.reduce(flat, nodes)
                : nodes;
        });
        return tree.reduce(flat, []);
    }
    //--------------------------------------------------------------------------------------------------------------------
    // OBJECT METHODS
    //--------------------------------------------------------------------------------------------------------------------
    /**
     * @param {?} items
     * @return {?}
     */
    setItems(items) {
        this._zone.run((/**
         * @return {?}
         */
        () => {
            /** @type {?} */
            const response = AOTreeHelper.listToTree(items, this.map);
            this.map = response.map;
            this.tree = response.tree;
        }));
    }
    /**
     * @return {?}
     */
    getRoot() {
        return this.tree;
    }
    ;
    /**
     * @param {?=} node
     * @return {?}
     */
    getChildren(node) {
        return node ? node.children : this.getRoot();
    }
    ;
    /**
     * @param {?=} node
     * @return {?}
     */
    getDescendants(node) {
        return AOTreeHelper.flatTree(node ? node.children : this.getRoot());
    }
    ;
    /**
     * @param {?} node
     * @return {?}
     */
    getParent(node) {
        return this.map.get(node.data.parent_id);
    }
    /**
     * @param {?} node
     * @return {?}
     */
    getParents(node) {
        /** @type {?} */
        const parent = this.getParent(node);
        return parent ? [parent, ...this.getParents(parent)] : [];
    }
    /**
     * @param {?=} node
     * @return {?}
     */
    getBrothers(node) {
        /** @type {?} */
        const parent = this.getParent(node);
        return parent ? parent.children : this.getRoot();
    }
    /**
     * @param {?} node
     * @return {?}
     */
    isVisible(node) {
        /** @type {?} */
        const parent = this.getParent(node);
        return parent ? parent.expanded : true;
    }
    /**
     * @param {?} node
     * @return {?}
     */
    tootle(node) {
        if (node.expanded) {
            [node, ...this.getDescendants(node)].map((/**
             * @param {?} n
             * @return {?}
             */
            n => n.expanded = false));
        }
        else {
            node.expanded = true;
        }
        return node.expanded;
    }
    /**
     * @return {?}
     */
    expandAll() {
        this.getDescendants().map((/**
         * @param {?} n
         * @return {?}
         */
        n => n.expanded = true));
    }
    /**
     * @return {?}
     */
    contractAll() {
        this.getDescendants().map((/**
         * @param {?} n
         * @return {?}
         */
        n => n.expanded = false));
    }
    /**
     * @param {?=} node
     * @return {?}
     */
    getNextOrder(node) {
        /** @type {?} */
        const children = this.getChildren(node);
        return children.length === 0 ? 0 : children.slice(-1)[0].data.order + 1;
    }
    /**
     * @param {?} node
     * @return {?}
     */
    getNavigate(node) {
        /** @type {?} */
        const brothers = this.getBrothers(node);
        /** @type {?} */
        const locate = (/**
         * @param {?} navigate
         * @param {?} item
         * @param {?} index
         * @return {?}
         */
        (navigate, item, index) => {
            if (node.data.id === item.data.id) {
                navigate.previous = index > 0 ? brothers[index - 1] : null;
                navigate.next = index < brothers.length ? brothers[index + 1] : null;
            }
            return navigate;
        });
        return brothers.reduce(locate, { previous: null, current: node, next: null });
    }
    /**
     * @param {?} node
     * @return {?}
     */
    getPrevious(node) {
        return this.getNavigate(node).previous;
    }
    /**
     * @param {?} node
     * @return {?}
     */
    getNext(node) {
        return this.getNavigate(node).next;
    }
}
if (false) {
    /**
     * @type {?}
     * @private
     */
    AOTreeHelper.prototype.map;
    /**
     * @type {?}
     * @private
     */
    AOTreeHelper.prototype.tree;
    /**
     * @type {?}
     * @private
     */
    AOTreeHelper.prototype._zone;
    /* Skipping unhandled member: ;*/
    /* Skipping unhandled member: ;*/
    /* Skipping unhandled member: ;*/
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYW8tdHJlZS5oZWxwZXJzLmpzIiwic291cmNlUm9vdCI6Im5nOi8vYW8tYW5ndWxhci8iLCJzb3VyY2VzIjpbImxpYi9oZWxwZXJzL2FvLXRyZWUuaGVscGVycy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUVBLE1BQU0sT0FBTyxVQUFVO0lBQXZCO1FBSUUsVUFBSyxHQUFXLENBQUMsQ0FBQztRQUlsQixhQUFRLEdBQVksS0FBSyxDQUFDO0lBVTVCLENBQUM7Ozs7SUFSQyxVQUFVO1FBQ1IsT0FBTyxJQUFJLENBQUMsUUFBUSxDQUFDO0lBQ3ZCLENBQUM7Ozs7SUFFRCxZQUFZO1FBQ1YsT0FBTyxJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUM7SUFDbEMsQ0FBQztDQUVGOzs7SUFoQkMsMEJBQVU7O0lBRVYsMkJBQWtCOztJQUVsQiw4QkFBdUI7O0lBRXZCLDhCQUEwQjs7QUFZNUIsTUFBTSxPQUFPLFlBQVk7Ozs7SUFNdkIsWUFDVSxLQUFhO1FBQWIsVUFBSyxHQUFMLEtBQUssQ0FBUTtRQUxmLFFBQUcsR0FBeUIsSUFBSSxHQUFHLEVBQW1CLENBQUM7UUFFdkQsU0FBSSxHQUFpQixFQUFFLENBQUM7SUFLaEMsQ0FBQzs7Ozs7Ozs7Ozs7SUFNRCxNQUFNLENBQUMsVUFBVSxDQUFDLEtBQUssRUFBRSxHQUEwQixFQUFFLE9BQU8sR0FBRyxXQUFXLEVBQUUsT0FBTyxHQUFHLElBQUk7UUFDeEYsRUFBRTtRQUNGLHlEQUF5RDtRQUN6RCxFQUFFO1FBQ0YsSUFBSSxHQUFHLElBQUksU0FBUyxFQUFFO1lBQ3BCLEdBQUcsR0FBRyxJQUFJLEdBQUcsRUFBbUIsQ0FBQztTQUNsQzs7Ozs7Y0FLSyxNQUFNOzs7O1FBQUcsQ0FBQyxJQUFJLEVBQUUsRUFBRTs7Z0JBQ2xCLElBQUksR0FBRyxHQUFHLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztZQUVqQyxJQUFJLElBQUksSUFBSSxTQUFTLEVBQUU7Z0JB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QUFRLENBQUMsTUFBTSxDQUFDLE1BQU0sRUFBRSxFQUFDLFFBQVEsRUFBRSxJQUFJLEVBQUUsT0FBTyxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFDLENBQUMsQ0FBQztJQUM5RSxDQUFDOzs7OztJQUVELFdBQVcsQ0FBQyxJQUFnQjtRQUMxQixPQUFPLElBQUksQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLENBQUMsUUFBUSxDQUFDO0lBQ3pDLENBQUM7Ozs7O0lBRUQsT0FBTyxDQUFDLElBQWdCO1FBQ3RCLE9BQU8sSUFBSSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxJQUFJLENBQUM7SUFDckMsQ0FBQztDQWlFRjs7Ozs7O0lBbk9DLDJCQUErRDs7Ozs7SUFFL0QsNEJBQWdDOzs7OztJQUc5Qiw2QkFBcUIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBOZ1pvbmUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuXHJcbmV4cG9ydCBjbGFzcyBBT05vZGVJdGVtIHtcclxuXHJcbiAgZGF0YTogYW55O1xyXG5cclxuICBsZXZlbDogbnVtYmVyID0gMDtcclxuXHJcbiAgY2hpbGRyZW46IEFPTm9kZUl0ZW1bXTtcclxuXHJcbiAgZXhwYW5kZWQ6IGJvb2xlYW4gPSBmYWxzZTtcclxuXHJcbiAgaXNFeHBhbmRlZCgpIHtcclxuICAgIHJldHVybiB0aGlzLmV4cGFuZGVkO1xyXG4gIH1cclxuXHJcbiAgaXNFeHBhbmRhYmxlKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuY2hpbGRyZW4ubGVuZ3RoID4gMDtcclxuICB9XHJcblxyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgQU9UcmVlSGVscGVyIHtcclxuXHJcbiAgcHJpdmF0ZSBtYXA6IE1hcDxhbnksIEFPTm9kZUl0ZW0+ID0gbmV3IE1hcDxhbnksIEFPTm9kZUl0ZW0+KCk7XHJcblxyXG4gIHByaXZhdGUgdHJlZTogQU9Ob2RlSXRlbVtdID0gW107XHJcblxyXG4gIGNvbnN0cnVjdG9yKFxyXG4gICAgcHJpdmF0ZSBfem9uZTogTmdab25lXHJcbiAgKSB7XHJcbiAgfVxyXG5cclxuICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcbiAgLy8gU1RBVElDIE1FVEhPRFNcclxuICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcblxyXG4gIHN0YXRpYyBsaXN0VG9UcmVlKGl0ZW1zLCBtYXA/OiBNYXA8YW55LCBBT05vZGVJdGVtPiwgZmtfbmFtZSA9ICdwYXJlbnRfaWQnLCBwa19uYW1lID0gJ2lkJykge1xyXG4gICAgLy9cclxuICAgIC8vIGluaWNpYWxpemEgbyBtYXAsIHNlIGFpbmRhIG5hbyB0aXZlciBzaWRvIGluaWNpYWxpemFkb1xyXG4gICAgLy9cclxuICAgIGlmIChtYXAgPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgIG1hcCA9IG5ldyBNYXA8YW55LCBBT05vZGVJdGVtPigpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vXHJcbiAgICAvLyBmdW5jYW8gcGFyYSBjcmlhciB0b2RvcyBvcyBub2RlcyBuZWNlc3Nhcmlvc1xyXG4gICAgLy9cclxuICAgIGNvbnN0IGNyZWF0ZSA9IChkYXRhKSA9PiB7XHJcbiAgICAgIGxldCBub2RlID0gbWFwLmdldChkYXRhW3BrX25hbWVdKTtcclxuXHJcbiAgICAgIGlmIChub2RlID09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgIG5vZGUgPSBuZXcgQU9Ob2RlSXRlbSgpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBub2RlLmRhdGEgPSBkYXRhO1xyXG4gICAgICBub2RlLmNoaWxkcmVuID0gW107XHJcblxyXG4gICAgICBtYXAuc2V0KGRhdGFbcGtfbmFtZV0sIG5vZGUpO1xyXG5cclxuICAgICAgcmV0dXJuIG5vZGU7XHJcbiAgICB9O1xyXG5cclxuICAgIC8vXHJcbiAgICAvLyBhbmluaGEgdG9kb3Mgb3Mgbm9kZXMgZG8gbWFwXHJcbiAgICAvL1xyXG4gICAgY29uc3QgbmVzdCA9IChyb290OiBhbnlbXSwgbm9kZTogYW55KSA9PiB7XHJcbiAgICAgIGNvbnN0IHBhcmVudCA9IG5vZGUuZGF0YVtma19uYW1lXSA/IG1hcC5nZXQobm9kZS5kYXRhW2ZrX25hbWVdKSA6IHVuZGVmaW5lZDtcclxuXHJcbiAgICAgIGlmIChwYXJlbnQpIHtcclxuICAgICAgICBub2RlLmxldmVsID0gcGFyZW50LmxldmVsICsgMTtcclxuICAgICAgICBwYXJlbnQuY2hpbGRyZW4ucHVzaChub2RlKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICByb290LnB1c2gobm9kZSk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHJldHVybiByb290O1xyXG4gICAgfTtcclxuXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBtYXAsIHRyZWU6IGl0ZW1zLm1hcChjcmVhdGUpLnJlZHVjZShuZXN0LCBbXSlcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICBzdGF0aWMgZmxhdFRyZWUodHJlZTogQU9Ob2RlSXRlbVtdKSB7XHJcbiAgICBjb25zdCBmbGF0ID0gKG5vZGVzOiBhbnlbXSwgbm9kZTogYW55KSA9PiB7XHJcblxyXG4gICAgICBub2Rlcy5wdXNoKG5vZGUpO1xyXG5cclxuICAgICAgcmV0dXJuIG5vZGUuY2hpbGRyZW4ubGVuZ3RoID4gMFxyXG4gICAgICAgID8gbm9kZS5jaGlsZHJlbi5yZWR1Y2UoZmxhdCwgbm9kZXMpXHJcbiAgICAgICAgOiBub2RlcztcclxuXHJcbiAgICB9O1xyXG5cclxuICAgIHJldHVybiB0cmVlLnJlZHVjZShmbGF0LCBbXSk7XHJcbiAgfVxyXG5cclxuICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcbiAgLy8gT0JKRUNUIE1FVEhPRFNcclxuICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcblxyXG4gIHNldEl0ZW1zKGl0ZW1zKSB7XHJcbiAgICB0aGlzLl96b25lLnJ1bigoKSA9PiB7XHJcblxyXG4gICAgICBjb25zdCByZXNwb25zZSA9IEFPVHJlZUhlbHBlci5saXN0VG9UcmVlKGl0ZW1zLCB0aGlzLm1hcCk7XHJcblxyXG4gICAgICB0aGlzLm1hcCA9IHJlc3BvbnNlLm1hcDtcclxuICAgICAgdGhpcy50cmVlID0gcmVzcG9uc2UudHJlZTtcclxuXHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGdldFJvb3QoKTogQU9Ob2RlSXRlbVtdIHtcclxuICAgIHJldHVybiB0aGlzLnRyZWU7XHJcbiAgfTtcclxuXHJcbiAgZ2V0Q2hpbGRyZW4obm9kZT86IEFPTm9kZUl0ZW0pOiBBT05vZGVJdGVtW10ge1xyXG4gICAgcmV0dXJuIG5vZGUgPyBub2RlLmNoaWxkcmVuIDogdGhpcy5nZXRSb290KCk7XHJcbiAgfTtcclxuXHJcbiAgZ2V0RGVzY2VuZGFudHMobm9kZT86IEFPTm9kZUl0ZW0pOiBBT05vZGVJdGVtW10ge1xyXG4gICAgcmV0dXJuIEFPVHJlZUhlbHBlci5mbGF0VHJlZShub2RlID8gbm9kZS5jaGlsZHJlbiA6IHRoaXMuZ2V0Um9vdCgpKTtcclxuICB9O1xyXG5cclxuICBnZXRQYXJlbnQobm9kZTogQU9Ob2RlSXRlbSk6IEFPTm9kZUl0ZW0gfCB1bmRlZmluZWQge1xyXG4gICAgcmV0dXJuIHRoaXMubWFwLmdldChub2RlLmRhdGEucGFyZW50X2lkKTtcclxuICB9XHJcblxyXG4gIGdldFBhcmVudHMobm9kZTogQU9Ob2RlSXRlbSk6IEFPTm9kZUl0ZW1bXSB7XHJcbiAgICBjb25zdCBwYXJlbnQgPSB0aGlzLmdldFBhcmVudChub2RlKTtcclxuICAgIHJldHVybiBwYXJlbnQgPyBbcGFyZW50LCAuLi50aGlzLmdldFBhcmVudHMocGFyZW50KV0gOiBbXTtcclxuICB9XHJcblxyXG4gIGdldEJyb3RoZXJzKG5vZGU/OiBBT05vZGVJdGVtKTogQU9Ob2RlSXRlbVtdIHtcclxuICAgIGNvbnN0IHBhcmVudCA9IHRoaXMuZ2V0UGFyZW50KG5vZGUpO1xyXG4gICAgcmV0dXJuIHBhcmVudCA/IHBhcmVudC5jaGlsZHJlbiA6IHRoaXMuZ2V0Um9vdCgpO1xyXG4gIH1cclxuXHJcbiAgaXNWaXNpYmxlKG5vZGU6IEFPTm9kZUl0ZW0pIHtcclxuICAgIGNvbnN0IHBhcmVudCA9IHRoaXMuZ2V0UGFyZW50KG5vZGUpO1xyXG4gICAgcmV0dXJuIHBhcmVudCA/IHBhcmVudC5leHBhbmRlZCA6IHRydWU7XHJcbiAgfVxyXG5cclxuICB0b290bGUobm9kZTogQU9Ob2RlSXRlbSkge1xyXG4gICAgaWYgKG5vZGUuZXhwYW5kZWQpIHtcclxuICAgICAgW25vZGUsIC4uLnRoaXMuZ2V0RGVzY2VuZGFudHMobm9kZSldLm1hcChuID0+IG4uZXhwYW5kZWQgPSBmYWxzZSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBub2RlLmV4cGFuZGVkID0gdHJ1ZTtcclxuICAgIH1cclxuICAgIHJldHVybiBub2RlLmV4cGFuZGVkO1xyXG4gIH1cclxuXHJcbiAgZXhwYW5kQWxsKCkge1xyXG4gICAgdGhpcy5nZXREZXNjZW5kYW50cygpLm1hcChuID0+IG4uZXhwYW5kZWQgPSB0cnVlKTtcclxuICB9XHJcblxyXG4gIGNvbnRyYWN0QWxsKCkge1xyXG4gICAgdGhpcy5nZXREZXNjZW5kYW50cygpLm1hcChuID0+IG4uZXhwYW5kZWQgPSBmYWxzZSk7XHJcbiAgfVxyXG5cclxuICBnZXROZXh0T3JkZXIobm9kZT86IEFPTm9kZUl0ZW0pIHtcclxuICAgIGNvbnN0IGNoaWxkcmVuID0gdGhpcy5nZXRDaGlsZHJlbihub2RlKTtcclxuICAgIHJldHVybiBjaGlsZHJlbi5sZW5ndGggPT09IDAgPyAwIDogY2hpbGRyZW4uc2xpY2UoLTEpWzBdLmRhdGEub3JkZXIgKyAxO1xyXG4gIH1cclxuXHJcbiAgZ2V0TmF2aWdhdGUobm9kZTogQU9Ob2RlSXRlbSk6IHsgcHJldmlvdXM6IEFPTm9kZUl0ZW0gfCBudWxsLCBjdXJyZW50OiBBT05vZGVJdGVtLCBuZXh0OiBBT05vZGVJdGVtIHwgbnVsbCB9IHtcclxuICAgIGNvbnN0IGJyb3RoZXJzID0gdGhpcy5nZXRCcm90aGVycyhub2RlKTtcclxuXHJcbiAgICBjb25zdCBsb2NhdGUgPSAobmF2aWdhdGUsIGl0ZW0sIGluZGV4KSA9PiB7XHJcbiAgICAgIGlmIChub2RlLmRhdGEuaWQgPT09IGl0ZW0uZGF0YS5pZCkge1xyXG4gICAgICAgIG5hdmlnYXRlLnByZXZpb3VzID0gaW5kZXggPiAwID8gYnJvdGhlcnNbaW5kZXggLSAxXSA6IG51bGw7XHJcbiAgICAgICAgbmF2aWdhdGUubmV4dCA9IGluZGV4IDwgYnJvdGhlcnMubGVuZ3RoID8gYnJvdGhlcnNbaW5kZXggKyAxXSA6IG51bGw7XHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIG5hdmlnYXRlO1xyXG4gICAgfTtcclxuXHJcbiAgICByZXR1cm4gYnJvdGhlcnMucmVkdWNlKGxvY2F0ZSwge3ByZXZpb3VzOiBudWxsLCBjdXJyZW50OiBub2RlLCBuZXh0OiBudWxsfSk7XHJcbiAgfVxyXG5cclxuICBnZXRQcmV2aW91cyhub2RlOiBBT05vZGVJdGVtKSB7XHJcbiAgICByZXR1cm4gdGhpcy5nZXROYXZpZ2F0ZShub2RlKS5wcmV2aW91cztcclxuICB9XHJcblxyXG4gIGdldE5leHQobm9kZTogQU9Ob2RlSXRlbSkge1xyXG4gICAgcmV0dXJuIHRoaXMuZ2V0TmF2aWdhdGUobm9kZSkubmV4dDtcclxuICB9XHJcblxyXG4gIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cclxuICAvL1xyXG4gIC8vICAgaW1wb3J0IHsgU2VsZWN0aW9uTW9kZWwgfSBmcm9tICdAYW5ndWxhci9jZGsvY29sbGVjdGlvbnMnO1xyXG4gIC8vXHJcbiAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG4gIC8vXHJcbiAgLy8gICBzZWxlY3Rpb24gPSBuZXcgU2VsZWN0aW9uTW9kZWw8QU9Ob2RlSXRlbT4odHJ1ZSAvKiBtdWx0aXBsZSAqLywgW10pO1xyXG4gIC8vICAgb25TZWxlY3RlZCA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xyXG4gIC8vXHJcbiAgLy8gICBpc1NlbGVjdGVkKG5vZGU6IEFPTm9kZUl0ZW0pOiBib29sZWFuIHtcclxuICAvLyAgICAgcmV0dXJuIHRoaXMuaXNFeHBhbmRhYmxlKG5vZGUpXHJcbiAgLy8gICAgICAgPyB0aGlzLnRyZWVDb250cm9sLmdldERlc2NlbmRhbnRzKG5vZGUpLmV2ZXJ5KGNoaWxkID0+IHRoaXMuc2VsZWN0aW9uLmlzU2VsZWN0ZWQoY2hpbGQpKVxyXG4gIC8vICAgICAgIDogdGhpcy5zZWxlY3Rpb24uaXNTZWxlY3RlZChub2RlKTtcclxuICAvLyAgIH1cclxuICAvL1xyXG4gIC8vICAgaXNQYXJ0aWFsbHlTZWxlY3RlZChub2RlOiBBT05vZGVJdGVtKTogYm9vbGVhbiB7XHJcbiAgLy8gICAgIHJldHVybiB0aGlzLmlzRXhwYW5kYWJsZShub2RlKVxyXG4gIC8vICAgICAgID8gdGhpcy50cmVlQ29udHJvbC5nZXREZXNjZW5kYW50cyhub2RlKS5zb21lKGNoaWxkID0+IHRoaXMuc2VsZWN0aW9uLmlzU2VsZWN0ZWQoY2hpbGQpKSAmJiAhdGhpcy5pc1NlbGVjdGVkKG5vZGUpXHJcbiAgLy8gICAgICAgOiBmYWxzZTtcclxuICAvLyAgIH1cclxuICAvL1xyXG4gIC8vICAgbm9kZUNoYW5nZShub2RlOiBBT05vZGVJdGVtKSB7XHJcbiAgLy8gICAgIHRoaXMuc2VsZWN0aW9uLnRvZ2dsZShub2RlKTtcclxuICAvL1xyXG4gIC8vICAgICBpZiAodGhpcy5pc0V4cGFuZGFibGUobm9kZSkpIHtcclxuICAvLyAgICAgICBjb25zdCBkZXNjZW5kYW50cyA9IHRoaXMudHJlZUNvbnRyb2wuZ2V0RGVzY2VuZGFudHMobm9kZSk7XHJcbiAgLy8gICAgICAgdGhpcy5zZWxlY3Rpb24uaXNTZWxlY3RlZChub2RlKSA/IHRoaXMuc2VsZWN0aW9uLnNlbGVjdCguLi5kZXNjZW5kYW50cykgOiB0aGlzLnNlbGVjdGlvbi5kZXNlbGVjdCguLi5kZXNjZW5kYW50cyk7XHJcbiAgLy8gICAgICAgZGVzY2VuZGFudHMuZXZlcnkoY2hpbGQgPT4gdGhpcy5zZWxlY3Rpb24uaXNTZWxlY3RlZChjaGlsZCkpOyAvLyBGb3JjZSB1cGRhdGUgZm9yIHRoZSBwYXJlbnRcclxuICAvLyAgICAgfVxyXG4gIC8vXHJcbiAgLy8gICAgIHRoaXMuY2hlY2tBbGxQYXJlbnRzU2VsZWN0aW9uKG5vZGUpO1xyXG4gIC8vXHJcbiAgLy8gICAgIHRoaXMuc2VsZWN0ZWQuZW1pdChcclxuICAvLyAgICAgICB0aGlzLnNlbGVjdGlvbi5zZWxlY3RlZC5yZWR1Y2UoKGl0ZW1zLCBub2RlOiBBT05vZGVJdGVtKSA9PiBpdGVtcy5jb25jYXQoey4uLm5vZGUuZGF0YX0pLCBbXSlcclxuICAvLyAgICAgKTtcclxuICAvLyAgIH1cclxuICAvL1xyXG4gIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cclxuICAvL1xyXG4gIC8vICAgLyoqIENoZWNrcyBhbGwgdGhlIHBhcmVudHMgd2hlbiBhIGxlYWYgbm9kZSBpcyBzZWxlY3RlZC91bnNlbGVjdGVkICovXHJcbiAgLy8gICBjaGVja0FsbFBhcmVudHNTZWxlY3Rpb24obm9kZTogQU9Ob2RlSXRlbSk6IHZvaWQge1xyXG4gIC8vICAgICBsZXQgcGFyZW50OiBBT05vZGVJdGVtIHwgdW5kZWZpbmVkID0gdGhpcy5nZXRQYXJlbnQobm9kZSk7XHJcbiAgLy9cclxuICAvLyAgICAgd2hpbGUgKHBhcmVudCkge1xyXG4gIC8vICAgICAgIHRoaXMuY2hlY2tSb290Tm9kZVNlbGVjdGlvbihwYXJlbnQpO1xyXG4gIC8vICAgICAgIHBhcmVudCA9IHRoaXMuZ2V0UGFyZW50KHBhcmVudCk7XHJcbiAgLy8gICAgIH1cclxuICAvLyAgIH1cclxuICAvL1xyXG4gIC8vICAgLyoqIENoZWNrIHJvb3Qgbm9kZSBjaGVja2VkIHN0YXRlIGFuZCBjaGFuZ2UgaXQgYWNjb3JkaW5nbHkgKi9cclxuICAvLyAgIGNoZWNrUm9vdE5vZGVTZWxlY3Rpb24obm9kZTogQU9Ob2RlSXRlbSk6IHZvaWQge1xyXG4gIC8vICAgICBjb25zdCBub2RlU2VsZWN0ZWQgPSB0aGlzLnNlbGVjdGlvbi5pc1NlbGVjdGVkKG5vZGUpO1xyXG4gIC8vICAgICBjb25zdCBkZXNjQWxsU2VsZWN0ZWQgPSB0aGlzLnRyZWVDb250cm9sLmdldERlc2NlbmRhbnRzKG5vZGUpLmV2ZXJ5KGNoaWxkID0+IHRoaXMuc2VsZWN0aW9uLmlzU2VsZWN0ZWQoY2hpbGQpKTtcclxuICAvL1xyXG4gIC8vICAgICBpZiAobm9kZVNlbGVjdGVkICYmICFkZXNjQWxsU2VsZWN0ZWQpIHtcclxuICAvLyAgICAgICB0aGlzLnNlbGVjdGlvbi5kZXNlbGVjdChub2RlKTtcclxuICAvLyAgICAgfSBlbHNlIGlmICghbm9kZVNlbGVjdGVkICYmIGRlc2NBbGxTZWxlY3RlZCkge1xyXG4gIC8vICAgICAgIHRoaXMuc2VsZWN0aW9uLnNlbGVjdChub2RlKTtcclxuICAvLyAgICAgfVxyXG4gIC8vICAgfVxyXG4gIC8vXHJcbiAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG5cclxufVxyXG5cclxuIl19