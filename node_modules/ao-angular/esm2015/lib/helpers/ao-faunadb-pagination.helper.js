/**
 * @fileoverview added by tsickle
 * Generated from: lib/helpers/ao-faunadb-pagination.helper.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as FaunaDB from 'faunadb';
export class AOFaunaDBPaginationHelper {
    /**
     * @param {?} _ao
     * @param {?} _db
     */
    constructor(_ao, _db) {
        this._ao = _ao;
        this._db = _db;
        this._filters_show = true;
        this._filters_model = {};
        this._filters = {};
        this._size = 20;
    }
    //--------------------------------------------------------------------------------------------------------------------
    /**
     * @param {?=} filters
     * @return {?}
     */
    filters(filters) {
        if (filters) {
            this._filters_model = Object.assign({}, filters);
            this._filters = Object.assign({}, filters);
            return this;
        }
        return this._filters;
    }
    /**
     * @return {?}
     */
    openFilters() {
        this._filters_show = true;
    }
    /**
     * @return {?}
     */
    closeFilters() {
        this._filters_show = false;
    }
    /**
     * @return {?}
     */
    toggleFilters() {
        this._filters_show = !this._filters_show;
    }
    /**
     * @return {?}
     */
    showFilters() {
        return this._filters_show;
    }
    /**
     * @return {?}
     */
    hideFilters() {
        return !this._filters_show;
    }
    /**
     * @return {?}
     */
    hasFilters() {
        return Object
            .keys(this._filters_model)
            .filter((/**
         * @param {?} key
         * @return {?}
         */
        key => this._filters_model[key] !== this._filters[key]))
            .length > 0;
    }
    /**
     * @return {?}
     */
    resetFilters() {
        this._filters = Object.assign({}, this._filters_model);
        this.openFilters();
    }
    //--------------------------------------------------------------------------------------------------------------------
    /**
     * @template THIS
     * @this {THIS}
     * @param {?} columns
     * @return {THIS}
     */
    select(columns) {
        return ((/** @type {?} */ (this))._columns = [...columns]) && (/** @type {?} */ (this));
    }
    /**
     * @template THIS
     * @this {THIS}
     * @param {?} query
     * @return {THIS}
     */
    query(query) {
        return ((/** @type {?} */ (this))._query = query) && (/** @type {?} */ (this));
    }
    /**
     * @return {?}
     */
    search() {
        this._last_after = undefined;
        this._refresh = undefined;
        this._search = this._query(FaunaDB.query, Object.assign({}, this.filters()));
        return this.first();
    }
    /**
     * @return {?}
     */
    first() {
        return this.paginate(this._search, {
            size: this._size,
            before: undefined,
            after: undefined,
        });
    }
    /**
     * @return {?}
     */
    previous() {
        return this.paginate(this._search, {
            size: this._size,
            after: undefined,
            before: this._response.before,
        });
    }
    /**
     * @return {?}
     */
    next() {
        return this.paginate(this._search, {
            size: this._size,
            after: this._response.after,
            before: undefined,
        });
    }
    /**
     * @return {?}
     */
    last() {
        return this.paginate(this._search, {
            size: this._size,
            after: this._last_after,
            before: undefined,
        });
    }
    /**
     * @param {?=} event
     * @return {?}
     */
    refresh(event) {
        /** @type {?} */
        let promise;
        if (this.empty()) {
            if (this._response) {
                promise = this.previous();
            }
            else {
                promise = this.search();
            }
        }
        else {
            promise = this.paginate(this._search, this._refresh);
        }
        return promise.then((/**
         * @param {?} response
         * @return {?}
         */
        response => {
            event ? event.target.complete() : null;
            return response;
        }));
    }
    /**
     * @private
     * @param {?} set
     * @param {?=} opts
     * @return {?}
     */
    paginate(set, opts) {
        this._refresh = Object.assign({}, opts);
        /** @type {?} */
        let paginate = FaunaDB.query.Paginate(set, opts);
        if (this._columns) {
            paginate = FaunaDB.query.Map(paginate, (/**
             * @param {?} item
             * @return {?}
             */
            item => this._columns.reduce((/**
             * @param {?} select
             * @param {?} column
             * @param {?} index
             * @return {?}
             */
            (select, column, index) => (select[column] = FaunaDB.query.Select(index + 1, item)) && select), {})));
        }
        return this._db.query((/**
         * @return {?}
         */
        () => paginate))
            .then((/**
         * @param {?} response
         * @return {?}
         */
        (response) => {
            if (this._response && this._response.after && !response.after) {
                this._last_after = this._response.after;
            }
            this._response = response;
            this.closeFilters();
        })).catch((/**
         * @param {?} error
         * @return {?}
         */
        error => {
            this._ao.danger('Oops! Falha ao realizar a buscar :(', { error });
        }));
    }
    /**
     * @return {?}
     */
    hasPrevious() {
        return !!(this._response && this._response.before);
    }
    /**
     * @return {?}
     */
    hasNext() {
        return !!(this._response && this._response.after);
    }
    /**
     * @return {?}
     */
    hasLast() {
        return !!this._last_after;
    }
    /**
     * @return {?}
     */
    isFirst() {
        return !this.hasPrevious();
    }
    /**
     * @return {?}
     */
    isLast() {
        return !this.hasNext();
    }
    //--------------------------------------------------------------------------------------------------------------------
    /**
     * @return {?}
     */
    response() {
        return this._response ? this._response : null;
    }
    /**
     * @return {?}
     */
    items() {
        return this._response && this._response.data ? this._response.data : [];
    }
    /**
     * @return {?}
     */
    empty() {
        return this.items().length === 0;
    }
}
if (false) {
    /**
     * @type {?}
     * @private
     */
    AOFaunaDBPaginationHelper.prototype._filters_show;
    /**
     * @type {?}
     * @private
     */
    AOFaunaDBPaginationHelper.prototype._filters_model;
    /**
     * @type {?}
     * @private
     */
    AOFaunaDBPaginationHelper.prototype._filters;
    /**
     * @type {?}
     * @private
     */
    AOFaunaDBPaginationHelper.prototype._query;
    /**
     * @type {?}
     * @private
     */
    AOFaunaDBPaginationHelper.prototype._columns;
    /**
     * @type {?}
     * @private
     */
    AOFaunaDBPaginationHelper.prototype._search;
    /**
     * @type {?}
     * @private
     */
    AOFaunaDBPaginationHelper.prototype._size;
    /**
     * @type {?}
     * @private
     */
    AOFaunaDBPaginationHelper.prototype._response;
    /**
     * @type {?}
     * @private
     */
    AOFaunaDBPaginationHelper.prototype._last_after;
    /**
     * @type {?}
     * @private
     */
    AOFaunaDBPaginationHelper.prototype._refresh;
    /**
     * @type {?}
     * @private
     */
    AOFaunaDBPaginationHelper.prototype._ao;
    /**
     * @type {?}
     * @private
     */
    AOFaunaDBPaginationHelper.prototype._db;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYW8tZmF1bmFkYi1wYWdpbmF0aW9uLmhlbHBlci5qcyIsInNvdXJjZVJvb3QiOiJuZzovL2FvLWFuZ3VsYXIvIiwic291cmNlcyI6WyJsaWIvaGVscGVycy9hby1mYXVuYWRiLXBhZ2luYXRpb24uaGVscGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsT0FBTyxLQUFLLE9BQU8sTUFBTSxTQUFTLENBQUM7QUFNbkMsTUFBTSxPQUFPLHlCQUF5Qjs7Ozs7SUFzQnBDLFlBQ1UsR0FBYyxFQUNkLEdBQXFCO1FBRHJCLFFBQUcsR0FBSCxHQUFHLENBQVc7UUFDZCxRQUFHLEdBQUgsR0FBRyxDQUFrQjtRQXRCdkIsa0JBQWEsR0FBRyxJQUFJLENBQUM7UUFFckIsbUJBQWMsR0FBUSxFQUFFLENBQUM7UUFFekIsYUFBUSxHQUFRLEVBQUUsQ0FBQztRQVFuQixVQUFLLEdBQUcsRUFBRSxDQUFDO0lBWW5CLENBQUM7Ozs7OztJQUlELE9BQU8sQ0FBQyxPQUFhO1FBQ25CLElBQUksT0FBTyxFQUFFO1lBQ1gsSUFBSSxDQUFDLGNBQWMscUJBQU8sT0FBTyxDQUFDLENBQUM7WUFDbkMsSUFBSSxDQUFDLFFBQVEscUJBQU8sT0FBTyxDQUFDLENBQUM7WUFDN0IsT0FBTyxJQUFJLENBQUM7U0FDYjtRQUVELE9BQU8sSUFBSSxDQUFDLFFBQVEsQ0FBQztJQUN2QixDQUFDOzs7O0lBRUQsV0FBVztRQUNULElBQUksQ0FBQyxhQUFhLEdBQUcsSUFBSSxDQUFDO0lBQzVCLENBQUM7Ozs7SUFFRCxZQUFZO1FBQ1YsSUFBSSxDQUFDLGFBQWEsR0FBRyxLQUFLLENBQUM7SUFDN0IsQ0FBQzs7OztJQUVELGFBQWE7UUFDWCxJQUFJLENBQUMsYUFBYSxHQUFHLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQztJQUMzQyxDQUFDOzs7O0lBRUQsV0FBVztRQUNULE9BQU8sSUFBSSxDQUFDLGFBQWEsQ0FBQztJQUM1QixDQUFDOzs7O0lBRUQsV0FBVztRQUNULE9BQU8sQ0FB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Q0FBQzs7OztJQUVELEtBQUs7UUFDSCxPQUFPLElBQUksQ0FBQyxLQUFLLEVBQUUsQ0FBQyxNQUFNLEtBQUssQ0FBQyxDQUFDO0lBQ25DLENBQUM7Q0FFRjs7Ozs7O0lBek1DLGtEQUE2Qjs7Ozs7SUFFN0IsbURBQWlDOzs7OztJQUVqQyw2Q0FBMkI7Ozs7O0lBRTNCLDJDQUF3Qzs7Ozs7SUFFeEMsNkNBQTJCOzs7OztJQUUzQiw0Q0FBcUI7Ozs7O0lBRXJCLDBDQUFtQjs7Ozs7SUFFbkIsOENBQXVCOzs7OztJQUV2QixnREFBeUI7Ozs7O0lBRXpCLDZDQUFzQjs7Ozs7SUFHcEIsd0NBQXNCOzs7OztJQUN0Qix3Q0FBNkIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBGYXVuYURCIGZyb20gJ2ZhdW5hZGInO1xyXG5pbXBvcnQgeyBFeHByQXJnIH0gZnJvbSAnZmF1bmFkYi9zcmMvdHlwZXMvcXVlcnknO1xyXG5cclxuaW1wb3J0IHsgQU9TZXJ2aWNlIH0gZnJvbSAnLi4vc2VydmljZXMvYW8uc2VydmljZSc7XHJcbmltcG9ydCB7IEFPRmF1bmFEYlNlcnZpY2UgfSBmcm9tICcuLi9zZXJ2aWNlcy9hby1mYXVuYS1kYi5zZXJ2aWNlJztcclxuXHJcbmV4cG9ydCBjbGFzcyBBT0ZhdW5hREJQYWdpbmF0aW9uSGVscGVyIHtcclxuXHJcbiAgcHJpdmF0ZSBfZmlsdGVyc19zaG93ID0gdHJ1ZTtcclxuXHJcbiAgcHJpdmF0ZSBfZmlsdGVyc19tb2RlbDogYW55ID0ge307XHJcblxyXG4gIHByaXZhdGUgX2ZpbHRlcnM6IGFueSA9IHt9O1xyXG5cclxuICBwcml2YXRlIF9xdWVyeTogKHEsIHBhcmFtczogYW55KSA9PiBhbnk7XHJcblxyXG4gIHByaXZhdGUgX2NvbHVtbnM6IHN0cmluZ1tdO1xyXG5cclxuICBwcml2YXRlIF9zZWFyY2g6IGFueTtcclxuXHJcbiAgcHJpdmF0ZSBfc2l6ZSA9IDIwO1xyXG5cclxuICBwcml2YXRlIF9yZXNwb25zZTogYW55O1xyXG5cclxuICBwcml2YXRlIF9sYXN0X2FmdGVyOiBhbnk7XHJcblxyXG4gIHByaXZhdGUgX3JlZnJlc2g6IGFueTtcclxuXHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICBwcml2YXRlIF9hbzogQU9TZXJ2aWNlLFxyXG4gICAgcHJpdmF0ZSBfZGI6IEFPRmF1bmFEYlNlcnZpY2UsXHJcbiAgKSB7XHJcbiAgfVxyXG5cclxuICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcblxyXG4gIGZpbHRlcnMoZmlsdGVycz86IGFueSkge1xyXG4gICAgaWYgKGZpbHRlcnMpIHtcclxuICAgICAgdGhpcy5fZmlsdGVyc19tb2RlbCA9IHsuLi5maWx0ZXJzfTtcclxuICAgICAgdGhpcy5fZmlsdGVycyA9IHsuLi5maWx0ZXJzfTtcclxuICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHRoaXMuX2ZpbHRlcnM7XHJcbiAgfVxyXG5cclxuICBvcGVuRmlsdGVycygpIHtcclxuICAgIHRoaXMuX2ZpbHRlcnNfc2hvdyA9IHRydWU7XHJcbiAgfVxyXG5cclxuICBjbG9zZUZpbHRlcnMoKSB7XHJcbiAgICB0aGlzLl9maWx0ZXJzX3Nob3cgPSBmYWxzZTtcclxuICB9XHJcblxyXG4gIHRvZ2dsZUZpbHRlcnMoKSB7XHJcbiAgICB0aGlzLl9maWx0ZXJzX3Nob3cgPSAhdGhpcy5fZmlsdGVyc19zaG93O1xyXG4gIH1cclxuXHJcbiAgc2hvd0ZpbHRlcnMoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5fZmlsdGVyc19zaG93O1xyXG4gIH1cclxuXHJcbiAgaGlkZUZpbHRlcnMoKSB7XHJcbiAgICByZXR1cm4gIXRoaXMuX2ZpbHRlcnNfc2hvdztcclxuICB9XHJcblxyXG4gIGhhc0ZpbHRlcnMoKSB7XHJcbiAgICByZXR1cm4gT2JqZWN0XHJcbiAgICAgIC5rZXlzKHRoaXMuX2ZpbHRlcnNfbW9kZWwpXHJcbiAgICAgIC5maWx0ZXIoa2V5ID0+IHRoaXMuX2ZpbHRlcnNfbW9kZWxba2V5XSAhPT0gdGhpcy5fZmlsdGVyc1trZXldKVxyXG4gICAgICAubGVuZ3RoID4gMDtcclxuICB9XHJcblxyXG4gIHJlc2V0RmlsdGVycygpIHtcclxuICAgIHRoaXMuX2ZpbHRlcnMgPSB7Li4udGhpcy5fZmlsdGVyc19tb2RlbH07XHJcbiAgICB0aGlzLm9wZW5GaWx0ZXJzKCk7XHJcbiAgfVxyXG5cclxuICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcblxyXG4gIHNlbGVjdChjb2x1bW5zOiBzdHJpbmdbXSkge1xyXG4gICAgcmV0dXJuICh0aGlzLl9jb2x1bW5zID0gWy4uLmNvbHVtbnNdKSAmJiB0aGlzO1xyXG4gIH1cclxuXHJcbiAgcXVlcnkocXVlcnk6IChxLCBwYXJhbXM6IGFueSkgPT4gYW55KSB7XHJcbiAgICByZXR1cm4gKHRoaXMuX3F1ZXJ5ID0gcXVlcnkpICYmIHRoaXM7XHJcbiAgfVxyXG5cclxuICBzZWFyY2goKSB7XHJcbiAgICB0aGlzLl9sYXN0X2FmdGVyID0gdW5kZWZpbmVkO1xyXG4gICAgdGhpcy5fcmVmcmVzaCA9IHVuZGVmaW5lZDtcclxuICAgIHRoaXMuX3NlYXJjaCA9IHRoaXMuX3F1ZXJ5KEZhdW5hREIucXVlcnksIHsuLi50aGlzLmZpbHRlcnMoKX0pO1xyXG4gICAgcmV0dXJuIHRoaXMuZmlyc3QoKTtcclxuICB9XHJcblxyXG4gIGZpcnN0KCkge1xyXG4gICAgcmV0dXJuIHRoaXMucGFnaW5hdGUodGhpcy5fc2VhcmNoLCB7XHJcbiAgICAgIHNpemU6IHRoaXMuX3NpemUsXHJcbiAgICAgIGJlZm9yZTogdW5kZWZpbmVkLFxyXG4gICAgICBhZnRlcjogdW5kZWZpbmVkLFxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBwcmV2aW91cygpIHtcclxuICAgIHJldHVybiB0aGlzLnBhZ2luYXRlKHRoaXMuX3NlYXJjaCwge1xyXG4gICAgICBzaXplOiB0aGlzLl9zaXplLFxyXG4gICAgICBhZnRlcjogdW5kZWZpbmVkLFxyXG4gICAgICBiZWZvcmU6IHRoaXMuX3Jlc3BvbnNlLmJlZm9yZSxcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgbmV4dCgpIHtcclxuICAgIHJldHVybiB0aGlzLnBhZ2luYXRlKHRoaXMuX3NlYXJjaCwge1xyXG4gICAgICBzaXplOiB0aGlzLl9zaXplLFxyXG4gICAgICBhZnRlcjogdGhpcy5fcmVzcG9uc2UuYWZ0ZXIsXHJcbiAgICAgIGJlZm9yZTogdW5kZWZpbmVkLFxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBsYXN0KCkge1xyXG4gICAgcmV0dXJuIHRoaXMucGFnaW5hdGUodGhpcy5fc2VhcmNoLCB7XHJcbiAgICAgIHNpemU6IHRoaXMuX3NpemUsXHJcbiAgICAgIGFmdGVyOiB0aGlzLl9sYXN0X2FmdGVyLFxyXG4gICAgICBiZWZvcmU6IHVuZGVmaW5lZCxcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgcmVmcmVzaChldmVudD8pIHtcclxuICAgIGxldCBwcm9taXNlO1xyXG5cclxuICAgIGlmICh0aGlzLmVtcHR5KCkpIHtcclxuICAgICAgaWYgKHRoaXMuX3Jlc3BvbnNlKSB7XHJcbiAgICAgICAgcHJvbWlzZSA9IHRoaXMucHJldmlvdXMoKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBwcm9taXNlID0gdGhpcy5zZWFyY2goKTtcclxuICAgICAgfVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcHJvbWlzZSA9IHRoaXMucGFnaW5hdGUodGhpcy5fc2VhcmNoLCB0aGlzLl9yZWZyZXNoKTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gcHJvbWlzZS50aGVuKHJlc3BvbnNlID0+IHtcclxuICAgICAgZXZlbnQgPyBldmVudC50YXJnZXQuY29tcGxldGUoKSA6IG51bGw7XHJcbiAgICAgIHJldHVybiByZXNwb25zZTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBwYWdpbmF0ZShzZXQ6IEV4cHJBcmcsIG9wdHM/OiBvYmplY3QpIHtcclxuXHJcbiAgICB0aGlzLl9yZWZyZXNoID0gey4uLm9wdHN9O1xyXG5cclxuICAgIGxldCBwYWdpbmF0ZSA9IEZhdW5hREIucXVlcnkuUGFnaW5hdGUoc2V0LCBvcHRzKTtcclxuXHJcbiAgICBpZiAodGhpcy5fY29sdW1ucykge1xyXG4gICAgICBwYWdpbmF0ZSA9IEZhdW5hREIucXVlcnkuTWFwKHBhZ2luYXRlLCBpdGVtID0+IHRoaXMuX2NvbHVtbnMucmVkdWNlKFxyXG4gICAgICAgIChzZWxlY3QsIGNvbHVtbiwgaW5kZXgpID0+IChzZWxlY3RbY29sdW1uXSA9IEZhdW5hREIucXVlcnkuU2VsZWN0KGluZGV4ICsgMSwgaXRlbSkpICYmIHNlbGVjdCwge31cclxuICAgICAgKSk7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHRoaXMuX2RiLnF1ZXJ5KCgpID0+IHBhZ2luYXRlKVxyXG4gICAgICAudGhlbigocmVzcG9uc2U6IGFueSkgPT4ge1xyXG5cclxuICAgICAgICBpZiAodGhpcy5fcmVzcG9uc2UgJiYgdGhpcy5fcmVzcG9uc2UuYWZ0ZXIgJiYgIXJlc3BvbnNlLmFmdGVyKSB7XHJcbiAgICAgICAgICB0aGlzLl9sYXN0X2FmdGVyID0gdGhpcy5fcmVzcG9uc2UuYWZ0ZXI7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLl9yZXNwb25zZSA9IHJlc3BvbnNlO1xyXG4gICAgICAgIHRoaXMuY2xvc2VGaWx0ZXJzKCk7XHJcblxyXG4gICAgICB9KS5jYXRjaChlcnJvciA9PiB7XHJcblxyXG4gICAgICAgIHRoaXMuX2FvLmRhbmdlcignT29wcyEgRmFsaGEgYW8gcmVhbGl6YXIgYSBidXNjYXIgOignLCB7ZXJyb3J9KTtcclxuXHJcbiAgICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgaGFzUHJldmlvdXMoKSB7XHJcbiAgICByZXR1cm4gISEodGhpcy5fcmVzcG9uc2UgJiYgdGhpcy5fcmVzcG9uc2UuYmVmb3JlKTtcclxuICB9XHJcblxyXG4gIGhhc05leHQoKSB7XHJcbiAgICByZXR1cm4gISEodGhpcy5fcmVzcG9uc2UgJiYgdGhpcy5fcmVzcG9uc2UuYWZ0ZXIpO1xyXG4gIH1cclxuXHJcbiAgaGFzTGFzdCgpIHtcclxuICAgIHJldHVybiAhIXRoaXMuX2xhc3RfYWZ0ZXI7XHJcbiAgfVxyXG5cclxuICBpc0ZpcnN0KCkge1xyXG4gICAgcmV0dXJuICF0aGlzLmhhc1ByZXZpb3VzKCk7XHJcbiAgfVxyXG5cclxuICBpc0xhc3QoKSB7XHJcbiAgICByZXR1cm4gIXRoaXMuaGFzTmV4dCgpO1xyXG4gIH1cclxuXHJcbiAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG5cclxuICByZXNwb25zZSgpOiBhbnkge1xyXG4gICAgcmV0dXJuIHRoaXMuX3Jlc3BvbnNlID8gdGhpcy5fcmVzcG9uc2UgOiBudWxsO1xyXG4gIH1cclxuXHJcbiAgaXRlbXMoKTogYW55W10ge1xyXG4gICAgcmV0dXJuIHRoaXMuX3Jlc3BvbnNlICYmIHRoaXMuX3Jlc3BvbnNlLmRhdGEgPyB0aGlzLl9yZXNwb25zZS5kYXRhIDogW107XHJcbiAgfVxyXG5cclxuICBlbXB0eSgpOiBib29sZWFuIHtcclxuICAgIHJldHVybiB0aGlzLml0ZW1zKCkubGVuZ3RoID09PSAwO1xyXG4gIH1cclxuXHJcbn1cclxuIl19