/**
 * @fileoverview added by tsickle
 * Generated from: lib/services/ao-auth-firebase.service.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Inject, Injectable } from '@angular/core';
import { Plugins, registerWebPlugin } from '@capacitor/core';
import { OAuth2Client } from '@byteowls/capacitor-oauth2';
import * as firebase from 'firebase/app';
import { AOAuthService } from './ao-auth.service';
import { AOFirebaseService } from './ao-firebase.service';
import { AOSubscriptions } from '../utils/ao-subscriptions';
import { AOEnvService } from './ao-env.service';
import * as i0 from "@angular/core";
import * as i1 from "./ao-auth.service";
import * as i2 from "./ao-firebase.service";
import * as i3 from "./ao-env.service";
var AOAuthFirebaseService = /** @class */ (function () {
    function AOAuthFirebaseService(_auth, _fb, _env) {
        this._auth = _auth;
        this._fb = _fb;
        this._env = _env;
        this._subscriptions = new AOSubscriptions();
        registerWebPlugin(OAuth2Client);
        this._auth.provider(this);
        this._auth.isUser() ? this.authListening() : null;
    }
    // -------------------------------------------------------------------------------------------------------------------
    // -------------------------------------------------------------------------------------------------------------------
    /**
     * @param {?} data
     * @return {?}
     */
    AOAuthFirebaseService.prototype.login = 
    // -------------------------------------------------------------------------------------------------------------------
    /**
     * @param {?} data
     * @return {?}
     */
    function (data) {
        var _this = this;
        this._subscriptions.stop();
        /** @type {?} */
        var promise = new Promise((/**
         * @param {?} resolve
         * @param {?} reject
         * @return {?}
         */
        function (resolve, reject) { return tslib_1.__awaiter(_this, void 0, void 0, function () {
            var oauth, credential, auth, user, e_1;
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        _a.trys.push([0, 12, , 13]);
                        oauth = null;
                        credential = null;
                        if (!(data.provider instanceof firebase.auth.GoogleAuthProvider)) return [3 /*break*/, 2];
                        return [4 /*yield*/, this.loginGoogle()];
                    case 1:
                        oauth = _a.sent();
                        credential = firebase.auth.GoogleAuthProvider.credential(null, oauth.access_token);
                        return [3 /*break*/, 9];
                    case 2:
                        if (!(data.provider instanceof firebase.auth.FacebookAuthProvider)) return [3 /*break*/, 4];
                        return [4 /*yield*/, this.loginFacebook()];
                    case 3:
                        oauth = _a.sent();
                        credential = firebase.auth.FacebookAuthProvider.credential(oauth.access_token);
                        return [3 /*break*/, 9];
                    case 4:
                        if (!(data.provider instanceof firebase.auth.TwitterAuthProvider)) return [3 /*break*/, 6];
                        return [4 /*yield*/, this.loginTwitter()];
                    case 5:
                        oauth = _a.sent();
                        credential = firebase.auth.TwitterAuthProvider.credential(oauth.access_token, '');
                        return [3 /*break*/, 9];
                    case 6:
                        if (!(data.provider instanceof firebase.auth.GithubAuthProvider)) return [3 /*break*/, 8];
                        return [4 /*yield*/, this.loginGithub()];
                    case 7:
                        oauth = _a.sent();
                        credential = firebase.auth.GithubAuthProvider.credential(oauth.access_token);
                        return [3 /*break*/, 9];
                    case 8:
                        reject('Invalid Auth Provider.');
                        _a.label = 9;
                    case 9: return [4 /*yield*/, this._fb.auth().auth.signInWithCredential(credential)];
                    case 10:
                        auth = _a.sent();
                        return [4 /*yield*/, this.userCreateOrUpdate(auth.user, {
                                given_name: oauth.given_name,
                                family_name: oauth.family_name,
                                locale: oauth.locale,
                            })];
                    case 11:
                        user = _a.sent();
                        resolve(user);
                        return [3 /*break*/, 13];
                    case 12:
                        e_1 = _a.sent();
                        reject(e_1);
                        return [3 /*break*/, 13];
                    case 13: return [2 /*return*/];
                }
            });
        }); }));
        promise.finally((/**
         * @return {?}
         */
        function () { return _this.authListening(true); }));
        return promise;
    };
    /**
     * @return {?}
     */
    AOAuthFirebaseService.prototype.logout = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this._subscriptions.stop();
        return this._fb.firebase().destroy().then((/**
         * @return {?}
         */
        function () { return _this._fb.conn().logout(); }));
    };
    /**
     * @param {?} data
     * @return {?}
     */
    AOAuthFirebaseService.prototype.update = /**
     * @param {?} data
     * @return {?}
     */
    function (data) {
        return Promise.resolve();
    };
    /**
     * @param {?} data
     * @return {?}
     */
    AOAuthFirebaseService.prototype.forgetPassword = /**
     * @param {?} data
     * @return {?}
     */
    function (data) {
        return Promise.resolve();
    };
    /**
     * @param {?} data
     * @return {?}
     */
    AOAuthFirebaseService.prototype.resetPassword = /**
     * @param {?} data
     * @return {?}
     */
    function (data) {
        return Promise.resolve();
    };
    /**
     * @param {?} data
     * @return {?}
     */
    AOAuthFirebaseService.prototype.updatePassword = /**
     * @param {?} data
     * @return {?}
     */
    function (data) {
        return Promise.resolve();
    };
    // -------------------------------------------------------------------------------------------------------------------
    // -------------------------------------------------------------------------------------------------------------------
    /**
     * @private
     * @return {?}
     */
    AOAuthFirebaseService.prototype.loginGoogle = 
    // -------------------------------------------------------------------------------------------------------------------
    /**
     * @private
     * @return {?}
     */
    function () {
        return Plugins.OAuth2Client.authenticate({
            scope: 'email profile',
            authorizationBaseUrl: 'https://accounts.google.com/o/oauth2/auth',
            resourceUrl: 'https://www.googleapis.com/userinfo/v2/me',
            accessTokenEndpoint: 'https://www.googleapis.com/oauth2/v4/token',
            web: {
                appId: this._env.oauth.google.web,
                responseType: 'token',
                redirectUrl: this._env.app_url,
                accessTokenEndpoint: '',
                pkceEnable: false,
                windowOptions: 'height=500,left=0,top=0',
            },
            android: {
                appId: this._env.oauth.google.android,
                responseType: 'code',
                // if you configured a android app in google dev console the value must be "code"
                redirectUrl: this._env.app_id + ':/' // package name from google dev console
            },
            ios: {
                appId: this._env.oauth.google.ios,
                responseType: 'code',
                // if you configured a ios app in google dev console the value must be "code"
                redirectUrl: this._env.app_id + ':/' // Bundle ID from google dev console
            }
        });
    };
    /**
     * @private
     * @return {?}
     */
    AOAuthFirebaseService.prototype.loginFacebook = /**
     * @private
     * @return {?}
     */
    function () {
        return this.loginGoogle();
    };
    /**
     * @private
     * @return {?}
     */
    AOAuthFirebaseService.prototype.loginTwitter = /**
     * @private
     * @return {?}
     */
    function () {
        return this.loginGoogle();
    };
    /**
     * @private
     * @return {?}
     */
    AOAuthFirebaseService.prototype.loginGithub = /**
     * @private
     * @return {?}
     */
    function () {
        return this.loginGoogle();
    };
    /**
     * @private
     * @param {?=} skip
     * @return {?}
     */
    AOAuthFirebaseService.prototype.authListening = /**
     * @private
     * @param {?=} skip
     * @return {?}
     */
    function (skip) {
        var _this = this;
        if (skip === void 0) { skip = false; }
        this._subscriptions.stop();
        this._subscriptions.auth = this._fb.authState().subscribe((/**
         * @param {?} auth
         * @return {?}
         */
        function (auth) { return tslib_1.__awaiter(_this, void 0, void 0, function () {
            var _this = this;
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        if (!auth) return [3 /*break*/, 3];
                        if (!(skip === false)) return [3 /*break*/, 2];
                        skip = false;
                        return [4 /*yield*/, this.userCreateOrUpdate(auth)];
                    case 1:
                        _a.sent();
                        _a.label = 2;
                    case 2:
                        this._subscriptions.user = this._fb.fsDocSnapshot('/users/' + auth.uid).subscribe((/**
                         * @param {?} snapshot
                         * @return {?}
                         */
                        function (snapshot) {
                            return snapshot.payload.exists
                                ? _this._auth.setUser(snapshot.payload.data())
                                : _this._auth.logout();
                        }), (/**
                         * @return {?}
                         */
                        function () {
                            console.warn('Oops! Failed to watch user.');
                        }));
                        return [3 /*break*/, 4];
                    case 3: return [2 /*return*/, this._auth.logout()];
                    case 4: return [2 /*return*/];
                }
            });
        }); }), (/**
         * @return {?}
         */
        function () {
            console.warn('Oops! Failed to update authentication.');
        }));
    };
    /**
     * @private
     * @param {?} user
     * @param {?=} extra
     * @return {?}
     */
    AOAuthFirebaseService.prototype.userCreateOrUpdate = /**
     * @private
     * @param {?} user
     * @param {?=} extra
     * @return {?}
     */
    function (user, extra) {
        if (extra === void 0) { extra = {}; }
        return tslib_1.__awaiter(this, void 0, void 0, function () {
            var userRef, userDoc, data;
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        userRef = this._fb.fsDoc('/users/' + user.uid);
                        return [4 /*yield*/, userRef.ref.get()];
                    case 1:
                        userDoc = _a.sent();
                        data = tslib_1.__assign({}, userDoc.data(), { id: user.uid, email: user.email, email_verified: user.emailVerified, name: user.displayName, image: user.photoURL, logged_at: this._fb.fsNow() }, extra);
                        if (!userDoc.exists) {
                            data.active = true;
                            data.created_at = this._fb.fsNow();
                            data.updated_at = this._fb.fsNow();
                            data.deleted_at = null;
                        }
                        return [4 /*yield*/, userRef.set(data, { merge: true })];
                    case 2:
                        _a.sent();
                        return [4 /*yield*/, userRef.ref.get()];
                    case 3: return [2 /*return*/, (_a.sent()).data()];
                }
            });
        });
    };
    AOAuthFirebaseService.decorators = [
        { type: Injectable, args: [{
                    providedIn: 'root'
                },] }
    ];
    /** @nocollapse */
    AOAuthFirebaseService.ctorParameters = function () { return [
        { type: AOAuthService },
        { type: AOFirebaseService },
        { type: undefined, decorators: [{ type: Inject, args: [AOEnvService,] }] }
    ]; };
    /** @nocollapse */ AOAuthFirebaseService.ngInjectableDef = i0.ɵɵdefineInjectable({ factory: function AOAuthFirebaseService_Factory() { return new AOAuthFirebaseService(i0.ɵɵinject(i1.AOAuthService), i0.ɵɵinject(i2.AOFirebaseService), i0.ɵɵinject(i3.AOEnvService)); }, token: AOAuthFirebaseService, providedIn: "root" });
    return AOAuthFirebaseService;
}());
export { AOAuthFirebaseService };
if (false) {
    /**
     * @type {?}
     * @private
     */
    AOAuthFirebaseService.prototype._subscriptions;
    /**
     * @type {?}
     * @private
     */
    AOAuthFirebaseService.prototype._auth;
    /**
     * @type {?}
     * @private
     */
    AOAuthFirebaseService.prototype._fb;
    /**
     * @type {?}
     * @private
     */
    AOAuthFirebaseService.prototype._env;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYW8tYXV0aC1maXJlYmFzZS5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vYW8tYW5ndWxhci8iLCJzb3VyY2VzIjpbImxpYi9zZXJ2aWNlcy9hby1hdXRoLWZpcmViYXNlLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsT0FBTyxFQUFFLE1BQU0sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDbkQsT0FBTyxFQUFFLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQzdELE9BQU8sRUFBNkIsWUFBWSxFQUFFLE1BQU0sNEJBQTRCLENBQUM7QUFFckYsT0FBTyxLQUFLLFFBQVEsTUFBTSxjQUFjLENBQUM7QUFFekMsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBRWxELE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLHVCQUF1QixDQUFDO0FBQzFELE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQztBQUM1RCxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sa0JBQWtCLENBQUM7Ozs7O0FBRWhEO0lBT0UsK0JBQ1UsS0FBb0IsRUFDcEIsR0FBc0IsRUFDQSxJQUFJO1FBRjFCLFVBQUssR0FBTCxLQUFLLENBQWU7UUFDcEIsUUFBRyxHQUFILEdBQUcsQ0FBbUI7UUFDQSxTQUFJLEdBQUosSUFBSSxDQUFBO1FBTDVCLG1CQUFjLEdBQTBCLElBQUksZUFBZSxFQUFFLENBQUM7UUFPcEUsaUJBQWlCLENBQUMsWUFBWSxDQUFDLENBQUM7UUFFaEMsSUFBSSxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDMUIsSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLEVBQUUsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUM7SUFDcEQsQ0FBQztJQUVELHNIQUFzSDs7Ozs7O0lB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QUUsSUFBSSxDQUFDLEdBQUcsQ0FBQyxLQUFLLEVBQUUsSUFDeEIsS0FBSyxDQUNUO3dCQUVELElBQUksQ0FBQyxPQUFPLENBQUMsTUFBTSxFQUFFOzRCQUNuQixJQUFJLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQzs0QkFDbkIsSUFBSSxDQUFDLFVBQVUsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLEtBQUssRUFBRSxDQUFDOzRCQUNuQyxJQUFJLENBQUMsVUFBVSxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsS0FBSyxFQUFFLENBQUM7NEJBQ25DLElBQUksQ0FBQyxVQUFVLEdBQUcsSUFBSSxDQUFDO3lCQUN4Qjt3QkFFRCxxQkFBTSxPQUFPLENBQUMsR0FBRyxDQUFDLElBQUksRUFBRSxFQUFDLEtBQUssRUFBRSxJQUFJLEVBQUMsQ0FBQyxFQUFBOzt3QkFBdEMsU0FBc0MsQ0FBQzt3QkFFL0IscUJBQU0sT0FBTyxDQUFDLEdBQUcsQ0FBQyxHQUFHLEVBQUUsRUFBQTs0QkFBL0Isc0JBQU8sQ0FBQyxTQUF1QixDQUFDLENBQUMsSUFBSSxFQUFFLEVBQUM7Ozs7S0FDekM7O2dCQXZMRixVQUFVLFNBQUM7b0JBQ1YsVUFBVSxFQUFFLE1BQU07aUJBQ25COzs7O2dCQVJRLGFBQWE7Z0JBRWIsaUJBQWlCO2dEQWNyQixNQUFNLFNBQUMsWUFBWTs7O2dDQXRCeEI7Q0E4TkMsQUFsTkQsSUFrTkM7U0EvTVkscUJBQXFCOzs7Ozs7SUFFaEMsK0NBQXNFOzs7OztJQUdwRSxzQ0FBNEI7Ozs7O0lBQzVCLG9DQUE4Qjs7Ozs7SUFDOUIscUNBQWtDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0LCBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IFBsdWdpbnMsIHJlZ2lzdGVyV2ViUGx1Z2luIH0gZnJvbSAnQGNhcGFjaXRvci9jb3JlJztcclxuaW1wb3J0IHsgT0F1dGgyQXV0aGVudGljYXRlT3B0aW9ucywgT0F1dGgyQ2xpZW50IH0gZnJvbSAnQGJ5dGVvd2xzL2NhcGFjaXRvci1vYXV0aDInO1xyXG5pbXBvcnQgeyBVc2VyIH0gZnJvbSAnZmlyZWJhc2UnO1xyXG5pbXBvcnQgKiBhcyBmaXJlYmFzZSBmcm9tICdmaXJlYmFzZS9hcHAnO1xyXG5cclxuaW1wb3J0IHsgQU9BdXRoU2VydmljZSB9IGZyb20gJy4vYW8tYXV0aC5zZXJ2aWNlJztcclxuaW1wb3J0IHsgQU9BdXRoUHJvdmlkZXJJbnRlcmZhY2UgfSBmcm9tICcuL2FvLWF1dGgtcHJvdmlkZXIuaW50ZXJmYWNlJztcclxuaW1wb3J0IHsgQU9GaXJlYmFzZVNlcnZpY2UgfSBmcm9tICcuL2FvLWZpcmViYXNlLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBBT1N1YnNjcmlwdGlvbnMgfSBmcm9tICcuLi91dGlscy9hby1zdWJzY3JpcHRpb25zJztcclxuaW1wb3J0IHsgQU9FbnZTZXJ2aWNlIH0gZnJvbSAnLi9hby1lbnYuc2VydmljZSc7XHJcblxyXG5ASW5qZWN0YWJsZSh7XHJcbiAgcHJvdmlkZWRJbjogJ3Jvb3QnXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBBT0F1dGhGaXJlYmFzZVNlcnZpY2UgaW1wbGVtZW50cyBBT0F1dGhQcm92aWRlckludGVyZmFjZSB7XHJcblxyXG4gIHByaXZhdGUgX3N1YnNjcmlwdGlvbnM6IEFPU3Vic2NyaXB0aW9ucyB8IGFueSA9IG5ldyBBT1N1YnNjcmlwdGlvbnMoKTtcclxuXHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICBwcml2YXRlIF9hdXRoOiBBT0F1dGhTZXJ2aWNlLFxyXG4gICAgcHJpdmF0ZSBfZmI6IEFPRmlyZWJhc2VTZXJ2aWNlLFxyXG4gICAgQEluamVjdChBT0VudlNlcnZpY2UpIHByaXZhdGUgX2VudlxyXG4gICkge1xyXG4gICAgcmVnaXN0ZXJXZWJQbHVnaW4oT0F1dGgyQ2xpZW50KTtcclxuXHJcbiAgICB0aGlzLl9hdXRoLnByb3ZpZGVyKHRoaXMpO1xyXG4gICAgdGhpcy5fYXV0aC5pc1VzZXIoKSA/IHRoaXMuYXV0aExpc3RlbmluZygpIDogbnVsbDtcclxuICB9XHJcblxyXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cclxuXHJcbiAgbG9naW4oZGF0YTogYW55KTogUHJvbWlzZTxhbnk+IHtcclxuICAgIHRoaXMuX3N1YnNjcmlwdGlvbnMuc3RvcCgpO1xyXG5cclxuICAgIGNvbnN0IHByb21pc2UgPSBuZXcgUHJvbWlzZShhc3luYyAocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgIHRyeSB7XHJcbiAgICAgICAgbGV0IG9hdXRoID0gbnVsbDtcclxuICAgICAgICBsZXQgY3JlZGVudGlhbCA9IG51bGw7XHJcblxyXG4gICAgICAgIGlmIChkYXRhLnByb3ZpZGVyIGluc3RhbmNlb2YgZmlyZWJhc2UuYXV0aC5Hb29nbGVBdXRoUHJvdmlkZXIpIHtcclxuICAgICAgICAgIG9hdXRoID0gYXdhaXQgdGhpcy5sb2dpbkdvb2dsZSgpO1xyXG4gICAgICAgICAgY3JlZGVudGlhbCA9IGZpcmViYXNlLmF1dGguR29vZ2xlQXV0aFByb3ZpZGVyLmNyZWRlbnRpYWwobnVsbCwgb2F1dGguYWNjZXNzX3Rva2VuKTtcclxuXHJcbiAgICAgICAgfSBlbHNlIGlmIChkYXRhLnByb3ZpZGVyIGluc3RhbmNlb2YgZmlyZWJhc2UuYXV0aC5GYWNlYm9va0F1dGhQcm92aWRlcikge1xyXG4gICAgICAgICAgb2F1dGggPSBhd2FpdCB0aGlzLmxvZ2luRmFjZWJvb2soKTtcclxuICAgICAgICAgIGNyZWRlbnRpYWwgPSBmaXJlYmFzZS5hdXRoLkZhY2Vib29rQXV0aFByb3ZpZGVyLmNyZWRlbnRpYWwob2F1dGguYWNjZXNzX3Rva2VuKTtcclxuXHJcbiAgICAgICAgfSBlbHNlIGlmIChkYXRhLnByb3ZpZGVyIGluc3RhbmNlb2YgZmlyZWJhc2UuYXV0aC5Ud2l0dGVyQXV0aFByb3ZpZGVyKSB7XHJcbiAgICAgICAgICBvYXV0aCA9IGF3YWl0IHRoaXMubG9naW5Ud2l0dGVyKCk7XHJcbiAgICAgICAgICBjcmVkZW50aWFsID0gZmlyZWJhc2UuYXV0aC5Ud2l0dGVyQXV0aFByb3ZpZGVyLmNyZWRlbnRpYWwob2F1dGguYWNjZXNzX3Rva2VuLCAnJyk7XHJcblxyXG4gICAgICAgIH0gZWxzZSBpZiAoZGF0YS5wcm92aWRlciBpbnN0YW5jZW9mIGZpcmViYXNlLmF1dGguR2l0aHViQXV0aFByb3ZpZGVyKSB7XHJcbiAgICAgICAgICBvYXV0aCA9IGF3YWl0IHRoaXMubG9naW5HaXRodWIoKTtcclxuICAgICAgICAgIGNyZWRlbnRpYWwgPSBmaXJlYmFzZS5hdXRoLkdpdGh1YkF1dGhQcm92aWRlci5jcmVkZW50aWFsKG9hdXRoLmFjY2Vzc190b2tlbik7XHJcblxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICByZWplY3QoJ0ludmFsaWQgQXV0aCBQcm92aWRlci4nKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IGF1dGggPSBhd2FpdCB0aGlzLl9mYi5hdXRoKCkuYXV0aC5zaWduSW5XaXRoQ3JlZGVudGlhbChjcmVkZW50aWFsKTtcclxuXHJcbiAgICAgICAgY29uc3QgdXNlciA9IGF3YWl0IHRoaXMudXNlckNyZWF0ZU9yVXBkYXRlKGF1dGgudXNlciwge1xyXG4gICAgICAgICAgZ2l2ZW5fbmFtZTogb2F1dGguZ2l2ZW5fbmFtZSxcclxuICAgICAgICAgIGZhbWlseV9uYW1lOiBvYXV0aC5mYW1pbHlfbmFtZSxcclxuICAgICAgICAgIGxvY2FsZTogb2F1dGgubG9jYWxlLFxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICByZXNvbHZlKHVzZXIpO1xyXG4gICAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgICAgcmVqZWN0KGUpO1xyXG4gICAgICB9XHJcblxyXG4gICAgfSk7XHJcblxyXG4gICAgcHJvbWlzZS5maW5hbGx5KCgpID0+IHRoaXMuYXV0aExpc3RlbmluZyh0cnVlKSk7XHJcblxyXG4gICAgcmV0dXJuIHByb21pc2U7XHJcbiAgfVxyXG5cclxuICBsb2dvdXQoKTogUHJvbWlzZTxhbnk+IHtcclxuICAgIHRoaXMuX3N1YnNjcmlwdGlvbnMuc3RvcCgpO1xyXG4gICAgcmV0dXJuIHRoaXMuX2ZiLmZpcmViYXNlKCkuZGVzdHJveSgpLnRoZW4oKCkgPT4gdGhpcy5fZmIuY29ubigpLmxvZ291dCgpKTtcclxuICB9XHJcblxyXG4gIHVwZGF0ZShkYXRhOiBhbnkpOiBQcm9taXNlPGFueT4ge1xyXG4gICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpO1xyXG4gIH1cclxuXHJcbiAgZm9yZ2V0UGFzc3dvcmQoZGF0YTogYW55KTogUHJvbWlzZTxhbnk+IHtcclxuICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcclxuICB9XHJcblxyXG4gIHJlc2V0UGFzc3dvcmQoZGF0YTogYW55KTogUHJvbWlzZTxhbnk+IHtcclxuICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcclxuICB9XHJcblxyXG4gIHVwZGF0ZVBhc3N3b3JkKGRhdGE6IGFueSk6IFByb21pc2U8YW55PiB7XHJcbiAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCk7XHJcbiAgfVxyXG5cclxuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcblxyXG4gIHByaXZhdGUgbG9naW5Hb29nbGUoKTogT0F1dGgyQXV0aGVudGljYXRlT3B0aW9ucyB7XHJcbiAgICByZXR1cm4gUGx1Z2lucy5PQXV0aDJDbGllbnQuYXV0aGVudGljYXRlKHtcclxuICAgICAgc2NvcGU6ICdlbWFpbCBwcm9maWxlJyxcclxuICAgICAgYXV0aG9yaXphdGlvbkJhc2VVcmw6ICdodHRwczovL2FjY291bnRzLmdvb2dsZS5jb20vby9vYXV0aDIvYXV0aCcsXHJcbiAgICAgIHJlc291cmNlVXJsOiAnaHR0cHM6Ly93d3cuZ29vZ2xlYXBpcy5jb20vdXNlcmluZm8vdjIvbWUnLFxyXG4gICAgICBhY2Nlc3NUb2tlbkVuZHBvaW50OiAnaHR0cHM6Ly93d3cuZ29vZ2xlYXBpcy5jb20vb2F1dGgyL3Y0L3Rva2VuJyxcclxuICAgICAgd2ViOiB7XHJcbiAgICAgICAgYXBwSWQ6IHRoaXMuX2Vudi5vYXV0aC5nb29nbGUud2ViLFxyXG4gICAgICAgIHJlc3BvbnNlVHlwZTogJ3Rva2VuJyxcclxuICAgICAgICByZWRpcmVjdFVybDogdGhpcy5fZW52LmFwcF91cmwsXHJcbiAgICAgICAgYWNjZXNzVG9rZW5FbmRwb2ludDogJycsXHJcbiAgICAgICAgcGtjZUVuYWJsZTogZmFsc2UsXHJcbiAgICAgICAgd2luZG93T3B0aW9uczogJ2hlaWdodD01MDAsbGVmdD0wLHRvcD0wJyxcclxuICAgICAgfSxcclxuICAgICAgYW5kcm9pZDoge1xyXG4gICAgICAgIGFwcElkOiB0aGlzLl9lbnYub2F1dGguZ29vZ2xlLmFuZHJvaWQsXHJcbiAgICAgICAgcmVzcG9uc2VUeXBlOiAnY29kZScsIC8vIGlmIHlvdSBjb25maWd1cmVkIGEgYW5kcm9pZCBhcHAgaW4gZ29vZ2xlIGRldiBjb25zb2xlIHRoZSB2YWx1ZSBtdXN0IGJlIFwiY29kZVwiXHJcbiAgICAgICAgcmVkaXJlY3RVcmw6IHRoaXMuX2Vudi5hcHBfaWQgKyAnOi8nIC8vIHBhY2thZ2UgbmFtZSBmcm9tIGdvb2dsZSBkZXYgY29uc29sZVxyXG4gICAgICB9LFxyXG4gICAgICBpb3M6IHtcclxuICAgICAgICBhcHBJZDogdGhpcy5fZW52Lm9hdXRoLmdvb2dsZS5pb3MsXHJcbiAgICAgICAgcmVzcG9uc2VUeXBlOiAnY29kZScsIC8vIGlmIHlvdSBjb25maWd1cmVkIGEgaW9zIGFwcCBpbiBnb29nbGUgZGV2IGNvbnNvbGUgdGhlIHZhbHVlIG11c3QgYmUgXCJjb2RlXCJcclxuICAgICAgICByZWRpcmVjdFVybDogdGhpcy5fZW52LmFwcF9pZCArICc6LycgLy8gQnVuZGxlIElEIGZyb20gZ29vZ2xlIGRldiBjb25zb2xlXHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBsb2dpbkZhY2Vib29rKCk6IE9BdXRoMkF1dGhlbnRpY2F0ZU9wdGlvbnMge1xyXG4gICAgcmV0dXJuIHRoaXMubG9naW5Hb29nbGUoKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgbG9naW5Ud2l0dGVyKCk6IE9BdXRoMkF1dGhlbnRpY2F0ZU9wdGlvbnMge1xyXG4gICAgcmV0dXJuIHRoaXMubG9naW5Hb29nbGUoKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgbG9naW5HaXRodWIoKTogT0F1dGgyQXV0aGVudGljYXRlT3B0aW9ucyB7XHJcbiAgICByZXR1cm4gdGhpcy5sb2dpbkdvb2dsZSgpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBhdXRoTGlzdGVuaW5nKHNraXAgPSBmYWxzZSkge1xyXG4gICAgdGhpcy5fc3Vic2NyaXB0aW9ucy5zdG9wKCk7XHJcblxyXG4gICAgdGhpcy5fc3Vic2NyaXB0aW9ucy5hdXRoID0gdGhpcy5fZmIuYXV0aFN0YXRlKCkuc3Vic2NyaWJlKGFzeW5jIChhdXRoKSA9PiB7XHJcbiAgICAgIGlmIChhdXRoKSB7XHJcbiAgICAgICAgaWYgKHNraXAgPT09IGZhbHNlKSB7XHJcbiAgICAgICAgICBza2lwID0gZmFsc2U7XHJcbiAgICAgICAgICBhd2FpdCB0aGlzLnVzZXJDcmVhdGVPclVwZGF0ZShhdXRoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMuX3N1YnNjcmlwdGlvbnMudXNlciA9IHRoaXMuX2ZiLmZzRG9jU25hcHNob3QoJy91c2Vycy8nICsgYXV0aC51aWQpLnN1YnNjcmliZShzbmFwc2hvdCA9PiB7XHJcblxyXG4gICAgICAgICAgcmV0dXJuIHNuYXBzaG90LnBheWxvYWQuZXhpc3RzXHJcbiAgICAgICAgICAgID8gdGhpcy5fYXV0aC5zZXRVc2VyKHNuYXBzaG90LnBheWxvYWQuZGF0YSgpKVxyXG4gICAgICAgICAgICA6IHRoaXMuX2F1dGgubG9nb3V0KCk7XHJcblxyXG4gICAgICAgIH0sICgpID0+IHtcclxuICAgICAgICAgIGNvbnNvbGUud2FybignT29wcyEgRmFpbGVkIHRvIHdhdGNoIHVzZXIuJyk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9hdXRoLmxvZ291dCgpO1xyXG4gICAgICB9XHJcbiAgICB9LCAoKSA9PiB7XHJcbiAgICAgIGNvbnNvbGUud2FybignT29wcyEgRmFpbGVkIHRvIHVwZGF0ZSBhdXRoZW50aWNhdGlvbi4nKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBhc3luYyB1c2VyQ3JlYXRlT3JVcGRhdGUodXNlcjogVXNlciwgZXh0cmEgPSB7fSkge1xyXG4gICAgY29uc3QgdXNlclJlZiA9IHRoaXMuX2ZiLmZzRG9jKCcvdXNlcnMvJyArIHVzZXIudWlkKTtcclxuICAgIGNvbnN0IHVzZXJEb2MgPSBhd2FpdCB1c2VyUmVmLnJlZi5nZXQoKTtcclxuXHJcbiAgICBjb25zdCBkYXRhOiBhbnkgPSB7XHJcbiAgICAgIC4uLnVzZXJEb2MuZGF0YSgpLFxyXG4gICAgICBpZDogdXNlci51aWQsXHJcbiAgICAgIGVtYWlsOiB1c2VyLmVtYWlsLFxyXG4gICAgICBlbWFpbF92ZXJpZmllZDogdXNlci5lbWFpbFZlcmlmaWVkLFxyXG4gICAgICBuYW1lOiB1c2VyLmRpc3BsYXlOYW1lLFxyXG4gICAgICBpbWFnZTogdXNlci5waG90b1VSTCxcclxuICAgICAgbG9nZ2VkX2F0OiB0aGlzLl9mYi5mc05vdygpLFxyXG4gICAgICAuLi5leHRyYVxyXG4gICAgfTtcclxuXHJcbiAgICBpZiAoIXVzZXJEb2MuZXhpc3RzKSB7XHJcbiAgICAgIGRhdGEuYWN0aXZlID0gdHJ1ZTtcclxuICAgICAgZGF0YS5jcmVhdGVkX2F0ID0gdGhpcy5fZmIuZnNOb3coKTtcclxuICAgICAgZGF0YS51cGRhdGVkX2F0ID0gdGhpcy5fZmIuZnNOb3coKTtcclxuICAgICAgZGF0YS5kZWxldGVkX2F0ID0gbnVsbDtcclxuICAgIH1cclxuXHJcbiAgICBhd2FpdCB1c2VyUmVmLnNldChkYXRhLCB7bWVyZ2U6IHRydWV9KTtcclxuXHJcbiAgICByZXR1cm4gKGF3YWl0IHVzZXJSZWYucmVmLmdldCgpKS5kYXRhKCk7XHJcbiAgfVxyXG5cclxuICAvLyByZWZyZXNoVG9rZW46IHN0cmluZztcclxuXHJcbiAgLy8gb25PQXV0aFJlZnJlc2hCdG5DbGljaygpIHtcclxuICAvLyAgIGlmICghdGhpcy5yZWZyZXNoVG9rZW4pIHtcclxuICAvLyAgICAgY29uc29sZS5lcnJvcignTm8gcmVmcmVzaCB0b2tlbiBmb3VuZC4gTG9nIGluIHdpdGggT0F1dGggZmlyc3QuJyk7XHJcbiAgLy8gICB9XHJcbiAgLy8gICBQbHVnaW5zLk9BdXRoMkNsaWVudC5yZWZyZXNoVG9rZW4oXHJcbiAgLy8gICAgIHt9IGFzIE9BdXRoMlJlZnJlc2hUb2tlbk9wdGlvbnNcclxuICAvLyAgICkudGhlbigocmVzcG9uc2U6IGFueSkgPT4ge1xyXG4gIC8vICAgICBjb25zb2xlLmxvZygnb25PQXV0aFJlZnJlc2hCdG5DbGljaycsIHJlc3BvbnNlKTtcclxuICAvLyAgIH0pLmNhdGNoKGVycm9yID0+IHtcclxuICAvLyAgICAgY29uc29sZS5lcnJvcignb25PQXV0aFJlZnJlc2hCdG5DbGljazplcnJvcicsIGVycm9yKTtcclxuICAvLyAgIH0pO1xyXG4gIC8vIH1cclxuXHJcbiAgLy8gb25Mb2dvdXRDbGljaygpIHtcclxuICAvLyAgIFBsdWdpbnMuT0F1dGgyQ2xpZW50LmxvZ291dChcclxuICAvLyAgICAge30gYXMgT0F1dGgyQXV0aGVudGljYXRlT3B0aW9uc1xyXG4gIC8vICAgKS50aGVuKChyZXNwb25zZTogYW55KSA9PiB7XHJcbiAgLy8gICAgIGNvbnNvbGUubG9nKCdvbkxvZ291dENsaWNrJywgcmVzcG9uc2UpO1xyXG4gIC8vICAgfSkuY2F0Y2goZXJyb3IgPT4ge1xyXG4gIC8vICAgICBjb25zb2xlLmVycm9yKCdvbkxvZ291dENsaWNrOmVycm9yJywgZXJyb3IpO1xyXG4gIC8vICAgfSk7XHJcbiAgLy8gfVxyXG5cclxufVxyXG4iXX0=