/**
 * @fileoverview added by tsickle
 * Generated from: lib/services/ao-auth.service.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { EventEmitter, Injectable } from '@angular/core';
import { NavController } from '@ionic/angular';
import { LocalStorage } from 'ngx-webstorage';
import { BehaviorSubject } from 'rxjs';
import { AOService } from './ao.service';
import * as i0 from "@angular/core";
import * as i1 from "@ionic/angular";
import * as i2 from "./ao.service";
// @dynamic
var AOAuthService = /** @class */ (function () {
    // -------------------------------------------------------------------------------------------------------------------
    function AOAuthService(_nav, _ao) {
        var _this = this;
        this._nav = _nav;
        this._ao = _ao;
        this._redirect_default = '/';
        this.redirect = (/**
         * @return {?}
         */
        function () { return _this._redirect; });
        this.user = (/**
         * @return {?}
         */
        function () { return _this._user; });
        // -------------------------------------------------------------------------------------------------------------------
        this.isUser = (/**
         * @return {?}
         */
        function () { return !!_this._user; });
        this.isGuest = (/**
         * @return {?}
         */
        function () { return !_this._user; });
        this.id = (/**
         * @return {?}
         */
        function () { return _this.isUser() ? _this.user().id : null; });
        this.name = (/**
         * @return {?}
         */
        function () { return _this.isUser() ? _this.user().name : null; });
        this.email = (/**
         * @return {?}
         */
        function () { return _this.isUser() ? _this.user().email : null; });
        this.image = (/**
         * @return {?}
         */
        function () { return _this.isUser() ? _this.user().image : null; });
        this.verified = (/**
         * @return {?}
         */
        function () { return _this.isUser() ? _this.user().verified : null; });
        this.permitions = (/**
         * @return {?}
         */
        function () { return _this.isUser() ? _this.user().permitions : null; });
        // -------------------------------------------------------------------------------------------------------------------
        this.onLogin = (/**
         * @return {?}
         */
        function () { return AOAuthService._onLogin; });
        this.onLogout = (/**
         * @return {?}
         */
        function () { return AOAuthService._onLogout; });
        this.onChange = (/**
         * @return {?}
         */
        function () { return AOAuthService._onChange; });
        AOAuthService._onChange = new BehaviorSubject(this.user());
    }
    // -------------------------------------------------------------------------------------------------------------------
    // -------------------------------------------------------------------------------------------------------------------
    /**
     * @param {?=} provider
     * @return {?}
     */
    AOAuthService.prototype.provider = 
    // -------------------------------------------------------------------------------------------------------------------
    /**
     * @param {?=} provider
     * @return {?}
     */
    function (provider) {
        if (provider === void 0) { provider = null; }
        if (provider == null) {
            return this._provider;
        }
        this._provider = provider;
        return this;
    };
    // -------------------------------------------------------------------------------------------------------------------
    // -------------------------------------------------------------------------------------------------------------------
    /**
     * @template THIS
     * @this {THIS}
     * @param {?} redirect
     * @return {THIS}
     */
    AOAuthService.prototype.setRedirect = 
    // -------------------------------------------------------------------------------------------------------------------
    /**
     * @template THIS
     * @this {THIS}
     * @param {?} redirect
     * @return {THIS}
     */
    function (redirect) {
        (/** @type {?} */ (this))._redirect = redirect;
        return (/** @type {?} */ (this));
    };
    // -------------------------------------------------------------------------------------------------------------------
    // -------------------------------------------------------------------------------------------------------------------
    /**
     * @template THIS
     * @this {THIS}
     * @param {?} user
     * @return {THIS}
     */
    AOAuthService.prototype.setUser = 
    // -------------------------------------------------------------------------------------------------------------------
    /**
     * @template THIS
     * @this {THIS}
     * @param {?} user
     * @return {THIS}
     */
    function (user) {
        (/** @type {?} */ (this))._user = user;
        (/** @type {?} */ (this)).onChange().next((/** @type {?} */ (this))._user);
        return (/** @type {?} */ (this));
    };
    // -------------------------------------------------------------------------------------------------------------------
    // -------------------------------------------------------------------------------------------------------------------
    /**
     * @param {?} data
     * @return {?}
     */
    AOAuthService.prototype.login = 
    // -------------------------------------------------------------------------------------------------------------------
    /**
     * @param {?} data
     * @return {?}
     */
    function (data) {
        var _this = this;
        return this._ao.wait(this.provider().login(data)).then((/**
         * @param {?} user
         * @return {?}
         */
        function (user) {
            _this.setUser(user);
            _this.onLogin().emit();
            /** @type {?} */
            var redirect = _this._redirect && _this._redirect !== '/login'
                ? _this._redirect
                : _this._redirect_default;
            _this._redirect = null;
            return _this._nav.navigateRoot(redirect);
        }));
    };
    /**
     * @return {?}
     */
    AOAuthService.prototype.logout = /**
     * @return {?}
     */
    function () {
        var _this = this;
        return this._ao.wait(this.provider().logout()).then((/**
         * @return {?}
         */
        function () {
            _this.setUser(null);
            _this.onLogout();
            return _this._nav.navigateRoot('/login');
        }));
    };
    /**
     * @param {?} data
     * @return {?}
     */
    AOAuthService.prototype.update = /**
     * @param {?} data
     * @return {?}
     */
    function (data) {
        return this._ao.wait(this.provider().update(data));
    };
    /**
     * @param {?} data
     * @return {?}
     */
    AOAuthService.prototype.updatePassword = /**
     * @param {?} data
     * @return {?}
     */
    function (data) {
        return this._ao.wait(this.provider().updatePassword(data));
    };
    /**
     * @param {?} data
     * @return {?}
     */
    AOAuthService.prototype.forgetPassword = /**
     * @param {?} data
     * @return {?}
     */
    function (data) {
        return this._ao.wait(this.provider().forgetPassword(data));
    };
    /**
     * @param {?} data
     * @return {?}
     */
    AOAuthService.prototype.resetPassword = /**
     * @param {?} data
     * @return {?}
     */
    function (data) {
        return this._ao.wait(this.provider().resetPassword(data));
    };
    AOAuthService._onLogin = new EventEmitter();
    AOAuthService._onLogout = new EventEmitter();
    AOAuthService.decorators = [
        { type: Injectable, args: [{
                    providedIn: 'root'
                },] }
    ];
    /** @nocollapse */
    AOAuthService.ctorParameters = function () { return [
        { type: NavController },
        { type: AOService }
    ]; };
    /** @nocollapse */ AOAuthService.ngInjectableDef = i0.ɵɵdefineInjectable({ factory: function AOAuthService_Factory() { return new AOAuthService(i0.ɵɵinject(i1.NavController), i0.ɵɵinject(i2.AOService)); }, token: AOAuthService, providedIn: "root" });
    tslib_1.__decorate([
        LocalStorage('user'),
        tslib_1.__metadata("design:type", Object)
    ], AOAuthService.prototype, "_user", void 0);
    tslib_1.__decorate([
        LocalStorage('redirect'),
        tslib_1.__metadata("design:type", String)
    ], AOAuthService.prototype, "_redirect", void 0);
    return AOAuthService;
}());
export { AOAuthService };
if (false) {
    /** @type {?} */
    AOAuthService._onLogin;
    /** @type {?} */
    AOAuthService._onLogout;
    /** @type {?} */
    AOAuthService._onChange;
    /**
     * @type {?}
     * @private
     */
    AOAuthService.prototype._user;
    /**
     * @type {?}
     * @private
     */
    AOAuthService.prototype._redirect;
    /**
     * @type {?}
     * @private
     */
    AOAuthService.prototype._redirect_default;
    /**
     * @type {?}
     * @private
     */
    AOAuthService.prototype._provider;
    /** @type {?} */
    AOAuthService.prototype.redirect;
    /** @type {?} */
    AOAuthService.prototype.user;
    /** @type {?} */
    AOAuthService.prototype.isUser;
    /** @type {?} */
    AOAuthService.prototype.isGuest;
    /** @type {?} */
    AOAuthService.prototype.id;
    /** @type {?} */
    AOAuthService.prototype.name;
    /** @type {?} */
    AOAuthService.prototype.email;
    /** @type {?} */
    AOAuthService.prototype.image;
    /** @type {?} */
    AOAuthService.prototype.verified;
    /** @type {?} */
    AOAuthService.prototype.permitions;
    /** @type {?} */
    AOAuthService.prototype.onLogin;
    /** @type {?} */
    AOAuthService.prototype.onLogout;
    /** @type {?} */
    AOAuthService.prototype.onChange;
    /**
     * @type {?}
     * @private
     */
    AOAuthService.prototype._nav;
    /**
     * @type {?}
     * @private
     */
    AOAuthService.prototype._ao;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYW8tYXV0aC5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vYW8tYW5ndWxhci8iLCJzb3VyY2VzIjpbImxpYi9zZXJ2aWNlcy9hby1hdXRoLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsT0FBTyxFQUFFLFlBQVksRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDekQsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQy9DLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUM5QyxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBRXZDLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxjQUFjLENBQUM7Ozs7O0FBS3pDO0lBbUJFLHNIQUFzSDtJQUV0SCx1QkFDVSxJQUFtQixFQUNuQixHQUFjO1FBRnhCLGlCQUtDO1FBSlMsU0FBSSxHQUFKLElBQUksQ0FBZTtRQUNuQixRQUFHLEdBQUgsR0FBRyxDQUFXO1FBZGhCLHNCQUFpQixHQUFHLEdBQUcsQ0FBQztRQXNDaEMsYUFBUTs7O1FBQUcsY0FBTSxPQUFBLEtBQUksQ0FBQyxTQUFTLEVBQWQsQ0FBYyxFQUFDO1FBWWhDLFNBQUk7OztRQUFHLGNBQU0sT0FBQSxLQUFJLENBQUMsS0FBSyxFQUFWLENBQVUsRUFBQzs7UUFJeEIsV0FBTTs7O1FBQUcsY0FBTSxPQUFBLENBQUMsQ0FBQyxLQUFJLENBQUMsS0FBSyxFQUFaLENBQVksRUFBQztRQUU1QixZQUFPOzs7UUFBRyxjQUFNLE9BQUEsQ0FBQyxLQUFJLENBQUMsS0FBSyxFQUFYLENBQVcsRUFBQztRQUU1QixPQUFFOzs7UUFBRyxjQUFNLE9BQUEsS0FBSSxDQUFDLE1BQU0sRUFBRSxDQUFDLENBQUMsQ0FBQyxLQUFJLENBQUMsSUFBSSxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxJQUFJLEVBQXJDLENBQXFDLEVBQUM7UUFFakQsU0FBSTs7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Q0FBQzs7Ozs7SUFFRCxxQ0FBYTs7OztJQUFiLFVBQWMsSUFBUztRQUNyQixPQUFPLElBQUksQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztJQUM1RCxDQUFDO0lBdEhhLHNCQUFRLEdBQXVCLElBQUksWUFBWSxFQUFPLENBQUM7SUFFdkQsdUJBQVMsR0FBdUIsSUFBSSxZQUFZLEVBQVEsQ0FBQzs7Z0JBZnhFLFVBQVUsU0FBQztvQkFDVixVQUFVLEVBQUUsTUFBTTtpQkFDbkI7Ozs7Z0JBWFEsYUFBYTtnQkFJYixTQUFTOzs7SUFVTTtRQUFyQixZQUFZLENBQUMsTUFBTSxDQUFDOztnREFBb0I7SUFFZjtRQUF6QixZQUFZLENBQUMsVUFBVSxDQUFDOztvREFBMkI7d0JBakJ0RDtDQStJQyxBQXJJRCxJQXFJQztTQWxJWSxhQUFhOzs7SUFVeEIsdUJBQXFFOztJQUVyRSx3QkFBdUU7O0lBRXZFLHdCQUE4Qzs7Ozs7SUFaOUMsOEJBQXlDOzs7OztJQUV6QyxrQ0FBb0Q7Ozs7O0lBRXBELDBDQUFnQzs7Ozs7SUFFaEMsa0NBQTJDOztJQW9DM0MsaUNBQWdDOztJQVloQyw2QkFBd0I7O0lBSXhCLCtCQUE0Qjs7SUFFNUIsZ0NBQTRCOztJQUU1QiwyQkFBaUQ7O0lBRWpELDZCQUFxRDs7SUFFckQsOEJBQXVEOztJQUV2RCw4QkFBdUQ7O0lBRXZELGlDQUE2RDs7SUFFN0QsbUNBQWlFOztJQUlqRSxnQ0FBdUM7O0lBRXZDLGlDQUF5Qzs7SUFFekMsaUNBQXlDOzs7OztJQS9EdkMsNkJBQTJCOzs7OztJQUMzQiw0QkFBc0IiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBFdmVudEVtaXR0ZXIsIEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgTmF2Q29udHJvbGxlciB9IGZyb20gJ0Bpb25pYy9hbmd1bGFyJztcclxuaW1wb3J0IHsgTG9jYWxTdG9yYWdlIH0gZnJvbSAnbmd4LXdlYnN0b3JhZ2UnO1xyXG5pbXBvcnQgeyBCZWhhdmlvclN1YmplY3QgfSBmcm9tICdyeGpzJztcclxuXHJcbmltcG9ydCB7IEFPU2VydmljZSB9IGZyb20gJy4vYW8uc2VydmljZSc7XHJcbmltcG9ydCB7IEFPQXV0aFByb3ZpZGVySW50ZXJmYWNlIH0gZnJvbSAnLi9hby1hdXRoLXByb3ZpZGVyLmludGVyZmFjZSc7XHJcblxyXG4vLyBAZHluYW1pY1xyXG5cclxuQEluamVjdGFibGUoe1xyXG4gIHByb3ZpZGVkSW46ICdyb290J1xyXG59KVxyXG5leHBvcnQgY2xhc3MgQU9BdXRoU2VydmljZSB7XHJcblxyXG4gIEBMb2NhbFN0b3JhZ2UoJ3VzZXInKSBwcml2YXRlIF91c2VyOiBhbnk7XHJcblxyXG4gIEBMb2NhbFN0b3JhZ2UoJ3JlZGlyZWN0JykgcHJpdmF0ZSBfcmVkaXJlY3Q6IHN0cmluZztcclxuXHJcbiAgcHJpdmF0ZSBfcmVkaXJlY3RfZGVmYXVsdCA9ICcvJztcclxuXHJcbiAgcHJpdmF0ZSBfcHJvdmlkZXI6IEFPQXV0aFByb3ZpZGVySW50ZXJmYWNlO1xyXG5cclxuICBwdWJsaWMgc3RhdGljIF9vbkxvZ2luOiBFdmVudEVtaXR0ZXI8dm9pZD4gPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcclxuXHJcbiAgcHVibGljIHN0YXRpYyBfb25Mb2dvdXQ6IEV2ZW50RW1pdHRlcjx2b2lkPiA9IG5ldyBFdmVudEVtaXR0ZXI8dm9pZD4oKTtcclxuXHJcbiAgcHVibGljIHN0YXRpYyBfb25DaGFuZ2U6IEJlaGF2aW9yU3ViamVjdDxhbnk+O1xyXG5cclxuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcblxyXG4gIGNvbnN0cnVjdG9yKFxyXG4gICAgcHJpdmF0ZSBfbmF2OiBOYXZDb250cm9sbGVyLFxyXG4gICAgcHJpdmF0ZSBfYW86IEFPU2VydmljZSxcclxuICApIHtcclxuICAgIEFPQXV0aFNlcnZpY2UuX29uQ2hhbmdlID0gbmV3IEJlaGF2aW9yU3ViamVjdDxhbnk+KHRoaXMudXNlcigpKTtcclxuICB9XHJcblxyXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cclxuXHJcbiAgcHJvdmlkZXIocHJvdmlkZXI6IEFPQXV0aFByb3ZpZGVySW50ZXJmYWNlID0gbnVsbCk6IEFPQXV0aFByb3ZpZGVySW50ZXJmYWNlIHwgdGhpcyB7XHJcbiAgICBpZiAocHJvdmlkZXIgPT0gbnVsbCkge1xyXG4gICAgICByZXR1cm4gdGhpcy5fcHJvdmlkZXI7XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5fcHJvdmlkZXIgPSBwcm92aWRlcjtcclxuXHJcbiAgICByZXR1cm4gdGhpcztcclxuICB9XHJcblxyXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cclxuXHJcbiAgc2V0UmVkaXJlY3QocmVkaXJlY3QpIHtcclxuICAgIHRoaXMuX3JlZGlyZWN0ID0gcmVkaXJlY3Q7XHJcbiAgICByZXR1cm4gdGhpcztcclxuICB9XHJcblxyXG4gIHJlZGlyZWN0ID0gKCkgPT4gdGhpcy5fcmVkaXJlY3Q7XHJcblxyXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cclxuXHJcbiAgc2V0VXNlcih1c2VyKSB7XHJcbiAgICB0aGlzLl91c2VyID0gdXNlcjtcclxuXHJcbiAgICB0aGlzLm9uQ2hhbmdlKCkubmV4dCh0aGlzLl91c2VyKTtcclxuXHJcbiAgICByZXR1cm4gdGhpcztcclxuICB9XHJcblxyXG4gIHVzZXIgPSAoKSA9PiB0aGlzLl91c2VyO1xyXG5cclxuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcblxyXG4gIGlzVXNlciA9ICgpID0+ICEhdGhpcy5fdXNlcjtcclxuXHJcbiAgaXNHdWVzdCA9ICgpID0+ICF0aGlzLl91c2VyO1xyXG5cclxuICBpZCA9ICgpID0+IHRoaXMuaXNVc2VyKCkgPyB0aGlzLnVzZXIoKS5pZCA6IG51bGw7XHJcblxyXG4gIG5hbWUgPSAoKSA9PiB0aGlzLmlzVXNlcigpID8gdGhpcy51c2VyKCkubmFtZSA6IG51bGw7XHJcblxyXG4gIGVtYWlsID0gKCkgPT4gdGhpcy5pc1VzZXIoKSA/IHRoaXMudXNlcigpLmVtYWlsIDogbnVsbDtcclxuXHJcbiAgaW1hZ2UgPSAoKSA9PiB0aGlzLmlzVXNlcigpID8gdGhpcy51c2VyKCkuaW1hZ2UgOiBudWxsO1xyXG5cclxuICB2ZXJpZmllZCA9ICgpID0+IHRoaXMuaXNVc2VyKCkgPyB0aGlzLnVzZXIoKS52ZXJpZmllZCA6IG51bGw7XHJcblxyXG4gIHBlcm1pdGlvbnMgPSAoKSA9PiB0aGlzLmlzVXNlcigpID8gdGhpcy51c2VyKCkucGVybWl0aW9ucyA6IG51bGw7XHJcblxyXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cclxuXHJcbiAgb25Mb2dpbiA9ICgpID0+IEFPQXV0aFNlcnZpY2UuX29uTG9naW47XHJcblxyXG4gIG9uTG9nb3V0ID0gKCkgPT4gQU9BdXRoU2VydmljZS5fb25Mb2dvdXQ7XHJcblxyXG4gIG9uQ2hhbmdlID0gKCkgPT4gQU9BdXRoU2VydmljZS5fb25DaGFuZ2U7XHJcblxyXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cclxuXHJcbiAgbG9naW4oZGF0YTogYW55KTogUHJvbWlzZTxhbnk+IHtcclxuICAgIHJldHVybiB0aGlzLl9hby53YWl0KHRoaXMucHJvdmlkZXIoKS5sb2dpbihkYXRhKSkudGhlbigodXNlcikgPT4ge1xyXG5cclxuICAgICAgdGhpcy5zZXRVc2VyKHVzZXIpO1xyXG4gICAgICB0aGlzLm9uTG9naW4oKS5lbWl0KCk7XHJcblxyXG4gICAgICBjb25zdCByZWRpcmVjdCA9IHRoaXMuX3JlZGlyZWN0ICYmIHRoaXMuX3JlZGlyZWN0ICE9PSAnL2xvZ2luJ1xyXG4gICAgICAgID8gdGhpcy5fcmVkaXJlY3RcclxuICAgICAgICA6IHRoaXMuX3JlZGlyZWN0X2RlZmF1bHQ7XHJcblxyXG4gICAgICB0aGlzLl9yZWRpcmVjdCA9IG51bGw7XHJcblxyXG4gICAgICByZXR1cm4gdGhpcy5fbmF2Lm5hdmlnYXRlUm9vdChyZWRpcmVjdCk7XHJcblxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBsb2dvdXQoKTogUHJvbWlzZTxhbnk+IHtcclxuICAgIHJldHVybiB0aGlzLl9hby53YWl0KHRoaXMucHJvdmlkZXIoKS5sb2dvdXQoKSkudGhlbigoKSA9PiB7XHJcblxyXG4gICAgICB0aGlzLnNldFVzZXIobnVsbCk7XHJcbiAgICAgIHRoaXMub25Mb2dvdXQoKTtcclxuXHJcbiAgICAgIHJldHVybiB0aGlzLl9uYXYubmF2aWdhdGVSb290KCcvbG9naW4nKTtcclxuXHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHVwZGF0ZShkYXRhOiBhbnkpOiBQcm9taXNlPGFueT4ge1xyXG4gICAgcmV0dXJuIHRoaXMuX2FvLndhaXQodGhpcy5wcm92aWRlcigpLnVwZGF0ZShkYXRhKSk7XHJcbiAgfVxyXG5cclxuICB1cGRhdGVQYXNzd29yZChkYXRhOiBhbnkpOiBQcm9taXNlPGFueT4ge1xyXG4gICAgcmV0dXJuIHRoaXMuX2FvLndhaXQodGhpcy5wcm92aWRlcigpLnVwZGF0ZVBhc3N3b3JkKGRhdGEpKTtcclxuICB9XHJcblxyXG4gIGZvcmdldFBhc3N3b3JkKGRhdGE6IGFueSk6IFByb21pc2U8YW55PiB7XHJcbiAgICByZXR1cm4gdGhpcy5fYW8ud2FpdCh0aGlzLnByb3ZpZGVyKCkuZm9yZ2V0UGFzc3dvcmQoZGF0YSkpO1xyXG4gIH1cclxuXHJcbiAgcmVzZXRQYXNzd29yZChkYXRhOiBhbnkpOiBQcm9taXNlPGFueT4ge1xyXG4gICAgcmV0dXJuIHRoaXMuX2FvLndhaXQodGhpcy5wcm92aWRlcigpLnJlc2V0UGFzc3dvcmQoZGF0YSkpO1xyXG4gIH1cclxuXHJcbn1cclxuIl19