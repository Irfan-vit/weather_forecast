/**
 * @fileoverview added by tsickle
 * Generated from: lib/directives/ao-mask/ao-mask.directive.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Directive, Input } from '@angular/core';
import { IonInput } from '@ionic/angular';
import { Subject } from 'rxjs';
import { takeUntil } from 'rxjs/operators';
import IMask from 'imask';
var AOMaskDirective = /** @class */ (function () {
    function AOMaskDirective(ionInput) {
        this.ionInput = ionInput;
        this._masks = {
            zipCode: {
                mask: '00.000-000'
            },
            cnpj: {
                mask: '00.000.000/0000-00'
            },
            cpf: {
                mask: '000.000.000-00'
            },
            cpfCnpj: {
                mask: [
                    { mask: '000.000.000-00' },
                    { mask: '00.000.000/0000-00' }
                ]
            },
            phone: {
                mask: [
                    { mask: '(00) 0000-0000' },
                    { mask: '(00) 0-0000-0000' }
                ]
            },
            date: {
                mask: Date,
                pattern: 'DD/MM/YYYY',
                blocks: {
                    DD: { mask: IMask.MaskedRange, from: 1, to: 31, maxLength: 2 },
                    MM: { mask: IMask.MaskedRange, from: 1, to: 12, maxLength: 2 },
                    YYYY: { mask: IMask.MaskedRange, from: 1900, to: 9999, maxLength: 4 }
                },
                format: (/**
                 * @param {?} date
                 * @return {?}
                 */
                function (date) {
                    /** @type {?} */
                    var day = date.getDate().toString().padStart(2, 0);
                    /** @type {?} */
                    var month = (date.getMonth() + 1).toString().padStart(2, 0);
                    /** @type {?} */
                    var year = date.getFullYear();
                    return [day, month, year].join('/');
                }),
                parse: (/**
                 * @param {?} str
                 * @return {?}
                 */
                function (str) {
                    /** @type {?} */
                    var parts = str.split('/');
                    return new Date(parts[2], parts[1] - 1, parts[0]);
                }),
            },
            decimal: {
                mask: Number,
                thousandsSeparator: '.',
                scale: 2,
                signed: false,
                padFractionalZeros: false,
                normalizeZeros: true,
                radix: ',',
                mapToRadix: ['.'],
            },
            int: {
                mask: Number,
                thousandsSeparator: '.',
                scale: 0,
                signed: false,
            }
        };
        this._destroyed = new Subject();
    }
    /**
     * @return {?}
     */
    AOMaskDirective.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        return tslib_1.__awaiter(this, void 0, void 0, function () {
            var element, formatter, count;
            var _this = this;
            return tslib_1.__generator(this, function (_a) {
                switch (_a.label) {
                    case 0: return [4 /*yield*/, this.ionInput.getInputElement()];
                    case 1:
                        element = _a.sent();
                        formatter = IMask(element, this.options());
                        // formatter.value
                        // formatter.unmaskedValue
                        // formatter.typedValue = '+55 (61) 1234-5678'
                        this.ionInput.value = element.value;
                        formatter.updateValue();
                        count = 0;
                        this.ionInput.ionChange
                            .pipe(takeUntil(this._destroyed))
                            .subscribe((/**
                         * @param {?} event
                         * @return {?}
                         */
                        function (event) {
                            // event.detail.value
                            _this.ionInput.value = element.value;
                            if (count == 0) {
                                formatter.updateValue();
                                count++;
                            }
                        }));
                        return [2 /*return*/];
                }
            });
        });
    };
    /**
     * @return {?}
     */
    AOMaskDirective.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        this._destroyed.next();
    };
    /**
     * @private
     * @return {?}
     */
    AOMaskDirective.prototype.options = /**
     * @private
     * @return {?}
     */
    function () {
        if (typeof this.mask == 'string') {
            /** @type {?} */
            var options = { mask: this.mask };
            if (this._masks[this.mask]) {
                options = this._masks[this.mask];
            }
            if (this.min !== undefined) {
                options.min = this.min;
            }
            if (this.max !== undefined) {
                options.max = this.max;
            }
            if (this.min < 0 || this.max < 0) {
                options.signed = true;
            }
            return options;
        }
        return this.mask;
    };
    AOMaskDirective.decorators = [
        { type: Directive, args: [{
                    selector: '[ao-mask]',
                    providers: [IonInput],
                },] }
    ];
    /** @nocollapse */
    AOMaskDirective.ctorParameters = function () { return [
        { type: IonInput }
    ]; };
    AOMaskDirective.propDecorators = {
        mask: [{ type: Input, args: ['ao-mask',] }],
        min: [{ type: Input, args: ['ao-min',] }],
        max: [{ type: Input, args: ['ao-max',] }]
    };
    return AOMaskDirective;
}());
export { AOMaskDirective };
if (false) {
    /**
     * @type {?}
     * @private
     */
    AOMaskDirective.prototype._masks;
    /**
     * @type {?}
     * @private
     */
    AOMaskDirective.prototype.mask;
    /**
     * @type {?}
     * @private
     */
    AOMaskDirective.prototype.min;
    /**
     * @type {?}
     * @private
     */
    AOMaskDirective.prototype.max;
    /**
     * @type {?}
     * @private
     */
    AOMaskDirective.prototype._destroyed;
    /** @type {?} */
    AOMaskDirective.prototype.ionInput;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYW8tbWFzay5kaXJlY3RpdmUuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9hby1hbmd1bGFyLyIsInNvdXJjZXMiOlsibGliL2RpcmVjdGl2ZXMvYW8tbWFzay9hby1tYXNrLmRpcmVjdGl2ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBcUIsTUFBTSxlQUFlLENBQUM7QUFDcEUsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQzFDLE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDL0IsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQzNDLE9BQU8sS0FBSyxNQUFNLE9BQU8sQ0FBQztBQUUxQjtJQXlFRSx5QkFDUyxRQUFrQjtRQUFsQixhQUFRLEdBQVIsUUFBUSxDQUFVO1FBcEVuQixXQUFNLEdBQVE7WUFDcEIsT0FBTyxFQUFFO2dCQUNQLElBQUksRUFBRSxZQUFZO2FBQ25CO1lBQ0QsSUFBSSxFQUFFO2dCQUNKLElBQUksRUFBRSxvQkFBb0I7YUFDM0I7WUFDRCxHQUFHLEVBQUU7Z0JBQ0gsSUFBSSxFQUFFLGdCQUFnQjthQUN2QjtZQUNELE9BQU8sRUFBRTtnQkFDUCxJQUFJLEVBQUU7b0JBQ0osRUFBQyxJQUFJLEVBQUUsZ0JBQWdCLEVBQUM7b0JBQ3hCLEVBQUMsSUFBSSxFQUFFLG9CQUFvQixFQUFDO2lCQUM3QjthQUNGO1lBQ0QsS0FBSyxFQUFFO2dCQUNMLElBQUksRUFBRTtvQkFDSixFQUFDLElBQUksRUFBRSxnQkFBZ0IsRUFBQztvQkFDeEIsRUFBQyxJQUFJLEVBQUUsa0JBQWtCLEVBQUM7aUJBQzNCO2FBQ0Y7WUFDRCxJQUFJLEVBQUU7Z0JBQ0osSUFBSSxFQUFFLElBQUk7Z0JBQ1YsT0FBTyxFQUFFLFlBQVk7Z0JBQ3JCLE1BQU0sRUFBRTtvQkFDTixFQUFFLEVBQUUsRUFBQyxJQUFJLEVBQUUsS0FBSyxD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LFNBQUMsUUFBUTs7SUFvRWpCLHNCQUFDO0NBQUEsQUF6SUQsSUF5SUM7U0FySVksZUFBZTs7Ozs7O0lBRTFCLGlDQXlERTs7Ozs7SUFFRiwrQkFBb0M7Ozs7O0lBRXBDLDhCQUE2Qjs7Ozs7SUFFN0IsOEJBQTZCOzs7OztJQUU3QixxQ0FBeUM7O0lBR3ZDLG1DQUF5QiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IERpcmVjdGl2ZSwgSW5wdXQsIE9uRGVzdHJveSwgT25Jbml0IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IElvbklucHV0IH0gZnJvbSAnQGlvbmljL2FuZ3VsYXInO1xyXG5pbXBvcnQgeyBTdWJqZWN0IH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IHRha2VVbnRpbCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcclxuaW1wb3J0IElNYXNrIGZyb20gJ2ltYXNrJztcclxuXHJcbkBEaXJlY3RpdmUoe1xyXG4gIHNlbGVjdG9yOiAnW2FvLW1hc2tdJyxcclxuICBwcm92aWRlcnM6IFtJb25JbnB1dF0sXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBBT01hc2tEaXJlY3RpdmUgaW1wbGVtZW50cyBPbkluaXQsIE9uRGVzdHJveSB7XHJcblxyXG4gIHByaXZhdGUgX21hc2tzOiBhbnkgPSB7XHJcbiAgICB6aXBDb2RlOiB7XHJcbiAgICAgIG1hc2s6ICcwMC4wMDAtMDAwJ1xyXG4gICAgfSxcclxuICAgIGNucGo6IHtcclxuICAgICAgbWFzazogJzAwLjAwMC4wMDAvMDAwMC0wMCdcclxuICAgIH0sXHJcbiAgICBjcGY6IHtcclxuICAgICAgbWFzazogJzAwMC4wMDAuMDAwLTAwJ1xyXG4gICAgfSxcclxuICAgIGNwZkNucGo6IHtcclxuICAgICAgbWFzazogW1xyXG4gICAgICAgIHttYXNrOiAnMDAwLjAwMC4wMDAtMDAnfSxcclxuICAgICAgICB7bWFzazogJzAwLjAwMC4wMDAvMDAwMC0wMCd9XHJcbiAgICAgIF1cclxuICAgIH0sXHJcbiAgICBwaG9uZToge1xyXG4gICAgICBtYXNrOiBbXHJcbiAgICAgICAge21hc2s6ICcoMDApIDAwMDAtMDAwMCd9LFxyXG4gICAgICAgIHttYXNrOiAnKDAwKSAwLTAwMDAtMDAwMCd9XHJcbiAgICAgIF1cclxuICAgIH0sXHJcbiAgICBkYXRlOiB7XHJcbiAgICAgIG1hc2s6IERhdGUsXHJcbiAgICAgIHBhdHRlcm46ICdERC9NTS9ZWVlZJyxcclxuICAgICAgYmxvY2tzOiB7XHJcbiAgICAgICAgREQ6IHttYXNrOiBJTWFzay5NYXNrZWRSYW5nZSwgZnJvbTogMSwgdG86IDMxLCBtYXhMZW5ndGg6IDJ9LFxyXG4gICAgICAgIE1NOiB7bWFzazogSU1hc2suTWFza2VkUmFuZ2UsIGZyb206IDEsIHRvOiAxMiwgbWF4TGVuZ3RoOiAyfSxcclxuICAgICAgICBZWVlZOiB7bWFzazogSU1hc2suTWFza2VkUmFuZ2UsIGZyb206IDE5MDAsIHRvOiA5OTk5LCBtYXhMZW5ndGg6IDR9XHJcbiAgICAgIH0sXHJcbiAgICAgIGZvcm1hdDogZnVuY3Rpb24gKGRhdGUpIHtcclxuICAgICAgICBsZXQgZGF5ID0gZGF0ZS5nZXREYXRlKCkudG9TdHJpbmcoKS5wYWRTdGFydCgyLCAwKTtcclxuICAgICAgICBsZXQgbW9udGggPSAoZGF0ZS5nZXRNb250aCgpICsgMSkudG9TdHJpbmcoKS5wYWRTdGFydCgyLCAwKTtcclxuICAgICAgICBsZXQgeWVhciA9IGRhdGUuZ2V0RnVsbFllYXIoKTtcclxuICAgICAgICByZXR1cm4gW2RheSwgbW9udGgsIHllYXJdLmpvaW4oJy8nKTtcclxuICAgICAgfSxcclxuICAgICAgcGFyc2U6IGZ1bmN0aW9uIChzdHIpIHtcclxuICAgICAgICBjb25zdCBwYXJ0cyA9IHN0ci5zcGxpdCgnLycpO1xyXG4gICAgICAgIHJldHVybiBuZXcgRGF0ZShwYXJ0c1syXSwgcGFydHNbMV0gLSAxLCBwYXJ0c1swXSk7XHJcbiAgICAgIH0sXHJcbiAgICB9LFxyXG4gICAgZGVjaW1hbDoge1xyXG4gICAgICBtYXNrOiBOdW1iZXIsXHJcbiAgICAgIHRob3VzYW5kc1NlcGFyYXRvcjogJy4nLFxyXG4gICAgICBzY2FsZTogMixcclxuICAgICAgc2lnbmVkOiBmYWxzZSxcclxuICAgICAgcGFkRnJhY3Rpb25hbFplcm9zOiBmYWxzZSxcclxuICAgICAgbm9ybWFsaXplWmVyb3M6IHRydWUsXHJcbiAgICAgIHJhZGl4OiAnLCcsXHJcbiAgICAgIG1hcFRvUmFkaXg6IFsnLiddLFxyXG4gICAgfSxcclxuICAgIGludDoge1xyXG4gICAgICBtYXNrOiBOdW1iZXIsXHJcbiAgICAgIHRob3VzYW5kc1NlcGFyYXRvcjogJy4nLFxyXG4gICAgICBzY2FsZTogMCxcclxuICAgICAgc2lnbmVkOiBmYWxzZSxcclxuICAgIH1cclxuICB9O1xyXG5cclxuICBASW5wdXQoJ2FvLW1hc2snKSBwcml2YXRlIG1hc2s6IGFueTtcclxuXHJcbiAgQElucHV0KCdhby1taW4nKSBwcml2YXRlIG1pbjtcclxuXHJcbiAgQElucHV0KCdhby1tYXgnKSBwcml2YXRlIG1heDtcclxuXHJcbiAgcHJpdmF0ZSBfZGVzdHJveWVkID0gbmV3IFN1YmplY3Q8dm9pZD4oKTtcclxuXHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICBwdWJsaWMgaW9uSW5wdXQ6IElvbklucHV0XHJcbiAgKSB7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgYXN5bmMgbmdPbkluaXQoKSB7XHJcbiAgICBjb25zdCBlbGVtZW50ID0gYXdhaXQgdGhpcy5pb25JbnB1dC5nZXRJbnB1dEVsZW1lbnQoKTtcclxuXHJcbiAgICBjb25zdCBmb3JtYXR0ZXIgPSBJTWFzayhlbGVtZW50LCB0aGlzLm9wdGlvbnMoKSk7XHJcblxyXG4gICAgLy8gZm9ybWF0dGVyLnZhbHVlXHJcbiAgICAvLyBmb3JtYXR0ZXIudW5tYXNrZWRWYWx1ZVxyXG4gICAgLy8gZm9ybWF0dGVyLnR5cGVkVmFsdWUgPSAnKzU1ICg2MSkgMTIzNC01Njc4J1xyXG5cclxuICAgIHRoaXMuaW9uSW5wdXQudmFsdWUgPSBlbGVtZW50LnZhbHVlO1xyXG4gICAgZm9ybWF0dGVyLnVwZGF0ZVZhbHVlKCk7XHJcblxyXG4gICAgbGV0IGNvdW50ID0gMDtcclxuXHJcbiAgICB0aGlzLmlvbklucHV0LmlvbkNoYW5nZVxyXG4gICAgICAucGlwZSh0YWtlVW50aWwodGhpcy5fZGVzdHJveWVkKSlcclxuICAgICAgLnN1YnNjcmliZSgoZXZlbnQ6IEN1c3RvbUV2ZW50KSA9PiB7XHJcblxyXG4gICAgICAgIC8vIGV2ZW50LmRldGFpbC52YWx1ZVxyXG4gICAgICAgIHRoaXMuaW9uSW5wdXQudmFsdWUgPSBlbGVtZW50LnZhbHVlO1xyXG5cclxuICAgICAgICBpZiAoY291bnQgPT0gMCkge1xyXG4gICAgICAgICAgZm9ybWF0dGVyLnVwZGF0ZVZhbHVlKCk7XHJcbiAgICAgICAgICBjb3VudCsrO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIG5nT25EZXN0cm95KCkge1xyXG4gICAgdGhpcy5fZGVzdHJveWVkLm5leHQoKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgb3B0aW9ucygpIHtcclxuICAgIGlmICh0eXBlb2YgdGhpcy5tYXNrID09ICdzdHJpbmcnKSB7XHJcbiAgICAgIGxldCBvcHRpb25zOiBhbnkgPSB7bWFzazogdGhpcy5tYXNrfTtcclxuXHJcbiAgICAgIGlmICh0aGlzLl9tYXNrc1t0aGlzLm1hc2tdKSB7XHJcbiAgICAgICAgb3B0aW9ucyA9IHRoaXMuX21hc2tzW3RoaXMubWFza107XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGlmICh0aGlzLm1pbiAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgb3B0aW9ucy5taW4gPSB0aGlzLm1pbjtcclxuICAgICAgfVxyXG5cclxuICAgICAgaWYgKHRoaXMubWF4ICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICBvcHRpb25zLm1heCA9IHRoaXMubWF4O1xyXG4gICAgICB9XHJcblxyXG4gICAgICBpZiAodGhpcy5taW4gPCAwIHx8IHRoaXMubWF4IDwgMCkge1xyXG4gICAgICAgIG9wdGlvbnMuc2lnbmVkID0gdHJ1ZTtcclxuICAgICAgfVxyXG5cclxuICAgICAgcmV0dXJuIG9wdGlvbnM7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHRoaXMubWFzaztcclxuICB9XHJcblxyXG59Il19