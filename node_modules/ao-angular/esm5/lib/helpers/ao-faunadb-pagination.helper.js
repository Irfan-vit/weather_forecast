/**
 * @fileoverview added by tsickle
 * Generated from: lib/helpers/ao-faunadb-pagination.helper.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import * as FaunaDB from 'faunadb';
var AOFaunaDBPaginationHelper = /** @class */ (function () {
    function AOFaunaDBPaginationHelper(_ao, _db) {
        this._ao = _ao;
        this._db = _db;
        this._filters_show = true;
        this._filters_model = {};
        this._filters = {};
        this._size = 20;
    }
    //--------------------------------------------------------------------------------------------------------------------
    //--------------------------------------------------------------------------------------------------------------------
    /**
     * @param {?=} filters
     * @return {?}
     */
    AOFaunaDBPaginationHelper.prototype.filters = 
    //--------------------------------------------------------------------------------------------------------------------
    /**
     * @param {?=} filters
     * @return {?}
     */
    function (filters) {
        if (filters) {
            this._filters_model = tslib_1.__assign({}, filters);
            this._filters = tslib_1.__assign({}, filters);
            return this;
        }
        return this._filters;
    };
    /**
     * @return {?}
     */
    AOFaunaDBPaginationHelper.prototype.openFilters = /**
     * @return {?}
     */
    function () {
        this._filters_show = true;
    };
    /**
     * @return {?}
     */
    AOFaunaDBPaginationHelper.prototype.closeFilters = /**
     * @return {?}
     */
    function () {
        this._filters_show = false;
    };
    /**
     * @return {?}
     */
    AOFaunaDBPaginationHelper.prototype.toggleFilters = /**
     * @return {?}
     */
    function () {
        this._filters_show = !this._filters_show;
    };
    /**
     * @return {?}
     */
    AOFaunaDBPaginationHelper.prototype.showFilters = /**
     * @return {?}
     */
    function () {
        return this._filters_show;
    };
    /**
     * @return {?}
     */
    AOFaunaDBPaginationHelper.prototype.hideFilters = /**
     * @return {?}
     */
    function () {
        return !this._filters_show;
    };
    /**
     * @return {?}
     */
    AOFaunaDBPaginationHelper.prototype.hasFilters = /**
     * @return {?}
     */
    function () {
        var _this = this;
        return Object
            .keys(this._filters_model)
            .filter((/**
         * @param {?} key
         * @return {?}
         */
        function (key) { return _this._filters_model[key] !== _this._filters[key]; }))
            .length > 0;
    };
    /**
     * @return {?}
     */
    AOFaunaDBPaginationHelper.prototype.resetFilters = /**
     * @return {?}
     */
    function () {
        this._filters = tslib_1.__assign({}, this._filters_model);
        this.openFilters();
    };
    //--------------------------------------------------------------------------------------------------------------------
    //--------------------------------------------------------------------------------------------------------------------
    /**
     * @template THIS
     * @this {THIS}
     * @param {?} columns
     * @return {THIS}
     */
    AOFaunaDBPaginationHelper.prototype.select = 
    //--------------------------------------------------------------------------------------------------------------------
    /**
     * @template THIS
     * @this {THIS}
     * @param {?} columns
     * @return {THIS}
     */
    function (columns) {
        return ((/** @type {?} */ (this))._columns = tslib_1.__spread(columns)) && (/** @type {?} */ (this));
    };
    /**
     * @template THIS
     * @this {THIS}
     * @param {?} query
     * @return {THIS}
     */
    AOFaunaDBPaginationHelper.prototype.query = /**
     * @template THIS
     * @this {THIS}
     * @param {?} query
     * @return {THIS}
     */
    function (query) {
        return ((/** @type {?} */ (this))._query = query) && (/** @type {?} */ (this));
    };
    /**
     * @return {?}
     */
    AOFaunaDBPaginationHelper.prototype.search = /**
     * @return {?}
     */
    function () {
        this._last_after = undefined;
        this._refresh = undefined;
        this._search = this._query(FaunaDB.query, tslib_1.__assign({}, this.filters()));
        return this.first();
    };
    /**
     * @return {?}
     */
    AOFaunaDBPaginationHelper.prototype.first = /**
     * @return {?}
     */
    function () {
        return this.paginate(this._search, {
            size: this._size,
            before: undefined,
            after: undefined,
        });
    };
    /**
     * @return {?}
     */
    AOFaunaDBPaginationHelper.prototype.previous = /**
     * @return {?}
     */
    function () {
        return this.paginate(this._search, {
            size: this._size,
            after: undefined,
            before: this._response.before,
        });
    };
    /**
     * @return {?}
     */
    AOFaunaDBPaginationHelper.prototype.next = /**
     * @return {?}
     */
    function () {
        return this.paginate(this._search, {
            size: this._size,
            after: this._response.after,
            before: undefined,
        });
    };
    /**
     * @return {?}
     */
    AOFaunaDBPaginationHelper.prototype.last = /**
     * @return {?}
     */
    function () {
        return this.paginate(this._search, {
            size: this._size,
            after: this._last_after,
            before: undefined,
        });
    };
    /**
     * @param {?=} event
     * @return {?}
     */
    AOFaunaDBPaginationHelper.prototype.refresh = /**
     * @param {?=} event
     * @return {?}
     */
    function (event) {
        /** @type {?} */
        var promise;
        if (this.empty()) {
            if (this._response) {
                promise = this.previous();
            }
            else {
                promise = this.search();
            }
        }
        else {
            promise = this.paginate(this._search, this._refresh);
        }
        return promise.then((/**
         * @param {?} response
         * @return {?}
         */
        function (response) {
            event ? event.target.complete() : null;
            return response;
        }));
    };
    /**
     * @private
     * @param {?} set
     * @param {?=} opts
     * @return {?}
     */
    AOFaunaDBPaginationHelper.prototype.paginate = /**
     * @private
     * @param {?} set
     * @param {?=} opts
     * @return {?}
     */
    function (set, opts) {
        var _this = this;
        this._refresh = tslib_1.__assign({}, opts);
        /** @type {?} */
        var paginate = FaunaDB.query.Paginate(set, opts);
        if (this._columns) {
            paginate = FaunaDB.query.Map(paginate, (/**
             * @param {?} item
             * @return {?}
             */
            function (item) { return _this._columns.reduce((/**
             * @param {?} select
             * @param {?} column
             * @param {?} index
             * @return {?}
             */
            function (select, column, index) { return (select[column] = FaunaDB.query.Select(index + 1, item)) && select; }), {}); }));
        }
        return this._db.query((/**
         * @return {?}
         */
        function () { return paginate; }))
            .then((/**
         * @param {?} response
         * @return {?}
         */
        function (response) {
            if (_this._response && _this._response.after && !response.after) {
                _this._last_after = _this._response.after;
            }
            _this._response = response;
            _this.closeFilters();
        })).catch((/**
         * @param {?} error
         * @return {?}
         */
        function (error) {
            _this._ao.danger('Oops! Falha ao realizar a buscar :(', { error: error });
        }));
    };
    /**
     * @return {?}
     */
    AOFaunaDBPaginationHelper.prototype.hasPrevious = /**
     * @return {?}
     */
    function () {
        return !!(this._response && this._response.before);
    };
    /**
     * @return {?}
     */
    AOFaunaDBPaginationHelper.prototype.hasNext = /**
     * @return {?}
     */
    function () {
        return !!(this._response && this._response.after);
    };
    /**
     * @return {?}
     */
    AOFaunaDBPaginationHelper.prototype.hasLast = /**
     * @return {?}
     */
    function () {
        return !!this._last_after;
    };
    /**
     * @return {?}
     */
    AOFaunaDBPaginationHelper.prototype.isFirst = /**
     * @return {?}
     */
    function () {
        return !this.hasPrevious();
    };
    /**
     * @return {?}
     */
    AOFaunaDBPaginationHelper.prototype.isLast = /**
     * @return {?}
     */
    function () {
        return !this.hasNext();
    };
    //--------------------------------------------------------------------------------------------------------------------
    //--------------------------------------------------------------------------------------------------------------------
    /**
     * @return {?}
     */
    AOFaunaDBPaginationHelper.prototype.response = 
    //--------------------------------------------------------------------------------------------------------------------
    /**
     * @return {?}
     */
    function () {
        return this._response ? this._response : null;
    };
    /**
     * @return {?}
     */
    AOFaunaDBPaginationHelper.prototype.items = /**
     * @return {?}
     */
    function () {
        return this._response && this._response.data ? this._response.data : [];
    };
    /**
     * @return {?}
     */
    AOFaunaDBPaginationHelper.prototype.empty = /**
     * @return {?}
     */
    function () {
        return this.items().length === 0;
    };
    return AOFaunaDBPaginationHelper;
}());
export { AOFaunaDBPaginationHelper };
if (false) {
    /**
     * @type {?}
     * @private
     */
    AOFaunaDBPaginationHelper.prototype._filters_show;
    /**
     * @type {?}
     * @private
     */
    AOFaunaDBPaginationHelper.prototype._filters_model;
    /**
     * @type {?}
     * @private
     */
    AOFaunaDBPaginationHelper.prototype._filters;
    /**
     * @type {?}
     * @private
     */
    AOFaunaDBPaginationHelper.prototype._query;
    /**
     * @type {?}
     * @private
     */
    AOFaunaDBPaginationHelper.prototype._columns;
    /**
     * @type {?}
     * @private
     */
    AOFaunaDBPaginationHelper.prototype._search;
    /**
     * @type {?}
     * @private
     */
    AOFaunaDBPaginationHelper.prototype._size;
    /**
     * @type {?}
     * @private
     */
    AOFaunaDBPaginationHelper.prototype._response;
    /**
     * @type {?}
     * @private
     */
    AOFaunaDBPaginationHelper.prototype._last_after;
    /**
     * @type {?}
     * @private
     */
    AOFaunaDBPaginationHelper.prototype._refresh;
    /**
     * @type {?}
     * @private
     */
    AOFaunaDBPaginationHelper.prototype._ao;
    /**
     * @type {?}
     * @private
     */
    AOFaunaDBPaginationHelper.prototype._db;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYW8tZmF1bmFkYi1wYWdpbmF0aW9uLmhlbHBlci5qcyIsInNvdXJjZVJvb3QiOiJuZzovL2FvLWFuZ3VsYXIvIiwic291cmNlcyI6WyJsaWIvaGVscGVycy9hby1mYXVuYWRiLXBhZ2luYXRpb24uaGVscGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLE9BQU8sS0FBSyxPQUFPLE1BQU0sU0FBUyxDQUFDO0FBTW5DO0lBc0JFLG1DQUNVLEdBQWMsRUFDZCxHQUFxQjtRQURyQixRQUFHLEdBQUgsR0FBRyxDQUFXO1FBQ2QsUUFBRyxHQUFILEdBQUcsQ0FBa0I7UUF0QnZCLGtCQUFhLEdBQUcsSUFBSSxDQUFDO1FBRXJCLG1CQUFjLEdBQVEsRUFBRSxDQUFDO1FBRXpCLGFBQVEsR0FBUSxFQUFFLENBQUM7UUFRbkIsVUFBSyxHQUFHLEVBQUUsQ0FBQztJQVluQixDQUFDO0lBRUQsc0hBQXNIOzs7Ozs7SUFFdEgsMkNBQU87Ozs7OztJQUFQLFVBQVEsT0FBYTtRQUNuQixJQUFJLE9BQU8sRUFBRTtZQUNYLElBQUksQ0FBQyxjQUFjLHdCQUFPLE9BQU8sQ0FBQyxDQUFDO1lBQ25DLElBQUksQ0FBQyxRQUFRLHdCQUFPLE9BQU8sQ0FBQyxDQUFDO1lBQzdCLE9BQU8sSUFBSSxDQUFDO1NBQ2I7UUFFRCxPQUFPLElBQUksQ0FBQyxRQUFRLENBQUM7SUFDdkIsQ0FBQzs7OztJQUVELCtDQUFXOzs7SUFBWDtRQUNFLElBQUksQ0FBQyxhQUFhLEdBQUcsSUFBSSxDQUFDO0lBQzVCLENBQUM7Ozs7SUFFRCxnREFBWTs7O0lBQVo7UUFDRSxJQUFJLENBQUMsYUFBYSxHQUFHLEtBQUssQ0FBQztJQUM3QixDQUFDOzs7O0lBRUQsaURBQWE7OztJQUFiO1FBQ0UsSUFBSSxDQUFDLGFBQWEsR0FBRyxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUM7SUFDM0MsQ0FBQzs7OztJQUVELCtDQUFXOzs7SUFBWDtRQUNFLE9BQU8sSUFBSSxDQUFDLGFBQWEsQ0FBQztJ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c0g7Ozs7O0lBRXRILDRDQUFROzs7OztJQUFSO1FBQ0UsT0FBTyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUM7SUFDaEQsQ0FBQzs7OztJQUVELHlDQUFLOzs7SUFBTDtRQUNFLE9BQU8sSUFBSSxDQUFDLFNBQVMsSUFBSSxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQztJQUMxRSxDQUFDOzs7O0lBRUQseUNBQUs7OztJQUFMO1FBQ0UsT0FBTyxJQUFJLENBQUMsS0FBSyxFQUFFLENBQUMsTUFBTSxLQUFLLENBQUMsQ0FBQztJQUNuQyxDQUFDO0lBRUgsZ0NBQUM7QUFBRCxDQUFDLEFBM01ELElBMk1DOzs7Ozs7O0lBek1DLGtEQUE2Qjs7Ozs7SUFFN0IsbURBQWlDOzs7OztJQUVqQyw2Q0FBMkI7Ozs7O0lBRTNCLDJDQUF3Qzs7Ozs7SUFFeEMsNkNBQTJCOzs7OztJQUUzQiw0Q0FBcUI7Ozs7O0lBRXJCLDBDQUFtQjs7Ozs7SUFFbkIsOENBQXVCOzs7OztJQUV2QixnREFBeUI7Ozs7O0lBRXpCLDZDQUFzQjs7Ozs7SUFHcEIsd0NBQXNCOzs7OztJQUN0Qix3Q0FBNkIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBGYXVuYURCIGZyb20gJ2ZhdW5hZGInO1xyXG5pbXBvcnQgeyBFeHByQXJnIH0gZnJvbSAnZmF1bmFkYi9zcmMvdHlwZXMvcXVlcnknO1xyXG5cclxuaW1wb3J0IHsgQU9TZXJ2aWNlIH0gZnJvbSAnLi4vc2VydmljZXMvYW8uc2VydmljZSc7XHJcbmltcG9ydCB7IEFPRmF1bmFEYlNlcnZpY2UgfSBmcm9tICcuLi9zZXJ2aWNlcy9hby1mYXVuYS1kYi5zZXJ2aWNlJztcclxuXHJcbmV4cG9ydCBjbGFzcyBBT0ZhdW5hREJQYWdpbmF0aW9uSGVscGVyIHtcclxuXHJcbiAgcHJpdmF0ZSBfZmlsdGVyc19zaG93ID0gdHJ1ZTtcclxuXHJcbiAgcHJpdmF0ZSBfZmlsdGVyc19tb2RlbDogYW55ID0ge307XHJcblxyXG4gIHByaXZhdGUgX2ZpbHRlcnM6IGFueSA9IHt9O1xyXG5cclxuICBwcml2YXRlIF9xdWVyeTogKHEsIHBhcmFtczogYW55KSA9PiBhbnk7XHJcblxyXG4gIHByaXZhdGUgX2NvbHVtbnM6IHN0cmluZ1tdO1xyXG5cclxuICBwcml2YXRlIF9zZWFyY2g6IGFueTtcclxuXHJcbiAgcHJpdmF0ZSBfc2l6ZSA9IDIwO1xyXG5cclxuICBwcml2YXRlIF9yZXNwb25zZTogYW55O1xyXG5cclxuICBwcml2YXRlIF9sYXN0X2FmdGVyOiBhbnk7XHJcblxyXG4gIHByaXZhdGUgX3JlZnJlc2g6IGFueTtcclxuXHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICBwcml2YXRlIF9hbzogQU9TZXJ2aWNlLFxyXG4gICAgcHJpdmF0ZSBfZGI6IEFPRmF1bmFEYlNlcnZpY2UsXHJcbiAgKSB7XHJcbiAgfVxyXG5cclxuICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcblxyXG4gIGZpbHRlcnMoZmlsdGVycz86IGFueSkge1xyXG4gICAgaWYgKGZpbHRlcnMpIHtcclxuICAgICAgdGhpcy5fZmlsdGVyc19tb2RlbCA9IHsuLi5maWx0ZXJzfTtcclxuICAgICAgdGhpcy5fZmlsdGVycyA9IHsuLi5maWx0ZXJzfTtcclxuICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHRoaXMuX2ZpbHRlcnM7XHJcbiAgfVxyXG5cclxuICBvcGVuRmlsdGVycygpIHtcclxuICAgIHRoaXMuX2ZpbHRlcnNfc2hvdyA9IHRydWU7XHJcbiAgfVxyXG5cclxuICBjbG9zZUZpbHRlcnMoKSB7XHJcbiAgICB0aGlzLl9maWx0ZXJzX3Nob3cgPSBmYWxzZTtcclxuICB9XHJcblxyXG4gIHRvZ2dsZUZpbHRlcnMoKSB7XHJcbiAgICB0aGlzLl9maWx0ZXJzX3Nob3cgPSAhdGhpcy5fZmlsdGVyc19zaG93O1xyXG4gIH1cclxuXHJcbiAgc2hvd0ZpbHRlcnMoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5fZmlsdGVyc19zaG93O1xyXG4gIH1cclxuXHJcbiAgaGlkZUZpbHRlcnMoKSB7XHJcbiAgICByZXR1cm4gIXRoaXMuX2ZpbHRlcnNfc2hvdztcclxuICB9XHJcblxyXG4gIGhhc0ZpbHRlcnMoKSB7XHJcbiAgICByZXR1cm4gT2JqZWN0XHJcbiAgICAgIC5rZXlzKHRoaXMuX2ZpbHRlcnNfbW9kZWwpXHJcbiAgICAgIC5maWx0ZXIoa2V5ID0+IHRoaXMuX2ZpbHRlcnNfbW9kZWxba2V5XSAhPT0gdGhpcy5fZmlsdGVyc1trZXldKVxyXG4gICAgICAubGVuZ3RoID4gMDtcclxuICB9XHJcblxyXG4gIHJlc2V0RmlsdGVycygpIHtcclxuICAgIHRoaXMuX2ZpbHRlcnMgPSB7Li4udGhpcy5fZmlsdGVyc19tb2RlbH07XHJcbiAgICB0aGlzLm9wZW5GaWx0ZXJzKCk7XHJcbiAgfVxyXG5cclxuICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXHJcblxyXG4gIHNlbGVjdChjb2x1bW5zOiBzdHJpbmdbXSkge1xyXG4gICAgcmV0dXJuICh0aGlzLl9jb2x1bW5zID0gWy4uLmNvbHVtbnNdKSAmJiB0aGlzO1xyXG4gIH1cclxuXHJcbiAgcXVlcnkocXVlcnk6IChxLCBwYXJhbXM6IGFueSkgPT4gYW55KSB7XHJcbiAgICByZXR1cm4gKHRoaXMuX3F1ZXJ5ID0gcXVlcnkpICYmIHRoaXM7XHJcbiAgfVxyXG5cclxuICBzZWFyY2goKSB7XHJcbiAgICB0aGlzLl9sYXN0X2FmdGVyID0gdW5kZWZpbmVkO1xyXG4gICAgdGhpcy5fcmVmcmVzaCA9IHVuZGVmaW5lZDtcclxuICAgIHRoaXMuX3NlYXJjaCA9IHRoaXMuX3F1ZXJ5KEZhdW5hREIucXVlcnksIHsuLi50aGlzLmZpbHRlcnMoKX0pO1xyXG4gICAgcmV0dXJuIHRoaXMuZmlyc3QoKTtcclxuICB9XHJcblxyXG4gIGZpcnN0KCkge1xyXG4gICAgcmV0dXJuIHRoaXMucGFnaW5hdGUodGhpcy5fc2VhcmNoLCB7XHJcbiAgICAgIHNpemU6IHRoaXMuX3NpemUsXHJcbiAgICAgIGJlZm9yZTogdW5kZWZpbmVkLFxyXG4gICAgICBhZnRlcjogdW5kZWZpbmVkLFxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBwcmV2aW91cygpIHtcclxuICAgIHJldHVybiB0aGlzLnBhZ2luYXRlKHRoaXMuX3NlYXJjaCwge1xyXG4gICAgICBzaXplOiB0aGlzLl9zaXplLFxyXG4gICAgICBhZnRlcjogdW5kZWZpbmVkLFxyXG4gICAgICBiZWZvcmU6IHRoaXMuX3Jlc3BvbnNlLmJlZm9yZSxcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgbmV4dCgpIHtcclxuICAgIHJldHVybiB0aGlzLnBhZ2luYXRlKHRoaXMuX3NlYXJjaCwge1xyXG4gICAgICBzaXplOiB0aGlzLl9zaXplLFxyXG4gICAgICBhZnRlcjogdGhpcy5fcmVzcG9uc2UuYWZ0ZXIsXHJcbiAgICAgIGJlZm9yZTogdW5kZWZpbmVkLFxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBsYXN0KCkge1xyXG4gICAgcmV0dXJuIHRoaXMucGFnaW5hdGUodGhpcy5fc2VhcmNoLCB7XHJcbiAgICAgIHNpemU6IHRoaXMuX3NpemUsXHJcbiAgICAgIGFmdGVyOiB0aGlzLl9sYXN0X2FmdGVyLFxyXG4gICAgICBiZWZvcmU6IHVuZGVmaW5lZCxcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgcmVmcmVzaChldmVudD8pIHtcclxuICAgIGxldCBwcm9taXNlO1xyXG5cclxuICAgIGlmICh0aGlzLmVtcHR5KCkpIHtcclxuICAgICAgaWYgKHRoaXMuX3Jlc3BvbnNlKSB7XHJcbiAgICAgICAgcHJvbWlzZSA9IHRoaXMucHJldmlvdXMoKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBwcm9taXNlID0gdGhpcy5zZWFyY2goKTtcclxuICAgICAgfVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcHJvbWlzZSA9IHRoaXMucGFnaW5hdGUodGhpcy5fc2VhcmNoLCB0aGlzLl9yZWZyZXNoKTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gcHJvbWlzZS50aGVuKHJlc3BvbnNlID0+IHtcclxuICAgICAgZXZlbnQgPyBldmVudC50YXJnZXQuY29tcGxldGUoKSA6IG51bGw7XHJcbiAgICAgIHJldHVybiByZXNwb25zZTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBwYWdpbmF0ZShzZXQ6IEV4cHJBcmcsIG9wdHM/OiBvYmplY3QpIHtcclxuXHJcbiAgICB0aGlzLl9yZWZyZXNoID0gey4uLm9wdHN9O1xyXG5cclxuICAgIGxldCBwYWdpbmF0ZSA9IEZhdW5hREIucXVlcnkuUGFnaW5hdGUoc2V0LCBvcHRzKTtcclxuXHJcbiAgICBpZiAodGhpcy5fY29sdW1ucykge1xyXG4gICAgICBwYWdpbmF0ZSA9IEZhdW5hREIucXVlcnkuTWFwKHBhZ2luYXRlLCBpdGVtID0+IHRoaXMuX2NvbHVtbnMucmVkdWNlKFxyXG4gICAgICAgIChzZWxlY3QsIGNvbHVtbiwgaW5kZXgpID0+IChzZWxlY3RbY29sdW1uXSA9IEZhdW5hREIucXVlcnkuU2VsZWN0KGluZGV4ICsgMSwgaXRlbSkpICYmIHNlbGVjdCwge31cclxuICAgICAgKSk7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHRoaXMuX2RiLnF1ZXJ5KCgpID0+IHBhZ2luYXRlKVxyXG4gICAgICAudGhlbigocmVzcG9uc2U6IGFueSkgPT4ge1xyXG5cclxuICAgICAgICBpZiAodGhpcy5fcmVzcG9uc2UgJiYgdGhpcy5fcmVzcG9uc2UuYWZ0ZXIgJiYgIXJlc3BvbnNlLmFmdGVyKSB7XHJcbiAgICAgICAgICB0aGlzLl9sYXN0X2FmdGVyID0gdGhpcy5fcmVzcG9uc2UuYWZ0ZXI7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLl9yZXNwb25zZSA9IHJlc3BvbnNlO1xyXG4gICAgICAgIHRoaXMuY2xvc2VGaWx0ZXJzKCk7XHJcblxyXG4gICAgICB9KS5jYXRjaChlcnJvciA9PiB7XHJcblxyXG4gICAgICAgIHRoaXMuX2FvLmRhbmdlcignT29wcyEgRmFsaGEgYW8gcmVhbGl6YXIgYSBidXNjYXIgOignLCB7ZXJyb3J9KTtcclxuXHJcbiAgICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgaGFzUHJldmlvdXMoKSB7XHJcbiAgICByZXR1cm4gISEodGhpcy5fcmVzcG9uc2UgJiYgdGhpcy5fcmVzcG9uc2UuYmVmb3JlKTtcclxuICB9XHJcblxyXG4gIGhhc05leHQoKSB7XHJcbiAgICByZXR1cm4gISEodGhpcy5fcmVzcG9uc2UgJiYgdGhpcy5fcmVzcG9uc2UuYWZ0ZXIpO1xyXG4gIH1cclxuXHJcbiAgaGFzTGFzdCgpIHtcclxuICAgIHJldHVybiAhIXRoaXMuX2xhc3RfYWZ0ZXI7XHJcbiAgfVxyXG5cclxuICBpc0ZpcnN0KCkge1xyXG4gICAgcmV0dXJuICF0aGlzLmhhc1ByZXZpb3VzKCk7XHJcbiAgfVxyXG5cclxuICBpc0xhc3QoKSB7XHJcbiAgICByZXR1cm4gIXRoaXMuaGFzTmV4dCgpO1xyXG4gIH1cclxuXHJcbiAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxyXG5cclxuICByZXNwb25zZSgpOiBhbnkge1xyXG4gICAgcmV0dXJuIHRoaXMuX3Jlc3BvbnNlID8gdGhpcy5fcmVzcG9uc2UgOiBudWxsO1xyXG4gIH1cclxuXHJcbiAgaXRlbXMoKTogYW55W10ge1xyXG4gICAgcmV0dXJuIHRoaXMuX3Jlc3BvbnNlICYmIHRoaXMuX3Jlc3BvbnNlLmRhdGEgPyB0aGlzLl9yZXNwb25zZS5kYXRhIDogW107XHJcbiAgfVxyXG5cclxuICBlbXB0eSgpOiBib29sZWFuIHtcclxuICAgIHJldHVybiB0aGlzLml0ZW1zKCkubGVuZ3RoID09PSAwO1xyXG4gIH1cclxuXHJcbn1cclxuIl19